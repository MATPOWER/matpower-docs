<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A Test Gizmo Element Type &mdash; MATPOWER Documentation 8.0b1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/matpower.css?v=f6466fd7" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=d50bc636"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>window.MathJax = {"loader": {"load": ["[tex]/upgreek"]}, "tex": {"packages": {"[+]": ["upgreek"]}, "macros": {"dg": "\\sp\\dagger", "trans": ["{#1}^{\\mathsf{T}}", 1], "conj": ["{#1}^{\\ast}", 1], "hc": ["{#1}^{\\dg}", 1], "hconj": ["{#1}^{+}", 1], "diag": ["\\left[^\\smallsetminus{#1}_\\smallsetminus\\right]", 1], "diagg": ["\\left[\\smash{#1}\\right]", 1], "cdiag": ["\\conj{\\diag{#1}}", 1], "der": ["\\frac{\\partial{#1}}{\\partial{#2}}", 2], "dersx": ["\\frac{\\partial^2{#1}}{\\partial{#2}^2}", 2], "dersxy": ["\\frac{\\partial^2{#1}}{\\partial{#2}\\partial{#3}}", 3], "cscal": ["\\mathrm{#1}", 1], "rvec": ["{\\boldsymbol{#1}}", 1], "cvec": ["\\mathbf{#1}", 1], "rmat": ["{\\boldsymbol{#1}}", 1], "cmat": ["\\mathbf{#1}", 1], "rvecG": ["{\\boldsymbol{#1}}", 1], "cvecG": ["\\boldsymbol{#1}", 1], "rmatG": ["\\boldsymbol{\\mathit{#1}}", 1], "cmatG": ["\\mathbf{#1}", 1], "param": ["\\underline{#1}", 1], "ov": ["{\\overline{#1}}", 1], "zeros": ["\\rvec{0}", 0], "ones": ["\\rvec{1}_{#1}", 1], "onest": ["\\trans{\\rvec{1}}_{#1}", 1], "Id": ["\\diag{\\ones{#1}}", 1], "R": "\\mathbb{R}}         % requires \\usepackage{amsfonts|bbold", "C": "\\mathbb{C}}         % requires \\usepackage{amsfonts", "av": "\\cvec{a}", "bv": "\\cvec{b}", "cv": "\\cvec{c}", "f": "\\cscal{f}", "F": "\\cvec{f}", "g": "\\rvec{g}", "G": "\\cvec{g}", "h": "\\rvec{h}", "HH": "\\cvec{h}", "x": "\\rvec{x}", "y": "\\rvec{y}", "z": "\\rvec{z}", "X": "\\cvec{x}", "Z": "\\cvec{z}", "A": "\\cmat{A}", "B": "\\cmat{B}", "alphav": "\\rvecG{\\alpha}", "lam": "\\rvecG{\\lambda}", "lamh": "\\hat{\\lam}", "muv": "\\rvecG{\\mu}", "muhv": "\\hat{\\muv}", "vv": "\\rvec{v}", "vvi": ["\\cscal{v}_{#1}", 1], "V": "\\cvec{v}", "Vh": "\\hat{\\V}", "Vc": "\\conj{\\V}", "Vhc": "\\conj{\\Vh}", "dV": "\\diag{\\V}", "dVh": "\\diag{\\Vh}", "dVc": "\\diag{\\Vc}", "dVhc": "\\diag{\\Vhc}", "inV": "\\cvec{\\Lambda}", "inVh": "\\hat{\\inV}", "inVc": "\\conj{\\inV}", "inVhc": "\\conj{\\inVh}", "dinV": "\\diagg{\\inV}", "dinVh": "\\diagg{\\inVh}", "dinVc": "\\diagg{\\inVc}", "dinVhc": "\\diagg{\\inVhc}", "va": ["\\theta", 0], "vai": ["\\va_{#1}", 1], "Va": ["\\rvec{\\va}", 0], "Vah": ["\\hat{\\Va}", 0], "vm": ["\\nu", 0], "vmi": ["\\nu_{#1}", 1], "Vm": ["\\rvecG{\\nu}", 0], "dVm": "\\diag{\\Vm}", "dVmi": "\\dVm^{-1}", "Vmh": "\\hat{\\Vm}", "dVmh": "\\diag{\\Vmh}", "dVmhi": "\\dVmh^{-1}", "vr": "u", "vri": ["u_{#1}", 1], "vi": "w", "vii": ["w_{#1}", 1], "Vr": "\\rvec{u}", "Vi": "\\rvec{w}", "dVr": "\\diag{\\Vr}", "dVi": "\\diag{\\Vi}", "Vrh": "\\hat{\\Vr}", "Vih": "\\hat{\\Vi}", "dVrh": "\\diag{\\Vrh}", "dVih": "\\diag{\\Vih}", "E": "\\cvec{e}", "Eh": "\\hat{\\E}", "Ec": "\\conj{\\E}", "Ehc": "\\conj{\\Eh}", "dE": "\\diag{\\E}", "dEh": "\\diag{\\Eh}", "dEc": "\\diag{\\Ec}", "dEhc": "\\diag{\\Ehc}", "zr": "{z_r}", "zi": "{z_i}", "Zr": "{\\rvec{z}_r}", "Zi": "{\\rvec{z}_i}", "dlam": "\\diagg{\\lam}", "dlamh": "\\diagg{\\lamh}", "dlamva": "\\diagg{\\lam_\\va}", "dlamvm": "\\diagg{\\lam_\\vm}", "dlamvr": "\\diagg{\\lam_\\vr}", "dlamvi": "\\diagg{\\lam_\\vi}", "dlamzr": "\\diagg{\\lam_\\zr}", "dlamzi": "\\diagg{\\lam_\\zi}", "dlamhva": "\\diagg{\\lamh_\\va}", "dlamhvm": "\\diagg{\\lamh_\\vm}", "dlamhvr": "\\diagg{\\lamh_\\vr}", "dlamhvi": "\\diagg{\\lamh_\\vi}", "dlamhzr": "\\diagg{\\lamh_\\zr}", "dlamhzi": "\\diagg{\\lamh_\\zi}", "dmu": "\\diag{\\muv}", "dmuh": "\\diag{\\muhv}", "kk": "\\rvec{k}", "J": "\\param{\\rmat{J}}", "Jt": "\\trans{\\J}", "Jk": ["\\J_{\\kk_#1}", 1], "Ah": "\\hat{\\A}", "Fh": "\\hat{\\F}", "Gh": "\\hat{\\G}", "gh": "\\hat{\\g}", "fmax": "\\param{\\rvec{f}}_\\mathrm{max}", "gP": "\\g^P", "gPk": ["\\g^{P,#1}", 1], "fhmax": "\\hat{\\param{\\rvec{f}}}_\\mathrm{max}", "ghP": "\\gh^P", "ghPk": ["\\gh^{P,#1}", 1], "GS": "\\G^S", "GI": "\\G^I", "GSk": ["\\G^{S,#1}", 1], "GIk": ["\\G^{I,#1}", 1], "GSsys": "\\GSk{\\mathrm{sys}}", "GIsys": "\\GIk{\\mathrm{sys}}", "gPsys": "\\gPk{\\mathrm{sys}}", "GhS": "\\Gh^S", "GhI": "\\Gh^I", "GhSk": ["\\Gh^{S,#1}", 1], "GhIk": ["\\Gh^{I,#1}", 1], "GhSsys": "\\GhSk{\\mathrm{sys}}", "GhIsys": "\\GhIk{\\mathrm{sys}}", "ghPsys": "\\ghPk{\\mathrm{sys}}", "Ilin": "\\cvec{i}^{lin}", "Ilink": "\\cvec{i}^{lin, k}", "Ilinc": "\\conj{\\Ilin}", "dIlin": "\\diag{\\Ilin}", "dIlinc": "\\diag{\\Ilinc}", "Ilinh": "\\hat{{\\cvec{i}}}^{lin}", "Ilinhk": "\\hat{\\cvec{i}}^{lin, k}", "Ilinhc": "\\conj{\\Ilinh}", "dIlinh": "\\diag{\\Ilinh}", "dIlinhc": "\\diag{\\Ilinhc}", "Slin": "\\cvec{s}^{lin}", "Slink": "\\cvec{s}^{lin, k}", "Slinc": "\\conj{\\Slin}", "dSlin": "\\diag{\\Slin}", "dSlinc": "\\diag{\\Slinc}", "Slinh": "\\hat{\\cvec{s}}^{lin}", "Slinhk": "\\hat{\\cvec{s}}^{lin, k}", "Slinhc": "\\conj{\\Slinh}", "dSlinh": "\\diag{\\Slinh}", "dSlinhc": "\\diag{\\Slinhc}", "Inln": "\\cvec{i}^{nln}", "Inlnk": "\\cvec{i}^{nln, k}", "Snln": "\\cvec{s}^{nln}", "Snlnk": "\\cvec{s}^{nln, k}", "Inlnh": "\\hat{\\cvec{i}}^{nln}", "Inlnhk": "\\hat{\\cvec{i}}^{nln, k}", "Snlnh": "\\hat{\\cvec{s}}^{nln}", "Snlnhk": "\\hat{\\cvec{s}}^{nln, k}", "Aa": "\\param{\\rmat{A}}", "BB": "\\param{\\rmat{B}}", "CC": "\\param{\\rmat{C}}", "DD": "\\param{\\rmat{D}}", "YY": "\\param{\\cmat{Y}}", "iv": "\\param{\\cvec{i}}", "pv": "\\param{\\rvec{p}}", "sv": "\\param{\\cvec{s}}", "KK": "\\param{\\rmat{K}}", "LL": "\\param{\\cmat{L}}", "MM": "\\param{\\cmat{M}}", "NN": "\\param{\\cmat{N}}", "BBh": "\\hat{\\BB}", "YYh": "\\hat{\\YY}", "ivh": "\\hat{\\iv}", "pvh": "\\hat{\\pv}", "svh": "\\hat{\\sv}", "CCh": "\\hat{\\CC}", "KKh": "\\hat{\\KK}", "LLh": "\\hat{\\LL}", "MMh": "\\hat{\\MM}", "NNh": "\\hat{\\NN}", "AT": "\\trans{\\Aa}", "CT": "\\trans{\\CC}", "DT": "\\trans{\\DD}", "Ap": "\\Aa'", "Cp": "\\CC\\:\\!'", "Dp": "\\DD'", "ApT": "\\trans{\\Ap}", "CpT": "\\trans{\\Cp}", "DpT": "\\trans{\\Dp}", "ChT": "\\trans{\\CCh}", "Lc": "\\conj{\\LL}", "LcT": "\\trans{\\Lc}", "Lhc": "\\conj{\\LLh}", "LhcT": "\\trans{\\Lhc}", "MT": "\\trans{\\MM}", "Mc": "\\conj{\\MM}", "McT": "\\trans{\\Mc}", "dMTlam": "\\diag{\\MT \\lam}", "MhT": "\\trans{\\MMh}", "Mhc": "\\conj{\\MMh}", "MhcT": "\\trans{\\Mhc}", "dMhTlam": "\\diag{\\MhT \\lamh}", "Nc": "\\conj{\\NN}", "NcT": "\\trans{\\Nc}", "Nhc": "\\conj{\\NNh}", "NhcT": "\\trans{\\Nhc}", "YT": "\\trans{\\YY}", "Yc": "\\conj{\\YY}", "YcT": "\\trans{\\Yc}", "dYTlam": "\\diag{\\YT \\lam}", "YhT": "\\trans{\\YYh}", "Yhc": "\\conj{\\YYh}", "YhcT": "\\trans{\\Yhc}", "dYhTlam": "\\diag{\\YhT \\lamh}", "I": "\\cvec{i}^S", "s": "\\cvec{s}^I", "Ih": "\\hat{\\cvec{i}}^S", "Sh": "\\hat{\\cvec{s}}^I", "AtX": "\\AT \\X", "CtV": "\\CT \\V", "dCtV": "\\diag{\\CtV}", "DtZ": "\\DT \\Z", "ApTx": "\\ApT \\x", "CpTv": "\\CpT \\vv", "DpTz": "\\DpT \\z"}}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to Add an OPF Constraint" href="../add-constraint.html" />
    <link rel="prev" title="How to Create a New Element Type" href="../element.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #568085" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MATPOWER Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org">Home (matpower.org)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Manuals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../users-manual/index.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-manual/index.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> Developer’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ref-manual/index.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> Reference Manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../mptest/index.html">MP-Test User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mips/index.html">MIPS User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mpom/index.html"><span class="raw-html">MP-Opt-Model</span> User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../most/index.html">MOST User’s Manual</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How To Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../element.html">How to Create a New Element Type</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../element.html#dc-transmission-line">DC Transmission Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../element.html#data-model-element">Data Model Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../element.html#data-model-converter-element">Data Model Converter Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../element.html#network-model-element">Network Model Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../element.html#mathematical-model-element">Mathematical Model Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../element.html#using-the-new-element">Using the New Element</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../element.html#see-also">See Also</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">A Test Gizmo Element Type</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#port-gizmo">3-Port Gizmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-model-element">Data Model Element</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-model-converter-element">Data Model Converter Element</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network-model-element">Network Model Element</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mathematical-model-element">Mathematical Model Element</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gizmo-extension">Gizmo Extension</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../add-constraint.html">How to Add an OPF Constraint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extension.html">How to Create an Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../three-phase.html">How to Run a Three-Phase Power Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builddocs.html">How to Build the Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/sponsor">Donate</a></li>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/download">Downloads</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/MATPOWER/matpower">GitHub Project</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #568085" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MATPOWER Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../element.html">How to Create a New Element Type</a></li>
      <li class="breadcrumb-item active">A Test Gizmo Element Type</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/howto/gizmo-element/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="../element.html" class="btn btn-neutral float-left" title="How to Create a New Element Type" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../add-constraint.html" class="btn btn-neutral float-right" title="How to Add an OPF Constraint" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a-test-gizmo-element-type">
<span id="howto-gizmo-element"></span><h1>A Test Gizmo Element Type<a class="headerlink" href="#a-test-gizmo-element-type" title="Link to this heading"></a></h1>
<p>This guide provides another example of the implementation of a new element type. It is not as complete as the one in the <a class="reference internal" href="../element.html#howto-element"><span class="std std-ref">How to Create a New Element Type</span></a> guide, but does illustrate a wider range of network modeling capabilities.</p>
<p><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> includes implementations of numerous standard element types such as buses, generators, loads, transmission lines, transformers, etc. For this discussion, we use a fictitious element type, a <strong>gizmo</strong>, that has no physical equivalent, but illustrates a wide range of modeling possibilities. This is element is used in some of the <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> tests to verify custom modeling facilities.</p>
<section id="port-gizmo">
<h2>3-Port Gizmo<a class="headerlink" href="#port-gizmo" title="Link to this heading"></a></h2>
<p>Let’s say that a <strong>gizmo</strong> is a 3 port model with 2 non-voltage states. That is, each gizmo connects to 3 different buses and has 2 additional complex state variables, one essentially a current and the other a power flow. And it includes all six types of components that make up the standard AC network model for any element type, as described in the <a class="reference internal" href="../../dev-manual/net-model.html#sec-nm-formulations-ac"><span class="std std-ref">AC Formulations</span></a> section of the <span class="raw-html"><a class="reference external" href="https://matpower.org/documentation/dev-manual/"><em>M<span style="font-size:smaller">ATPOWER</span> Developer’s Manual</em></a></span>.</p>
<figure class="align-center" id="id1">
<span id="fig-gizmo-model"></span><a class="reference internal image-reference" href="../../_images/gizmo-model.png"><img alt="AC Model for 3 Port Gizmo" src="../../_images/gizmo-model.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 2 </span><span class="caption-text">AC Model for 3 Port Gizmo</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#fig-gizmo-model"><span class="std std-numref">Figure 2</span></a> shows a diagram of the 3-port gizmo, with the various gizmo parameters and the various components summarized in <a class="reference internal" href="#tab-gizmo-components"><span class="std std-numref">Table 2</span></a>, with the flows through them as functions of the voltages and non-state variables.</p>
<span id="tab-gizmo-components"></span><table class="longtable docutils align-default" id="id2">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Gizmo Components/Parameters</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 18.0%" />
<col style="width: 82.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameters</p></th>
<th class="head"><p>Flow Through This Component</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\param{\cscal{i}}_g\)</span></p></td>
<td><p>complex current is constant <span class="raw-html"><br \></span> <span class="math notranslate nohighlight">\(\cscal{i}_1 = \param{\cscal{i}}_g\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\param{\cscal{s}}_g\)</span></p></td>
<td><p>complex power is constant <span class="raw-html"><br \></span> <span class="math notranslate nohighlight">\(\cscal{s}_2 = \param{\cscal{s}}_g\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\param{\cscal{y}}_1, \param{\cscal{y}}_2\)</span></p></td>
<td><p>complex current is proportional to voltage difference (constant impedance) <span class="raw-html"><br \></span> <span class="math notranslate nohighlight">\(\cscal{i}_3 = \param{\cscal{y}}_1 (\cscal{v}_1 - \cscal{v}_3)\)</span> <span class="raw-html"><br \></span> <span class="math notranslate nohighlight">\(\cscal{i}_4 = \param{\cscal{y}}_2 \cscal{v}_2\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\param{\cscal{m}}_1, \param{\cscal{m}}_2\)</span></p></td>
<td><p>complex power is proportional to voltage difference <span class="raw-html"><br \></span> <span class="math notranslate nohighlight">\(\cscal{s}_5 = \param{\cscal{m}}_1 (\cscal{v}_1 - \cscal{v}_2)\)</span> <span class="raw-html"><br \></span> <span class="math notranslate nohighlight">\(\cscal{s}_6 = \param{\cscal{m}}_2 \cscal{v}_3\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\param{\cscal{l}}_g\)</span></p></td>
<td><p>complex current is proportional to non-voltage state <span class="raw-html"><br \></span> <span class="math notranslate nohighlight">\(\cscal{i}_7 = \param{\cscal{l}}_g \cscal{z}_2\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\param{\cscal{n}}_g\)</span></p></td>
<td><p>complex power is proportional to non-voltage state <span class="raw-html"><br \></span> <span class="math notranslate nohighlight">\(\cscal{s}_8 = \param{\cscal{n}}_g \cscal{z}_1\)</span></p></td>
</tr>
</tbody>
</table>
<p>Creating a new element type involves defining and implmementing the corresponding classes for each layer (data, network, and mathematical) of modeling, as well as a corresponding data converter element for each data format. Each of these classes has a <code class="xref mat mat-meth docutils literal notranslate"><span class="pre">name()</span></code> method that returns the same value, linking them to one another and together defining the gizmo element type. That is, in each type of element class, you will see the following method defined.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>name<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;gizmo&#39;</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="data-model-element">
<h2>Data Model Element<a class="headerlink" href="#data-model-element" title="Link to this heading"></a></h2>
<p>We begin with the data model element for a <strong>gizmo</strong>. The data for each gizmo consists of the three buses to which its ports are connected, values of the two non-voltage states, and the 8 parameters shown in <a class="reference internal" href="#fig-gizmo-model"><span class="std std-numref">Figure 2</span></a> and <a class="reference internal" href="#tab-gizmo-components"><span class="std std-numref">Table 2</span></a> above. For the complex values, we specify the real and imaginary parts as separate parameters.</p>
<p>This data is stored in the main data table in the <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.tab" title="mp.dm_element.tab"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tab</span></code></a> property of the data model element object of type <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_gizmo</span></code>. This is a MATLAB <a class="reference external" href="https://www.mathworks.com/help/matlab/ref/table.html"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">table</span></code></a> object, or an <a class="reference internal" href="../../ref-manual/classes/mp_table.html#mp_table" title="mp_table"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp_table</span></code></a> object if running in Octave. The names of the columns in <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.tab" title="mp.dm_element.tab"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tab</span></code></a> are shown in <a class="reference internal" href="#tab-gizmo-data-model"><span class="std std-numref">Table 3</span></a> below. Each row in <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.tab" title="mp.dm_element.tab"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tab</span></code></a> corresponds to an individual gizmo, which means there is a single instance of a gizmo data model element object to hold the data for all gizmos in the system.</p>
<span id="tab-gizmo-data-model"></span><table class="longtable docutils align-default" id="id3">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">Gizmo Data Model</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 18.0%" />
<col style="width: 82.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column Names</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bus_1</span></code>, <code class="docutils literal notranslate"><span class="pre">bus_2</span></code>, <code class="docutils literal notranslate"><span class="pre">bus_3</span></code></p></td>
<td><p>bus numbers for the port 1, 2, and 3 connections, respectively</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Y1r</span></code>, <code class="docutils literal notranslate"><span class="pre">Y1i</span></code>, <code class="docutils literal notranslate"><span class="pre">Y2r</span></code>, <code class="docutils literal notranslate"><span class="pre">Y2i</span></code></p></td>
<td><p>real and imaginary parts of parameters <span class="math notranslate nohighlight">\(\param{\cscal{y}}_1\)</span> and <span class="math notranslate nohighlight">\(\param{\cscal{y}}_2\)</span>, respectively</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">M1r</span></code>, <code class="docutils literal notranslate"><span class="pre">M1i</span></code>, <code class="docutils literal notranslate"><span class="pre">M2r</span></code>, <code class="docutils literal notranslate"><span class="pre">M2i</span></code></p></td>
<td><p>real and imaginary parts of parameters <span class="math notranslate nohighlight">\(\param{\cscal{m}}_1\)</span> and <span class="math notranslate nohighlight">\(\param{\cscal{m}}_2\)</span>, respectively</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Lr</span></code>, <code class="docutils literal notranslate"><span class="pre">Li</span></code></p></td>
<td><p>real and imaginary parts of parameter <span class="math notranslate nohighlight">\(\param{\cscal{l}}_g\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ir</span></code>, <code class="docutils literal notranslate"><span class="pre">Ii</span></code></p></td>
<td><p>real and imaginary parts of parameter <span class="math notranslate nohighlight">\(\param{\cscal{i}}_g\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Nr</span></code>, <code class="docutils literal notranslate"><span class="pre">Ni</span></code></p></td>
<td><p>real and imaginary parts of parameter <span class="math notranslate nohighlight">\(\param{\cscal{n}}_g\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Sr</span></code>, <code class="docutils literal notranslate"><span class="pre">Si</span></code></p></td>
<td><p>real and imaginary parts of parameter <span class="math notranslate nohighlight">\(\param{\cscal{s}}_g\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Zr1</span></code>, <code class="docutils literal notranslate"><span class="pre">Zi1</span></code>, <code class="docutils literal notranslate"><span class="pre">Zr2</span></code>, <code class="docutils literal notranslate"><span class="pre">Zi2</span></code></p></td>
<td><p>real and imaginary parts of non-voltage state variables <span class="math notranslate nohighlight">\(\cscal{z}_1\)</span> and <span class="math notranslate nohighlight">\(\cscal{z}_2\)</span>, respectively</p></td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="#code-dme-gizmo"><span class="std std-numref">Listing 15</span></a> shows the source code for <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_gizmo</span></code>. The first thing to notice is that, as with all data model element classes, it inherits from <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element" title="mp.dm_element"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dm_element</span></code></a>. Please see the <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element" title="mp.dm_element"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dm_element</span></code></a> reference documentation for an overview of the functionality provided and for more details on the methods overridden by <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_gizmo</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<span id="code-dme-gizmo"></span><div class="code-block-caption"><span class="caption-number">Listing 15 </span><span class="caption-text"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_gizmo</span></code></span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="n">dme_gizmo</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span>
<span class="linenos"> 2</span>    <span class="k">properties</span>
<span class="linenos"> 3</span>        <span class="n">bus1</span>        <span class="c">%% bus index vector for port 1</span>
<span class="linenos"> 4</span>        <span class="n">bus2</span>        <span class="c">%% bus index vector for port 2</span>
<span class="linenos"> 5</span>        <span class="n">bus3</span>        <span class="c">%% bus index vector for port 3</span>
<span class="linenos"> 6</span>    <span class="k">end</span>     <span class="c">%% properties</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    <span class="k">methods</span>
<span class="linenos"> 9</span>        <span class="k">function</span> <span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">10</span>            <span class="n">name</span> <span class="p">=</span> <span class="s">&#39;gizmo&#39;</span><span class="p">;</span>
<span class="linenos">11</span>        <span class="k">end</span>
<span class="linenos">12</span>
<span class="linenos">13</span>        <span class="k">function</span> <span class="n">label</span> <span class="p">=</span> <span class="n">label</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">14</span>            <span class="n">label</span> <span class="p">=</span> <span class="s">&#39;Test Gizmo&#39;</span><span class="p">;</span>
<span class="linenos">15</span>        <span class="k">end</span>
<span class="linenos">16</span>
<span class="linenos">17</span>        <span class="k">function</span> <span class="n">label</span> <span class="p">=</span> <span class="n">labels</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">18</span>            <span class="n">label</span> <span class="p">=</span> <span class="s">&#39;Test Gizmos&#39;</span><span class="p">;</span>
<span class="linenos">19</span>        <span class="k">end</span>
<span class="linenos">20</span>
<span class="linenos">21</span>        <span class="k">function</span> <span class="n">name</span> <span class="p">=</span> <span class="n">cxn_type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">22</span>            <span class="n">name</span> <span class="p">=</span> <span class="s">&#39;bus&#39;</span><span class="p">;</span>
<span class="linenos">23</span>        <span class="k">end</span>
<span class="linenos">24</span>
<span class="linenos">25</span>        <span class="k">function</span> <span class="n">name</span> <span class="p">=</span> <span class="n">cxn_idx_prop</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">26</span>            <span class="n">name</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;bus1&#39;</span><span class="p">,</span> <span class="s">&#39;bus2&#39;</span><span class="p">,</span> <span class="s">&#39;bus3&#39;</span><span class="p">};</span>
<span class="linenos">27</span>        <span class="k">end</span>
<span class="linenos">28</span>
<span class="linenos">29</span>        <span class="k">function</span> <span class="n">names</span> <span class="p">=</span> <span class="n">main_table_var_names</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">30</span>            <span class="n">names</span> <span class="p">=</span> <span class="nb">horzcat</span><span class="p">(</span> <span class="n">main_table_var_names</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="p">...</span>
<span class="linenos">31</span>                <span class="p">{</span><span class="s">&#39;bus_1&#39;</span><span class="p">,</span> <span class="s">&#39;bus_2&#39;</span><span class="p">,</span> <span class="s">&#39;bus_3&#39;</span><span class="p">,</span> <span class="s">&#39;Y1r&#39;</span><span class="p">,</span> <span class="s">&#39;Y1i&#39;</span><span class="p">,</span> <span class="s">&#39;Y2r&#39;</span><span class="p">,</span> <span class="s">&#39;Y2i&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">32</span>                <span class="s">&#39;Lr&#39;</span><span class="p">,</span> <span class="s">&#39;Li&#39;</span><span class="p">,</span> <span class="s">&#39;Ir&#39;</span><span class="p">,</span> <span class="s">&#39;Ii&#39;</span><span class="p">,</span> <span class="s">&#39;M1r&#39;</span><span class="p">,</span> <span class="s">&#39;M1i&#39;</span><span class="p">,</span> <span class="s">&#39;M2r&#39;</span><span class="p">,</span> <span class="s">&#39;M2i&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">33</span>                <span class="s">&#39;Nr&#39;</span><span class="p">,</span> <span class="s">&#39;Ni&#39;</span><span class="p">,</span> <span class="s">&#39;Sr&#39;</span><span class="p">,</span> <span class="s">&#39;Si&#39;</span><span class="p">,</span> <span class="s">&#39;Zr1&#39;</span><span class="p">,</span> <span class="s">&#39;Zi1&#39;</span><span class="p">,</span> <span class="s">&#39;Zr2&#39;</span><span class="p">,</span> <span class="s">&#39;Zi2&#39;</span><span class="p">});</span>
<span class="linenos">34</span>        <span class="k">end</span>
<span class="linenos">35</span>
<span class="linenos">36</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">initialize</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
<span class="linenos">37</span>            <span class="n">initialize</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">);</span>  <span class="c">%% call parent</span>
<span class="linenos">38</span>
<span class="linenos">39</span>            <span class="c">%% get bus mapping info</span>
<span class="linenos">40</span>            <span class="n">b2i</span> <span class="p">=</span> <span class="n">dm</span><span class="p">.</span><span class="n">elements</span><span class="p">.</span><span class="n">bus</span><span class="p">.</span><span class="n">ID2i</span><span class="p">;</span>         <span class="c">%% bus num to idx mapping</span>
<span class="linenos">41</span>
<span class="linenos">42</span>            <span class="c">%% set bus index vectors for port connectivity</span>
<span class="linenos">43</span>            <span class="n">obj</span><span class="p">.</span><span class="n">bus1</span> <span class="p">=</span> <span class="n">b2i</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">bus_1</span><span class="p">);</span>
<span class="linenos">44</span>            <span class="n">obj</span><span class="p">.</span><span class="n">bus2</span> <span class="p">=</span> <span class="n">b2i</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">bus_2</span><span class="p">);</span>
<span class="linenos">45</span>            <span class="n">obj</span><span class="p">.</span><span class="n">bus3</span> <span class="p">=</span> <span class="n">b2i</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">bus_3</span><span class="p">);</span>
<span class="linenos">46</span>        <span class="k">end</span>
<span class="linenos">47</span>
<span class="linenos">48</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">update_status</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
<span class="linenos">49</span>            <span class="c">%% get bus status info</span>
<span class="linenos">50</span>            <span class="n">bs</span> <span class="p">=</span> <span class="n">dm</span><span class="p">.</span><span class="n">elements</span><span class="p">.</span><span class="n">bus</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>        <span class="c">%% bus status</span>
<span class="linenos">51</span>
<span class="linenos">52</span>            <span class="c">%% update status of gizmoes connected to isolated/offline buses</span>
<span class="linenos">53</span>            <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">status</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">bs</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">bus1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">...</span>
<span class="linenos">54</span>                                              <span class="n">bs</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">bus2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">...</span>
<span class="linenos">55</span>                                              <span class="n">bs</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">bus3</span><span class="p">);</span>
<span class="linenos">56</span>
<span class="linenos">57</span>            <span class="c">%% call parent to fill in on/off</span>
<span class="linenos">58</span>            <span class="n">update_status</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">);</span>
<span class="linenos">59</span>        <span class="k">end</span>
<span class="linenos">60</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">61</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>For element types that connect to one or more buses, it is typical to define a property for each port in the data model element class. In our case, there are three properties, <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">bus1</span></code>, <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">bus2</span></code>, and <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">bus3</span></code>, which will hold bus index vectors for ports 1, 2 and 3, respectively. That is <code class="docutils literal notranslate"><span class="pre">dme.bus2(k)</span></code> will refer to the index of the bus connected to port 2 of the gizmo defined in row <em>k</em> of the data table.</p>
<p>The <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.name" title="mp.dm_element.name"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">name()</span></code></a> method returns <code class="docutils literal notranslate"><span class="pre">'gizmo'</span></code>, the name used internally for this element type. The <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.label" title="mp.dm_element.label"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">label()</span></code></a> and <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.labels" title="mp.dm_element.labels"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">labels()</span></code></a> methods provide strings to use for singular and plural user visible labels to use when displaying gizmo elements.</p>
<p>The <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.cxn_type" title="mp.dm_element.cxn_type"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">cxn_type()</span></code></a> and <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.cxn_idx_prop" title="mp.dm_element.cxn_idx_prop"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">cxn_idx_prop()</span></code></a> methods specify that <code class="docutils literal notranslate"><span class="pre">'gizmo'</span></code> objects connect to <code class="docutils literal notranslate"><span class="pre">'bus'</span></code> objects and the corresponding bus indices for ports 1, 2, and 3, can be found in properties  <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">bus1</span></code>, <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">bus2</span></code>, and <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">bus3</span></code>, respectively.</p>
<p>The names of the columns in gizmo’s main data table are defined by the return value of <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.main_table_var_names" title="mp.dm_element.main_table_var_names"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">main_table_var_names()</span></code></a>. Note that it is important to call the parent method to include the column names common to all data model elements (i.e. <code class="docutils literal notranslate"><span class="pre">'uid'</span></code>, <code class="docutils literal notranslate"><span class="pre">'name'</span></code>, <code class="docutils literal notranslate"><span class="pre">'status'</span></code>, <code class="docutils literal notranslate"><span class="pre">'source_uid'</span></code>).</p>
<p>The <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.initialize" title="mp.dm_element.initialize"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">initialize()</span></code></a> method takes advantage of the bus ID to bus index mapping available from the <code class="docutils literal notranslate"><span class="pre">'bus'</span></code> data model element object to populate the  <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">bus1</span></code>, <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">bus2</span></code>, and <code class="xref mat mat-attr docutils literal notranslate"><span class="pre">bus3</span></code> properties from the corresponding columns in the main data table.</p>
<p>Finally, <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.update_status" title="mp.dm_element.update_status"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">update_status()</span></code></a> updates the default online/offline status, which has already been initialized from the <code class="docutils literal notranslate"><span class="pre">status</span></code> column of the main data table, to remove from service any gizmo that is connected to an offline bus.</p>
<p>Note that both <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.initialize" title="mp.dm_element.initialize"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">initialize()</span></code></a> and <a class="reference internal" href="../../ref-manual/classes/mp/dm_element.html#mp.dm_element.update_status" title="mp.dm_element.update_status"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">update_status()</span></code></a> rely on the fact that the corresponding methods have already been called for <code class="docutils literal notranslate"><span class="pre">'bus'</span></code> objects before <code class="docutils literal notranslate"><span class="pre">'gizmo'</span></code> objects. The order corresponds to their order in <a class="reference internal" href="../../ref-manual/classes/mp/element_container.html#mp.element_container.element_classes" title="mp.element_container.element_classes"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">dm.element_classes</span></code></a> which is determined by the default defined by the data model class and any <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> extensions or options used to modify that default.</p>
<p>The <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_gizmo</span></code> class is also where you would override any of the pretty-printing methods to implement gizmo sections in your pretty-printed output. Until such methods are added to this example, you can look at the data model element classes for other element types for examples (e.g. <a class="reference internal" href="../../ref-manual/classes/mp/dme_bus.html#mp.dme_bus" title="mp.dme_bus"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_bus</span></code></a>, <a class="reference internal" href="../../ref-manual/classes/mp/dme_branch.html#mp.dme_branch" title="mp.dme_branch"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_branch</span></code></a>, <a class="reference internal" href="../../ref-manual/classes/mp/dme_gen.html#mp.dme_gen" title="mp.dme_gen"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_gen</span></code></a>, <a class="reference internal" href="../../ref-manual/classes/mp/dme_load.html#mp.dme_load" title="mp.dme_load"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_load</span></code></a>, etc.)</p>
<p>See <a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/dme_gizmo.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/dme_gizmo.m</span></code></a> for the complete <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_gizmo</span></code> source.</p>
</section>
<section id="data-model-converter-element">
<h2>Data Model Converter Element<a class="headerlink" href="#data-model-converter-element" title="Link to this heading"></a></h2>
<p><em>(not yet documented)</em></p>
</section>
<section id="network-model-element">
<h2>Network Model Element<a class="headerlink" href="#network-model-element" title="Link to this heading"></a></h2>
<p>Next we define the <strong>gizmo</strong> network model. The focus will be on the AC model with the assumption that both polar and cartesian voltage formulations should be implemented. Because network models are formulation-specific, we will define a class hierarchy for the network model element.</p>
<section id="all-formulations">
<h3>All Formulations<a class="headerlink" href="#all-formulations" title="Link to this heading"></a></h3>
<p>All gizmo network model elements will inherit from <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo</span></code>, shown in <a class="reference internal" href="#code-nme-gizmo"><span class="std std-numref">Listing 16</span></a>, which in turn inherits from <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element" title="mp.nm_element"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nm_element</span></code></a>. Please see the <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element" title="mp.nm_element"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nm_element</span></code></a> reference documentation for an overview of the functionality provided and for more details on the methods overridden by <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo</span></code> and its subclasses.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<span id="code-nme-gizmo"></span><div class="code-block-caption"><span class="caption-number">Listing 16 </span><span class="caption-text"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo</span></code></span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="p">(</span><span class="n">Abstract</span><span class="p">)</span> <span class="n">nme_gizmo</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">nm_element</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="n">name</span> <span class="p">=</span> <span class="s">&#39;gizmo&#39;</span><span class="p">;</span>
<span class="linenos"> 5</span>        <span class="k">end</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>        <span class="k">function</span> <span class="n">np</span> <span class="p">=</span> <span class="n">np</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 8</span>            <span class="n">np</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>     <span class="c">%% this is a 3 port element</span>
<span class="linenos"> 9</span>        <span class="k">end</span>
<span class="linenos">10</span>
<span class="linenos">11</span>        <span class="k">function</span> <span class="n">nz</span> <span class="p">=</span> <span class="n">nz</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">12</span>            <span class="n">nz</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>     <span class="c">%% 2 (possibly complex) non-voltage states per element</span>
<span class="linenos">13</span>        <span class="k">end</span>
<span class="linenos">14</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">15</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>Once again, <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element.name" title="mp.nm_element.name"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">name()</span></code></a> returns the name used internally for this element type, while the <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element.np" title="mp.nm_element.np"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">np()</span></code></a> and <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element.nz" title="mp.nm_element.nz"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">nz()</span></code></a> methods return the number of ports and non-voltage states, respectively. These are shared by all formulations.</p>
</section>
<section id="ac-formulations">
<h3>AC Formulations<a class="headerlink" href="#ac-formulations" title="Link to this heading"></a></h3>
<p>Anything specific to all AC formulations is included in the abstract class <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_ac</span></code>, shown in <a class="reference internal" href="#code-nme-gizmo-ac"><span class="std std-numref">Listing 17</span></a>, which is a subclass of <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo</span></code>. Any concrete network model element class that inherits from <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_ac</span></code> is also expected to be a subclass of a formulation class that inherits from <a class="reference internal" href="../../ref-manual/classes/mp/form_ac.html#mp.form_ac" title="mp.form_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.form_ac</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<span id="code-nme-gizmo-ac"></span><div class="code-block-caption"><span class="caption-number">Listing 17 </span><span class="caption-text"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_ac</span></code></span><a class="headerlink" href="#id6" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="p">(</span><span class="n">Abstract</span><span class="p">)</span> <span class="n">nme_gizmo_ac</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">nme_gizmo</span><span class="c">% &amp; mp.form_ac</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">add_zvars</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="n">tab</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">).</span><span class="n">tab</span><span class="p">;</span>
<span class="linenos"> 5</span>            <span class="n">nk</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">nk</span><span class="p">;</span>
<span class="linenos"> 6</span>            <span class="k">switch</span> <span class="n">idx</span><span class="p">{:}</span>
<span class="linenos"> 7</span>                <span class="k">case</span> <span class="mi">1</span>
<span class="linenos"> 8</span>                    <span class="n">Zmax</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="n">nk</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="linenos"> 9</span>                    <span class="n">Zr</span>   <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Zr1</span><span class="p">;</span>
<span class="linenos">10</span>                    <span class="n">Zi</span>   <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Zi1</span><span class="p">;</span>
<span class="linenos">11</span>                <span class="k">case</span> <span class="mi">2</span>
<span class="linenos">12</span>                    <span class="n">Zmax</span> <span class="p">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">ones</span><span class="p">(</span><span class="n">nk</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="linenos">13</span>                    <span class="n">Zr</span>   <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Zr2</span><span class="p">;</span>
<span class="linenos">14</span>                    <span class="n">Zi</span>   <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Zi2</span><span class="p">;</span>
<span class="linenos">15</span>            <span class="k">end</span>
<span class="linenos">16</span>            <span class="n">vname_r</span> <span class="p">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;Zr%d_gizmo&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">{:});</span>
<span class="linenos">17</span>            <span class="n">vname_i</span> <span class="p">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;Zi%d_gizmo&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">{:});</span>
<span class="linenos">18</span>            <span class="n">nm</span><span class="p">.</span><span class="n">add_var</span><span class="p">(</span><span class="s">&#39;zr&#39;</span><span class="p">,</span> <span class="n">vname_r</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">Zr</span><span class="p">,</span> <span class="o">-</span><span class="n">Zmax</span><span class="p">,</span> <span class="n">Zmax</span><span class="p">);</span>
<span class="linenos">19</span>            <span class="n">nm</span><span class="p">.</span><span class="n">add_var</span><span class="p">(</span><span class="s">&#39;zi&#39;</span><span class="p">,</span> <span class="n">vname_i</span><span class="p">,</span> <span class="n">nk</span><span class="p">,</span> <span class="n">Zi</span><span class="p">,</span> <span class="o">-</span><span class="n">Zmax</span><span class="p">,</span> <span class="n">Zmax</span><span class="p">);</span>
<span class="linenos">20</span>        <span class="k">end</span>
<span class="linenos">21</span>
<span class="linenos">22</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">build_params</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
<span class="linenos">23</span>            <span class="n">build_params</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">nme_gizmo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">);</span>    <span class="c">%% call parent</span>
<span class="linenos">24</span>            <span class="n">tab</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">).</span><span class="n">tab</span><span class="p">;</span>
<span class="linenos">25</span>            <span class="n">nk</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">nk</span><span class="p">;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>            <span class="c">%% collect parameters from data table</span>
<span class="linenos">28</span>            <span class="n">y1</span> <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Y1r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">tab</span><span class="p">.</span><span class="n">Y1i</span><span class="p">;</span>
<span class="linenos">29</span>            <span class="n">y2</span> <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Y2r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">tab</span><span class="p">.</span><span class="n">Y2i</span><span class="p">;</span>
<span class="linenos">30</span>            <span class="n">ll</span> <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Lr</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">tab</span><span class="p">.</span><span class="n">Li</span><span class="p">;</span>
<span class="linenos">31</span>            <span class="n">ii</span> <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Ir</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">tab</span><span class="p">.</span><span class="n">Ii</span><span class="p">;</span>
<span class="linenos">32</span>            <span class="n">m1</span> <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">M1r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">tab</span><span class="p">.</span><span class="n">M1i</span><span class="p">;</span>
<span class="linenos">33</span>            <span class="n">m2</span> <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">M2r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">tab</span><span class="p">.</span><span class="n">M2i</span><span class="p">;</span>
<span class="linenos">34</span>            <span class="n">nn</span> <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Nr</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">tab</span><span class="p">.</span><span class="n">Ni</span><span class="p">;</span>
<span class="linenos">35</span>            <span class="n">ss</span> <span class="p">=</span> <span class="n">tab</span><span class="p">.</span><span class="n">Sr</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">tab</span><span class="p">.</span><span class="n">Si</span><span class="p">;</span>
<span class="linenos">36</span>            <span class="n">zz</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">nk</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="linenos">37</span>
<span class="linenos">38</span>            <span class="c">%% construct model parameters</span>
<span class="linenos">39</span>            <span class="n">j1</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nk</span><span class="p">);</span>
<span class="linenos">40</span>            <span class="n">j2</span> <span class="p">=</span> <span class="n">nk</span><span class="o">+</span><span class="n">j1</span><span class="p">;</span>
<span class="linenos">41</span>            <span class="n">j3</span> <span class="p">=</span> <span class="n">nk</span><span class="o">+</span><span class="n">j2</span><span class="p">;</span>
<span class="linenos">42</span>            <span class="n">obj</span><span class="p">.</span><span class="n">Y</span> <span class="p">=</span> <span class="nb">sparse</span><span class="p">(</span> <span class="p">...</span>
<span class="linenos">43</span>                <span class="p">[</span><span class="n">j1</span> <span class="n">j1</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j2</span> <span class="n">j2</span> <span class="n">j3</span> <span class="n">j3</span> <span class="n">j3</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">44</span>                <span class="p">[</span><span class="n">j1</span> <span class="n">j2</span> <span class="n">j3</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j3</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j3</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">45</span>                <span class="p">[</span><span class="n">y1</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="o">-</span><span class="n">y1</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="n">y2</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="o">-</span><span class="n">y1</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="n">y1</span><span class="p">],</span> <span class="mi">3</span><span class="o">*</span><span class="n">nk</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">nk</span> <span class="p">);</span>
<span class="linenos">46</span>            <span class="n">obj</span><span class="p">.</span><span class="n">L</span> <span class="p">=</span> <span class="nb">sparse</span><span class="p">(</span> <span class="p">...</span>
<span class="linenos">47</span>                <span class="p">[</span><span class="n">j1</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j2</span> <span class="n">j3</span> <span class="n">j3</span> <span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">48</span>                <span class="p">[</span><span class="n">j1</span> <span class="n">j2</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j1</span> <span class="n">j2</span> <span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">49</span>                <span class="p">[</span><span class="n">zz</span><span class="p">;</span> <span class="n">ll</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="o">-</span><span class="n">ll</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="n">zz</span><span class="p">],</span> <span class="mi">3</span><span class="o">*</span><span class="n">nk</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nk</span> <span class="p">);</span>
<span class="linenos">50</span>            <span class="n">obj</span><span class="p">.</span><span class="n">i</span> <span class="p">=</span> <span class="p">[</span><span class="o">-</span><span class="n">ii</span><span class="p">;</span> <span class="n">ii</span><span class="p">;</span> <span class="n">zz</span><span class="p">];</span>
<span class="linenos">51</span>            <span class="n">obj</span><span class="p">.</span><span class="n">M</span> <span class="p">=</span> <span class="nb">sparse</span><span class="p">(</span> <span class="p">...</span>
<span class="linenos">52</span>                <span class="p">[</span><span class="n">j1</span> <span class="n">j1</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j2</span> <span class="n">j2</span> <span class="n">j3</span> <span class="n">j3</span> <span class="n">j3</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">53</span>                <span class="p">[</span><span class="n">j1</span> <span class="n">j2</span> <span class="n">j3</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j3</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j3</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">54</span>                <span class="p">[</span><span class="n">m1</span><span class="p">;</span> <span class="o">-</span><span class="n">m1</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="o">-</span><span class="n">m1</span><span class="p">;</span> <span class="n">m1</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="n">m2</span><span class="p">],</span> <span class="mi">3</span><span class="o">*</span><span class="n">nk</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">nk</span> <span class="p">);</span>
<span class="linenos">55</span>            <span class="n">obj</span><span class="p">.</span><span class="n">N</span> <span class="p">=</span> <span class="nb">sparse</span><span class="p">(</span> <span class="p">...</span>
<span class="linenos">56</span>                <span class="p">[</span><span class="n">j1</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j2</span> <span class="n">j3</span> <span class="n">j3</span> <span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">57</span>                <span class="p">[</span><span class="n">j1</span> <span class="n">j2</span> <span class="n">j1</span> <span class="n">j2</span> <span class="n">j1</span> <span class="n">j2</span> <span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">58</span>                <span class="p">[</span><span class="n">zz</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="n">nn</span><span class="p">;</span> <span class="n">zz</span><span class="p">;</span> <span class="o">-</span><span class="n">nn</span><span class="p">;</span> <span class="n">zz</span><span class="p">],</span> <span class="mi">3</span><span class="o">*</span><span class="n">nk</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nk</span> <span class="p">);</span>
<span class="linenos">59</span>            <span class="n">obj</span><span class="p">.</span><span class="n">s</span> <span class="p">=</span> <span class="p">[</span><span class="n">zz</span><span class="p">;</span> <span class="o">-</span><span class="n">ss</span><span class="p">;</span> <span class="n">ss</span><span class="p">];</span>
<span class="linenos">60</span>        <span class="k">end</span>
<span class="linenos">61</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">62</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>The first method defined by <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_ac</span></code>, namely <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element.add_zvars" title="mp.nm_element.add_zvars"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_zvars()</span></code></a>, adds variables for the real and imaginary parts of the non-voltage state variables, <span class="math notranslate nohighlight">\(\cvec{z}_1\)</span> and <span class="math notranslate nohighlight">\(\cvec{z}_2\)</span>, to the network model, constructing the initial values from the appropriate columns in the data table, and including predefined bounds. We arbitrarily define all gizmos such that their <span class="math notranslate nohighlight">\(\cscal{z}\)</span> variables, <span class="math notranslate nohighlight">\(\cscal{z}_1\)</span> and <span class="math notranslate nohighlight">\(\cscal{z}_2\)</span>, obey <span class="math notranslate nohighlight">\(-k \le \Re\{\cscal{z}_k\} \le k\)</span> and <span class="math notranslate nohighlight">\(-k \le \Im\{\cscal{z}_k\} \le k\)</span>. Note that the variable named <code class="docutils literal notranslate"><span class="pre">Zr1_gizmo</span></code> is vector containing the real part of <span class="math notranslate nohighlight">\(\cscal{z}_1\)</span> for all gizmos in the network. Because the voltage variable representation is different for cartesian and polar formulations, the implementation of <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element.add_vvars" title="mp.nm_element.add_vvars"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_vvars()</span></code></a> is deferred to the formulation-specific subclasses below.</p>
<p>The second method, <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element.build_params" title="mp.nm_element.build_params"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">build_params()</span></code></a>, first calls its parent to build the incidence matrices <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element.C" title="mp.nm_element.C"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">C</span></code></a> and <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element.D" title="mp.nm_element.D"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">D</span></code></a>, then constructs the standard AC model parameters from the data model. The AC model and its parameters are described in <a class="reference internal" href="../../dev-manual/net-model.html#sec-nm-formulations-ac"><span class="std std-ref">AC Formulations</span></a> in the <span class="raw-html"><a class="reference external" href="https://matpower.org/documentation/dev-manual/"><em>M<span style="font-size:smaller">ATPOWER</span> Developer’s Manual</em></a></span>.</p>
<p>Recall that, if we omit the arbitrary nonlinear injection components, <span class="math notranslate nohighlight">\(\Snln(\X)\)</span> or <span class="math notranslate nohighlight">\(\Inln(\X)\)</span>, the standard AC network model for any element type can be defined in terms of the six parameters in the equations below, namely  <span class="math notranslate nohighlight">\(\YY\)</span>, <span class="math notranslate nohighlight">\(\LL\)</span>, <span class="math notranslate nohighlight">\(\MM\)</span>, <span class="math notranslate nohighlight">\(\NN\)</span>, <span class="math notranslate nohighlight">\(\iv\)</span>, and <span class="math notranslate nohighlight">\(\sv\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-eq-ilin-howto-gizmo">
<span class="eqno">(33)<a class="headerlink" href="#equation-eq-ilin-howto-gizmo" title="Link to this equation"></a></span>\[\Ilin(\X) = \YY \V + \LL \Z + \iv\]</div>
<div class="math notranslate nohighlight" id="equation-eq-slin-howto-gizmo">
<span class="eqno">(34)<a class="headerlink" href="#equation-eq-slin-howto-gizmo" title="Link to this equation"></a></span>\[\Slin(\X) = \MM \V + \NN \Z + \sv\]</div>
<p>For a single gizmo, based on <a class="reference internal" href="#fig-gizmo-model"><span class="std std-numref">Figure 2</span></a> and <a class="reference internal" href="#tab-gizmo-components"><span class="std std-numref">Table 2</span></a>, these parameters would be defined as follows.</p>
<div class="math notranslate nohighlight" id="equation-eq-i-lin-howto-gizmo">
<span class="eqno">(35)<a class="headerlink" href="#equation-eq-i-lin-howto-gizmo" title="Link to this equation"></a></span>\[\begin{split}\YY = \left[\begin{array}{ccc}
    \param{\cscal{y}}_1 &amp; 0 &amp; -\param{\cscal{y}}_1 \\
    0 &amp; \param{\cscal{y}}_2 &amp; 0 \\
    \param{-\cscal{y}}_1 &amp; 0 &amp; \param{\cscal{y}}_1
  \end{array}\right],
\LL= \left[\begin{array}{cc}
     0 &amp; \param{\cscal{l}}_g  \\
     0 &amp; -\param{\cscal{l}}_g  \\
     0 &amp; 0
  \end{array}\right],
\iv = \left[\begin{array}{c}
     -\param{\cscal{i}}_g \\
     \param{\cscal{i}}_g \\
     0
  \end{array}\right]\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-s-lin-howto-gizmo">
<span class="eqno">(36)<a class="headerlink" href="#equation-eq-s-lin-howto-gizmo" title="Link to this equation"></a></span>\[\begin{split}\MM = \left[\begin{array}{ccc}
     \param{\cscal{m}}_1 &amp; -\param{\cscal{m}}_1 &amp; 0 \\
     \param{-\cscal{m}}_1 &amp; \param{\cscal{m}}_1 &amp; 0 \\
     0 &amp; 0 &amp; \param{\cscal{m}}_2
  \end{array}\right],
\NN = \left[\begin{array}{cc}
     0 &amp; 0 \\
     \param{\cscal{n}}_g &amp; 0 \\
     -\param{\cscal{n}}_g &amp; 0
  \end{array}\right],
\sv = \left[\begin{array}{c}
     0 \\
     -\param{\cscal{s}}_g \\
     \param{\cscal{s}}_g
  \end{array}\right]\end{split}\]</div>
<p>However, <a class="reference internal" href="../../ref-manual/classes/mp/nm_element.html#mp.nm_element.build_params" title="mp.nm_element.build_params"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">build_params()</span></code></a> must build stacked versions of these matrix and vector parameters that include all <span class="math notranslate nohighlight">\(n_k\)</span> gizmos in the system. For the matrix parameters in <a class="reference internal" href="#equation-eq-i-lin-howto-gizmo">(35)</a> and <a class="reference internal" href="#equation-eq-s-lin-howto-gizmo">(36)</a>, the stacking is done such that each scalar element is replaced by a corresponding <span class="math notranslate nohighlight">\(n_k \times n_k\)</span> diagonal matrix. For the vector parameters, each scalar element becomes an <span class="math notranslate nohighlight">\(n_k \times 1\)</span> vector.</p>
</section>
<section id="ac-cartesian-vs-polar-formulations">
<h3>AC Cartesian vs Polar Formulations<a class="headerlink" href="#ac-cartesian-vs-polar-formulations" title="Link to this heading"></a></h3>
<p>Once the parameters have been built, all of the differences between the cartesian and polar voltage formulations are handled automatically by inheriting from the appropriate formulation class. For the cartesian voltage formulation, we use <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_acc</span></code> which inherits from <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_ac</span></code> and <a class="reference internal" href="../../ref-manual/classes/mp/form_acc.html#mp.form_acc" title="mp.form_acc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.form_acc</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<span id="code-nme-gizmo-acc"></span><div class="code-block-caption"><span class="caption-number">Listing 18 </span><span class="caption-text"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_acc</span></code></span><a class="headerlink" href="#id7" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">classdef</span> <span class="n">nme_gizmo_acc</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">nme_gizmo_ac</span> <span class="o">&amp;</span> <span class="n">mp</span><span class="p">.</span><span class="n">form_acc</span>
<span class="linenos">2</span><span class="k">end</span>
</pre></div>
</div>
</div>
<p>For the polar voltage formulation, we use <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_acp</span></code> which inherits from <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_ac</span></code> and <a class="reference internal" href="../../ref-manual/classes/mp/form_acp.html#mp.form_acp" title="mp.form_acp"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.form_acp</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<span id="code-nme-gizmo-acp"></span><div class="code-block-caption"><span class="caption-number">Listing 19 </span><span class="caption-text"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_gizmo_acp</span></code></span><a class="headerlink" href="#id8" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">classdef</span> <span class="n">nme_gizmo_acp</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">nme_gizmo_ac</span> <span class="o">&amp;</span> <span class="n">mp</span><span class="p">.</span><span class="n">form_acp</span>
<span class="linenos">2</span><span class="k">end</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="mathematical-model-element">
<h2>Mathematical Model Element<a class="headerlink" href="#mathematical-model-element" title="Link to this heading"></a></h2>
<p>Since the gizmo does not introduce any new costs or gizmo-specific contraints, there is no need for an explicit mathematical model element for gizmos.</p>
<p>This is where you would also put any <a class="reference internal" href="../../ref-manual/classes/mp/mm_element.html#mp.mm_element.data_model_update" title="mp.mm_element.data_model_update"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">data_model_update()</span></code></a> methods, but the gizmo does not implement any.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The non-voltage state variables are not updated for the power flow, and in the OPF they have the hard-coded limits defined above.</p>
</div>
</section>
<section id="gizmo-extension">
<h2>Gizmo Extension<a class="headerlink" href="#gizmo-extension" title="Link to this heading"></a></h2>
<p>A <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> extension that incorporates this new element can be found in <a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/xt_gizmo.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/xt_gizmo.m</span></code></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../element.html" class="btn btn-neutral float-left" title="How to Create a New Element Type" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../add-constraint.html" class="btn btn-neutral float-right" title="How to Add an OPF Constraint" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1996-2024, Power Systems Engineering Research Center (PSERC).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>