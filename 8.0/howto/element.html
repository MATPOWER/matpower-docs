<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to Create a New Element Type &mdash; MATPOWER Documentation 8.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../_static/css/matpower.css?v=f6466fd7" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=bb3927b2"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>window.MathJax = {"loader": {"load": ["[tex]/upgreek"]}, "tex": {"packages": {"[+]": ["upgreek"]}, "macros": {"dg": "\\sp\\dagger", "trans": ["{#1}^{\\mathsf{T}}", 1], "conj": ["{#1}^{\\ast}", 1], "hc": ["{#1}^{\\dg}", 1], "hconj": ["{#1}^{+}", 1], "diag": ["\\left[^\\smallsetminus{#1}_\\smallsetminus\\right]", 1], "diagg": ["\\left[\\smash{#1}\\right]", 1], "cdiag": ["\\conj{\\diag{#1}}", 1], "der": ["\\frac{\\partial{#1}}{\\partial{#2}}", 2], "dersx": ["\\frac{\\partial^2{#1}}{\\partial{#2}^2}", 2], "dersxy": ["\\frac{\\partial^2{#1}}{\\partial{#2}\\partial{#3}}", 3], "cscal": ["\\mathrm{#1}", 1], "rvec": ["{\\boldsymbol{#1}}", 1], "cvec": ["\\mathbf{#1}", 1], "rmat": ["{\\boldsymbol{#1}}", 1], "cmat": ["\\mathbf{#1}", 1], "rvecG": ["{\\boldsymbol{#1}}", 1], "cvecG": ["\\boldsymbol{#1}", 1], "rmatG": ["\\boldsymbol{\\mathit{#1}}", 1], "cmatG": ["\\mathbf{#1}", 1], "param": ["\\underline{#1}", 1], "ov": ["{\\overline{#1}}", 1], "zeros": ["\\rvec{0}", 0], "ones": ["\\rvec{1}_{#1}", 1], "onest": ["\\trans{\\rvec{1}}_{#1}", 1], "Id": ["\\diag{\\ones{#1}}", 1], "R": "\\mathbb{R}}         % requires \\usepackage{amsfonts|bbold", "C": "\\mathbb{C}}         % requires \\usepackage{amsfonts", "av": "\\cvec{a}", "bv": "\\cvec{b}", "cv": "\\cvec{c}", "f": "\\cscal{f}", "F": "\\cvec{f}", "g": "\\rvec{g}", "G": "\\cvec{g}", "h": "\\rvec{h}", "HH": "\\cvec{h}", "x": "\\rvec{x}", "y": "\\rvec{y}", "z": "\\rvec{z}", "X": "\\cvec{x}", "Z": "\\cvec{z}", "A": "\\cmat{A}", "B": "\\cmat{B}", "alphav": "\\rvecG{\\alpha}", "lam": "\\rvecG{\\lambda}", "lamh": "\\hat{\\lam}", "muv": "\\rvecG{\\mu}", "muhv": "\\hat{\\muv}", "vv": "\\rvec{v}", "vvi": ["\\cscal{v}_{#1}", 1], "V": "\\cvec{v}", "Vh": "\\hat{\\V}", "Vc": "\\conj{\\V}", "Vhc": "\\conj{\\Vh}", "dV": "\\diag{\\V}", "dVh": "\\diag{\\Vh}", "dVc": "\\diag{\\Vc}", "dVhc": "\\diag{\\Vhc}", "inV": "\\cvec{\\Lambda}", "inVh": "\\hat{\\inV}", "inVc": "\\conj{\\inV}", "inVhc": "\\conj{\\inVh}", "dinV": "\\diagg{\\inV}", "dinVh": "\\diagg{\\inVh}", "dinVc": "\\diagg{\\inVc}", "dinVhc": "\\diagg{\\inVhc}", "va": ["\\theta", 0], "vai": ["\\va_{#1}", 1], "Va": ["\\rvec{\\va}", 0], "Vah": ["\\hat{\\Va}", 0], "vm": ["\\nu", 0], "vmi": ["\\nu_{#1}", 1], "Vm": ["\\rvecG{\\nu}", 0], "dVm": "\\diag{\\Vm}", "dVmi": "\\dVm^{-1}", "Vmh": "\\hat{\\Vm}", "dVmh": "\\diag{\\Vmh}", "dVmhi": "\\dVmh^{-1}", "vr": "u", "vri": ["u_{#1}", 1], "vi": "w", "vii": ["w_{#1}", 1], "Vr": "\\rvec{u}", "Vi": "\\rvec{w}", "dVr": "\\diag{\\Vr}", "dVi": "\\diag{\\Vi}", "Vrh": "\\hat{\\Vr}", "Vih": "\\hat{\\Vi}", "dVrh": "\\diag{\\Vrh}", "dVih": "\\diag{\\Vih}", "E": "\\cvec{e}", "Eh": "\\hat{\\E}", "Ec": "\\conj{\\E}", "Ehc": "\\conj{\\Eh}", "dE": "\\diag{\\E}", "dEh": "\\diag{\\Eh}", "dEc": "\\diag{\\Ec}", "dEhc": "\\diag{\\Ehc}", "zr": "{z_r}", "zi": "{z_i}", "Zr": "{\\rvec{z}_r}", "Zi": "{\\rvec{z}_i}", "dlam": "\\diagg{\\lam}", "dlamh": "\\diagg{\\lamh}", "dlamva": "\\diagg{\\lam_\\va}", "dlamvm": "\\diagg{\\lam_\\vm}", "dlamvr": "\\diagg{\\lam_\\vr}", "dlamvi": "\\diagg{\\lam_\\vi}", "dlamzr": "\\diagg{\\lam_\\zr}", "dlamzi": "\\diagg{\\lam_\\zi}", "dlamhva": "\\diagg{\\lamh_\\va}", "dlamhvm": "\\diagg{\\lamh_\\vm}", "dlamhvr": "\\diagg{\\lamh_\\vr}", "dlamhvi": "\\diagg{\\lamh_\\vi}", "dlamhzr": "\\diagg{\\lamh_\\zr}", "dlamhzi": "\\diagg{\\lamh_\\zi}", "dmu": "\\diag{\\muv}", "dmuh": "\\diag{\\muhv}", "kk": "\\rvec{k}", "J": "\\param{\\rmat{J}}", "Jt": "\\trans{\\J}", "Jk": ["\\J_{\\kk_#1}", 1], "Ah": "\\hat{\\A}", "Fh": "\\hat{\\F}", "Gh": "\\hat{\\G}", "gh": "\\hat{\\g}", "fmax": "\\param{\\rvec{f}}_\\mathrm{max}", "gP": "\\g^P", "gPk": ["\\g^{P,#1}", 1], "fhmax": "\\hat{\\param{\\rvec{f}}}_\\mathrm{max}", "ghP": "\\gh^P", "ghPk": ["\\gh^{P,#1}", 1], "GS": "\\G^S", "GI": "\\G^I", "GSk": ["\\G^{S,#1}", 1], "GIk": ["\\G^{I,#1}", 1], "GSsys": "\\GSk{\\mathrm{sys}}", "GIsys": "\\GIk{\\mathrm{sys}}", "gPsys": "\\gPk{\\mathrm{sys}}", "GhS": "\\Gh^S", "GhI": "\\Gh^I", "GhSk": ["\\Gh^{S,#1}", 1], "GhIk": ["\\Gh^{I,#1}", 1], "GhSsys": "\\GhSk{\\mathrm{sys}}", "GhIsys": "\\GhIk{\\mathrm{sys}}", "ghPsys": "\\ghPk{\\mathrm{sys}}", "Ilin": "\\cvec{i}^{lin}", "Ilink": "\\cvec{i}^{lin, k}", "Ilinc": "\\conj{\\Ilin}", "dIlin": "\\diag{\\Ilin}", "dIlinc": "\\diag{\\Ilinc}", "Ilinh": "\\hat{{\\cvec{i}}}^{lin}", "Ilinhk": "\\hat{\\cvec{i}}^{lin, k}", "Ilinhc": "\\conj{\\Ilinh}", "dIlinh": "\\diag{\\Ilinh}", "dIlinhc": "\\diag{\\Ilinhc}", "Slin": "\\cvec{s}^{lin}", "Slink": "\\cvec{s}^{lin, k}", "Slinc": "\\conj{\\Slin}", "dSlin": "\\diag{\\Slin}", "dSlinc": "\\diag{\\Slinc}", "Slinh": "\\hat{\\cvec{s}}^{lin}", "Slinhk": "\\hat{\\cvec{s}}^{lin, k}", "Slinhc": "\\conj{\\Slinh}", "dSlinh": "\\diag{\\Slinh}", "dSlinhc": "\\diag{\\Slinhc}", "Inln": "\\cvec{i}^{nln}", "Inlnk": "\\cvec{i}^{nln, k}", "Snln": "\\cvec{s}^{nln}", "Snlnk": "\\cvec{s}^{nln, k}", "Inlnh": "\\hat{\\cvec{i}}^{nln}", "Inlnhk": "\\hat{\\cvec{i}}^{nln, k}", "Snlnh": "\\hat{\\cvec{s}}^{nln}", "Snlnhk": "\\hat{\\cvec{s}}^{nln, k}", "Aa": "\\param{\\rmat{A}}", "BB": "\\param{\\rmat{B}}", "CC": "\\param{\\rmat{C}}", "DD": "\\param{\\rmat{D}}", "YY": "\\param{\\cmat{Y}}", "iv": "\\param{\\cvec{i}}", "pv": "\\param{\\rvec{p}}", "sv": "\\param{\\cvec{s}}", "KK": "\\param{\\rmat{K}}", "LL": "\\param{\\cmat{L}}", "MM": "\\param{\\cmat{M}}", "NN": "\\param{\\cmat{N}}", "BBh": "\\hat{\\BB}", "YYh": "\\hat{\\YY}", "ivh": "\\hat{\\iv}", "pvh": "\\hat{\\pv}", "svh": "\\hat{\\sv}", "CCh": "\\hat{\\CC}", "KKh": "\\hat{\\KK}", "LLh": "\\hat{\\LL}", "MMh": "\\hat{\\MM}", "NNh": "\\hat{\\NN}", "AT": "\\trans{\\Aa}", "CT": "\\trans{\\CC}", "DT": "\\trans{\\DD}", "Ap": "\\Aa'", "Cp": "\\CC\\:\\!'", "Dp": "\\DD'", "ApT": "\\trans{\\Ap}", "CpT": "\\trans{\\Cp}", "DpT": "\\trans{\\Dp}", "ChT": "\\trans{\\CCh}", "Lc": "\\conj{\\LL}", "LcT": "\\trans{\\Lc}", "Lhc": "\\conj{\\LLh}", "LhcT": "\\trans{\\Lhc}", "MT": "\\trans{\\MM}", "Mc": "\\conj{\\MM}", "McT": "\\trans{\\Mc}", "dMTlam": "\\diag{\\MT \\lam}", "MhT": "\\trans{\\MMh}", "Mhc": "\\conj{\\MMh}", "MhcT": "\\trans{\\Mhc}", "dMhTlam": "\\diag{\\MhT \\lamh}", "Nc": "\\conj{\\NN}", "NcT": "\\trans{\\Nc}", "Nhc": "\\conj{\\NNh}", "NhcT": "\\trans{\\Nhc}", "YT": "\\trans{\\YY}", "Yc": "\\conj{\\YY}", "YcT": "\\trans{\\Yc}", "dYTlam": "\\diag{\\YT \\lam}", "YhT": "\\trans{\\YYh}", "Yhc": "\\conj{\\YYh}", "YhcT": "\\trans{\\Yhc}", "dYhTlam": "\\diag{\\YhT \\lamh}", "I": "\\cvec{i}^S", "s": "\\cvec{s}^I", "Ih": "\\hat{\\cvec{i}}^S", "Sh": "\\hat{\\cvec{s}}^I", "AtX": "\\AT \\X", "CtV": "\\CT \\V", "dCtV": "\\diag{\\CtV}", "DtZ": "\\DT \\Z", "ApTx": "\\ApT \\x", "CpTv": "\\CpT \\vv", "DpTz": "\\DpT \\z"}}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="A Test Gizmo Element Type" href="gizmo-element/index.html" />
    <link rel="prev" title="mpoption_info_most" href="../most/functions/mpoption_info_most.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #568085" >

          
          
          <a href="../index.html" class="icon icon-home">
            MATPOWER Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org">matpower.org</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/about/get-started/">Get Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Manuals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../users-manual/index.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-manual/index.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> Developer’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref-manual/index.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> Reference Manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mptest/index.html">MP-Test User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mips/index.html">MIPS User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mpom/index.html"><span class="raw-html">MP-Opt-Model</span> User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../most/index.html">MOST User’s Manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/doc/manuals/">All Legacy PDF Manuals</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How To Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to Create a New Element Type</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dc-transmission-line">DC Transmission Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-model-element">Data Model Element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#naming">Naming</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connectivity">Connectivity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-data-table">Main Data Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-values">Output Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-element-in-stages">Building the Element in Stages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pretty-printing">Pretty Printing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opf-subclass">OPF Subclass</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-model-converter-element">Data Model Converter Element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#main-field-in-data-source">Main Field in Data Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#table-variable-map">Table Variable Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-import-export-functions">Custom Import/Export Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#network-model-element">Network Model Element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#all-formulations">All Formulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ac-formulations">AC Formulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ac-cartesian-vs-polar-formulations">AC Cartesian vs Polar Formulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dc-formulation">DC Formulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mathematical-model-element">Mathematical Model Element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#all-tasks-and-formulations">All Tasks and Formulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#power-flow">Power Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimal-power-flow">Optimal Power Flow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-model-update">Data Model Update</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-new-element">Using the New Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a><ul>
<li class="toctree-l3"><a class="reference internal" href="gizmo-element/index.html">A Test Gizmo Element Type</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="add-constraint.html">How to Add an OPF Constraint</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension.html">How to Create an Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="three-phase.html">How to Run a Three-Phase Power Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="builddocs.html">How to Build the Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tech Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tech-notes.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> Technical Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/sponsor">Donate</a></li>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/download">Downloads</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/MATPOWER/matpower">GitHub Project</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #568085" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MATPOWER Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to Create a New Element Type</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/howto/element.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="../most/functions/mpoption_info_most.html" class="btn btn-neutral float-left" title="mpoption_info_most" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gizmo-element/index.html" class="btn btn-neutral float-right" title="A Test Gizmo Element Type" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-create-a-new-element-type">
<span id="howto-element"></span><h1>How to Create a New Element Type<a class="headerlink" href="#how-to-create-a-new-element-type" title="Link to this heading"></a></h1>
<p>This guide demonstrates how to create a new element type. <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> includes implementations of numerous standard element types such as buses, generators, loads, transmission lines, transformers, etc. For this discussion, we use a DC transmission line model, equivalent to the one described in Section 7.6.3 of the legacy <span class="raw-html"><a href="https://matpower.org/docs/MATPOWER-manual-8.0.pdf">M<span style="font-size:smaller">ATPOWER</span> User's Manual</a></span>.</p>
<section id="dc-transmission-line">
<h2>DC Transmission Line<a class="headerlink" href="#dc-transmission-line" title="Link to this heading"></a></h2>
<p>The model used here for a DC transmission line is a 2-port model with a 2 non-voltage states. That is, each DC line connects to exactly 2 buses, and there are two additional complex states representing the complex power injections at the ports. In addition, each DC line is assumed to have an active power loss <span class="math notranslate nohighlight">\(p_\mathrm{loss}\)</span> that is a linear function of the active power <span class="math notranslate nohighlight">\(p_1\)</span> at the <em>from</em> bus.</p>
<div class="math notranslate nohighlight" id="equation-eq-legacy-dcline-power-loss">
<span class="eqno">(24)<a class="headerlink" href="#equation-eq-legacy-dcline-power-loss" title="Link to this equation"></a></span>\[p_\mathrm{loss} = \param{l}_0 + \param{l}_1 p_1\]</div>
<figure class="align-center" id="id1">
<span id="fig-legacy-dcline-model"></span><a class="reference internal image-reference" href="../_images/dc-line-model-AC.png"><img alt="AC Model for DC Line" src="../_images/dc-line-model-AC.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 1 </span><span class="caption-text">AC Model for DC Line</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#fig-legacy-dcline-model"><span class="std std-numref">Figure 1</span></a> shows a diagram of the 2-port DC line, where the port power injections are given by the following equations,</p>
<div class="math notranslate nohighlight" id="equation-eq-legacy-dcline-port-power">
<span class="eqno">(25)<a class="headerlink" href="#equation-eq-legacy-dcline-port-power" title="Link to this equation"></a></span>\[\begin{split}\cscal{s}_1 &amp;= \param{\cscal{n}}_1 \cscal{z}_1 \\
\cscal{s}_2 &amp;= \param{\cscal{n}}_2 \cscal{z}_2.\end{split}\]</div>
<p>In this case, the parameters <span class="math notranslate nohighlight">\(\param{\cscal{n}}_1\)</span> and <span class="math notranslate nohighlight">\(\param{\cscal{n}}_2\)</span> are both equal to 1. In addition, we have the following constraint on the active and reactive port power injections, where <span class="math notranslate nohighlight">\(\cscal{s}_k = p_k + j q_k\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-eq-legacy-dcline-power-constraint">
<span class="eqno">(26)<a class="headerlink" href="#equation-eq-legacy-dcline-power-constraint" title="Link to this equation"></a></span>\[\begin{split}p_2 &amp;= -p_1 +  p_\mathrm{loss} \\
&amp;= (\param{l}_1 - 1) p_1 + \param{l}_0\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-legacy-dcline-p-bounds">
<span class="eqno">(27)<a class="headerlink" href="#equation-eq-legacy-dcline-p-bounds" title="Link to this equation"></a></span>\[\param{p}^\mathrm{min}_1 \le p_1 \le \param{p}^\mathrm{max}_1\]</div>
<div class="math notranslate nohighlight" id="equation-eq-legacy-dcline-q-bounds">
<span class="eqno">(28)<a class="headerlink" href="#equation-eq-legacy-dcline-q-bounds" title="Link to this equation"></a></span>\[\begin{split}\param{q}^\mathrm{min}_1 \le q_1 \le \param{q}^\mathrm{max}_1 \\
\param{q}^\mathrm{min}_2 \le q_2 \le \param{q}^\mathrm{max}_2\end{split}\]</div>
<p>For power flow problems, each of the connected buses can be specified as a PV bus, with specified voltage magnitude setpoint. For OPF problems, a cost may be applied to the <em>from</em> end active injection.</p>
<p>Creating a new element type involves defining and implmementing the corresponding classes for each layer (data, network, and mathematical) of modeling, as well as a corresponding data converter element for each data format. Each of these classes has a <code class="xref mat mat-meth docutils literal notranslate"><span class="pre">name()</span></code> method that returns the same value, linking them to one another and together defining the DC line element type. That is, in each type of element class, you will see the following method defined.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>name<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;legacy_dcline&#39;</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="data-model-element">
<h2>Data Model Element<a class="headerlink" href="#data-model-element" title="Link to this heading"></a></h2>
<p>We begin with the data model element, whose role and structure is described in <a class="reference internal" href="../dev-manual/data-model.html#sec-dm-element"><span class="std std-ref">Data Model Elements</span></a> in the <a class="reference internal" href="../dev-manual/index.html#matpower-dev-manual"><span class="std std-ref">MATPOWER Developer’s Manual</span></a>. This is where you define each piece of data that corresponds to the element. All elements include a unique identifier, a name, and a status flag. Most elements are connected to other elements (e.g. buses) and the connectivity data (e.g. IDs of connected buses) are included in the data model. Any device parameters, either physical or operational are also included, along with any input and/or solution values of the state of the element.</p>
<p>For each DC line, the data consists of the two buses to which its ports are connected, a status flag, active and reactive flows at each end, voltage set points at each end, upper and lower limits on the active and reactive injections, the two loss coefficients, and, for OPF problems, shadow prices on the injection bounds.</p>
<p>Since some pieces of data are only needed for the OPF, we define the base data model element for the DC line in the <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_dcline</span></code> class, and extend it via <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_dcline_opf</span></code> to include the data required for the OPF.</p>
<p>This data is stored in the main data table in the <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.tab" title="mp.dm_element.tab"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tab</span></code></a> property of the data model element object of type <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_dcline</span></code>. This is a MATLAB <a class="reference external" href="https://www.mathworks.com/help/matlab/ref/table.html"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">table</span></code></a> object, or an <a class="reference internal" href="../ref-manual/classes/mp_table.html#mp_table" title="mp_table"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp_table</span></code></a> object if running in Octave. The names of the columns in <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.tab" title="mp.dm_element.tab"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tab</span></code></a> are shown in <a class="reference internal" href="#tab-legacy-dcline-data-model"><span class="std std-numref">Table 1</span></a> below. Each row in <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.tab" title="mp.dm_element.tab"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tab</span></code></a> corresponds to an individual DC line, which means there is a single instance of a DC line data model element object to hold the data for all DC lines in the system.</p>
<blockquote>
<div><span id="tab-legacy-dcline-data-model"></span><table class="longtable docutils align-default" id="id2">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">DC Line Data Model</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 22.0%" />
<col style="width: 78.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column Names</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bus_fr</span></code>, <code class="docutils literal notranslate"><span class="pre">bus_to</span></code></p></td>
<td><p>bus numbers for the <em>from</em> port (1) and <em>to</em> port (2) connections, respectively</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">loss0</span></code>, <code class="docutils literal notranslate"><span class="pre">loss1</span></code></p></td>
<td><p>loss coefficient parameters <span class="math notranslate nohighlight">\(\param{\cscal{l}}_0\)</span> and <span class="math notranslate nohighlight">\(\param{\cscal{l}}_1\)</span>, respectively</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">vm_setpoint_fr</span></code>, <code class="docutils literal notranslate"><span class="pre">vm_setpoint_to</span></code></p></td>
<td><p>voltage magnitude set points in p.u. for <em>from</em> and <em>to</em> buses, respectively</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">p_fr_lb</span></code>, <code class="docutils literal notranslate"><span class="pre">p_fr_ub</span></code></p></td>
<td><p>lower and upper bounds, <span class="math notranslate nohighlight">\(\param{p}^\mathrm{min}_1\)</span> and <span class="math notranslate nohighlight">\(\param{p}^\mathrm{max}_1\)</span>, on active power injection at <em>from</em> bus (port 1)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">q_fr_lb</span></code>, <code class="docutils literal notranslate"><span class="pre">q_fr_ub</span></code></p></td>
<td><p>lower and upper bounds, <span class="math notranslate nohighlight">\(\param{q}^\mathrm{min}_1\)</span> and <span class="math notranslate nohighlight">\(\param{q}^\mathrm{max}_1\)</span>, on reactive power injection at <em>from</em> bus (port 1)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">q_to_lb</span></code>, <code class="docutils literal notranslate"><span class="pre">q_to_ub</span></code></p></td>
<td><p>lower and upper bounds, <span class="math notranslate nohighlight">\(\param{q}^\mathrm{min}_2\)</span> and <span class="math notranslate nohighlight">\(\param{q}^\mathrm{max}_1\)</span>, on reactive power injection at <em>to</em> bus (port 2)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">p_fr</span></code>, <code class="docutils literal notranslate"><span class="pre">q_fr</span></code></p></td>
<td><p>active and reactive injections, <span class="math notranslate nohighlight">\(p_1\)</span> and <span class="math notranslate nohighlight">\(q_1\)</span>, at <em>from</em> port</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">p_to</span></code>, <code class="docutils literal notranslate"><span class="pre">q_to</span></code></p></td>
<td><p>active and reactive injections, <span class="math notranslate nohighlight">\(p_2\)</span> and <span class="math notranslate nohighlight">\(q_2\)</span>, at <em>to</em> port</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><a class="reference internal" href="#code-dme-legacy-dcline"><span class="std std-numref">Listing 1</span></a> shows the source code for <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline" title="mp.dme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_legacy_dcline</span></code></a>. The first thing to notice is that, as with all data model element classes, it inherits from <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element" title="mp.dm_element"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dm_element</span></code></a>. Please see the <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element" title="mp.dm_element"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dm_element</span></code></a> reference documentation for an overview of the functionality provided and for more details on the methods overridden by <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline" title="mp.dme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_legacy_dcline</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<span id="code-dme-legacy-dcline"></span><div class="code-block-caption"><span class="caption-number">Listing 1 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline" title="mp.dme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_legacy_dcline</span></code></a></span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="n">dme_legacy_dcline</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span>
<span class="linenos"> 2</span>    <span class="k">properties</span>
<span class="linenos"> 3</span>        <span class="n">fbus</span>    <span class="c">% bus index vector for &quot;from&quot; port (port 1) (all DC lines)</span>
<span class="linenos"> 4</span>        <span class="n">tbus</span>    <span class="c">% bus index vector for &quot;to&quot; port (port 2) (all DC lines)</span>
<span class="linenos"> 5</span>        <span class="n">fbus_on</span> <span class="c">% vector of &quot;from&quot; bus indices into online buses (in-service DC lines)</span>
<span class="linenos"> 6</span>        <span class="n">tbus_on</span> <span class="c">% vector of &quot;to&quot; bus indices into online buses (in-service DC lines)</span>
<span class="linenos"> 7</span>        <span class="n">loss0</span>   <span class="c">% constant term of loss function (p.u.) (in-service DC lines)</span>
<span class="linenos"> 8</span>        <span class="n">loss1</span>   <span class="c">% linear coefficient of loss function (in-service DC lines)</span>
<span class="linenos"> 9</span>        <span class="n">p_fr_start</span>  <span class="c">% initial active power (p.u.) at &quot;from&quot; port (in-service DC lines)</span>
<span class="linenos">10</span>        <span class="n">p_to_start</span>  <span class="c">% initial active power (p.u.) at &quot;to&quot; port (in-service DC lines)</span>
<span class="linenos">11</span>        <span class="n">q_fr_start</span>  <span class="c">% initial reactive power (p.u.) at &quot;from&quot; port (in-service DC lines)</span>
<span class="linenos">12</span>        <span class="n">q_to_start</span>  <span class="c">% initial reactive power (p.u.) at &quot;to&quot; port (in-service DC lines)</span>
<span class="linenos">13</span>        <span class="n">vm_setpoint_fr</span>  <span class="c">% from bus voltage magnitude setpoint (p.u.) (in-service DC lines)</span>
<span class="linenos">14</span>        <span class="n">vm_setpoint_to</span>  <span class="c">% to bus voltage magnitude setpoint (p.u.) (in-service DC lines)</span>
<span class="linenos">15</span>        <span class="n">p_fr_lb</span> <span class="c">% p.u. lower bound on active power flow at &quot;from&quot; port (in-service DC lines)</span>
<span class="linenos">16</span>        <span class="n">p_fr_ub</span> <span class="c">% p.u. upper bound on active power flow at &quot;from&quot; port (in-service DC lines)</span>
<span class="linenos">17</span>        <span class="n">q_fr_lb</span> <span class="c">% p.u. lower bound on reactive power flow at &quot;from&quot; port (in-service DC lines)</span>
<span class="linenos">18</span>        <span class="n">q_fr_ub</span> <span class="c">% p.u. upper bound on reactive power flow at &quot;from&quot; port (in-service DC lines)</span>
<span class="linenos">19</span>        <span class="n">q_to_lb</span> <span class="c">% p.u. lower bound on reactive power flow at &quot;to&quot; port (in-service DC lines)</span>
<span class="linenos">20</span>        <span class="n">q_to_ub</span> <span class="c">% p.u. upper bound on reactive power flow at &quot;to&quot; port (in-service DC lines)</span>
<span class="linenos">21</span>    <span class="k">end</span>     <span class="c">%% properties</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="k">methods</span>
<span class="linenos">24</span>        <span class="k">function</span> <span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">25</span>            <span class="n">name</span> <span class="p">=</span> <span class="s">&#39;legacy_dcline&#39;</span><span class="p">;</span>
<span class="linenos">26</span>        <span class="k">end</span>
<span class="linenos">27</span>
<span class="linenos">28</span>        <span class="c">% (other methods listed and described individually below)</span>
<span class="linenos">29</span>
<span class="linenos">30</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">31</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>For element types that connect to one or more buses, it is typical to define a property for each port in the data model element class. In our case, there are two properties, <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.fbus" title="mp.dme_legacy_dcline.fbus"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">fbus</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.tbus" title="mp.dme_legacy_dcline.tbus"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tbus</span></code></a>, which will hold bus index vectors for ports 1 and 2, respectively. That is <code class="docutils literal notranslate"><span class="pre">dme.tbus(k)</span></code> will refer to the index of the bus connected to port 2, the <em>to</em> bus, of the DC line defined in row <em>k</em> of the data table.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The contents of <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.fbus" title="mp.dme_legacy_dcline.fbus"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">fbus</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.tbus" title="mp.dme_legacy_dcline.tbus"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tbus</span></code></a> are not bus IDs, that is external bus numbers, but rather internal indices of the corresponding buses, that is, row indices into <code class="docutils literal notranslate"><span class="pre">dm.elements.bus.tab</span></code>, the table of all buses in the bus data model element object.</p>
</div>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.fbus_on" title="mp.dme_legacy_dcline.fbus_on"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">fbus_on</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.tbus_on" title="mp.dme_legacy_dcline.tbus_on"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tbus_on</span></code></a> properties, on the other, hand map in-service DC lines to the in-service buses. That is <code class="docutils literal notranslate"><span class="pre">dme.fbus_on(k)</span></code> is the index into the list of in-service buses for the bus connected to port 1, the <em>from</em> bus, of the <em>k</em>-th in-service DC line.</p>
<p>The other properties correspond to the respective columns in the data table, but after removing DC lines that are out-of-service and, in some cases, converting to per unit. Those that end in <code class="docutils literal notranslate"><span class="pre">_start</span></code> are for the initial value of the respective variable.</p>
<section id="naming">
<h3>Naming<a class="headerlink" href="#naming" title="Link to this heading"></a></h3>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.name" title="mp.dm_element.name"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">name()</span></code></a> method returns <code class="docutils literal notranslate"><span class="pre">'legacy_dcline'</span></code>, the name used internally for this element type. The <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.label" title="mp.dm_element.label"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">label()</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.labels" title="mp.dm_element.labels"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">labels()</span></code></a> methods provide strings to use for singular and plural user visible labels to use when displaying DC line elements.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-name-labels"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>name<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;legacy_dcline&#39;</span><span class="p">;</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>label<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">label</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">label</span> <span class="p">=</span> <span class="s">&#39;DC Line&#39;</span><span class="p">;</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>label<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">labels</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">label</span> <span class="p">=</span> <span class="s">&#39;DC Lines&#39;</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="connectivity">
<h3>Connectivity<a class="headerlink" href="#connectivity" title="Link to this heading"></a></h3>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.cxn_type" title="mp.dm_element.cxn_type"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">cxn_type()</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.cxn_idx_prop" title="mp.dm_element.cxn_idx_prop"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">cxn_idx_prop()</span></code></a> methods specify that <code class="docutils literal notranslate"><span class="pre">'legacy_dcline'</span></code> objects connect to <code class="docutils literal notranslate"><span class="pre">'bus'</span></code> objects, and that the corresponding bus indices for ports 1 and 2 can be found in properties <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.fbus" title="mp.dme_legacy_dcline.fbus"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">fbus</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.tbus" title="mp.dme_legacy_dcline.tbus"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tbus</span></code></a>, respectively.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-cxn"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>name<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">cxn_type</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">name</span> <span class="p">=</span> <span class="s">&#39;bus&#39;</span><span class="p">;</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>name<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">cxn_idx_prop</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">name</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;fbus&#39;</span><span class="p">,</span> <span class="s">&#39;tbus&#39;</span><span class="p">};</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="main-data-table">
<h3>Main Data Table<a class="headerlink" href="#main-data-table" title="Link to this heading"></a></h3>
<p>The names of the columns in the DC line’s main data table are defined by the return value of <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.main_table_var_names" title="mp.dm_element.main_table_var_names"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">main_table_var_names()</span></code></a>. Note that it is important to call the parent method to include inherited column names, in particular, those common to all data model elements (i.e. <code class="docutils literal notranslate"><span class="pre">'uid'</span></code>, <code class="docutils literal notranslate"><span class="pre">'name'</span></code>, <code class="docutils literal notranslate"><span class="pre">'status'</span></code>, <code class="docutils literal notranslate"><span class="pre">'source_uid'</span></code>).</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-main-table-var-names"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>names<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">main_table_var_names</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">names</span> <span class="p">=</span> <span class="nb">horzcat</span><span class="p">(</span> <span class="n">main_table_var_names</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="p">...</span>
        <span class="p">{</span><span class="s">&#39;bus_fr&#39;</span><span class="p">,</span> <span class="s">&#39;bus_to&#39;</span><span class="p">,</span> <span class="s">&#39;loss0&#39;</span><span class="p">,</span> <span class="s">&#39;loss1&#39;</span><span class="p">,</span> <span class="p">...</span>
        <span class="s">&#39;vm_setpoint_fr&#39;</span><span class="p">,</span> <span class="s">&#39;vm_setpoint_to&#39;</span><span class="p">,</span> <span class="p">...</span>
        <span class="s">&#39;p_fr_lb&#39;</span><span class="p">,</span> <span class="s">&#39;p_fr_ub&#39;</span><span class="p">,</span> <span class="p">...</span>
        <span class="s">&#39;q_fr_lb&#39;</span><span class="p">,</span> <span class="s">&#39;q_fr_ub&#39;</span><span class="p">,</span> <span class="s">&#39;q_to_lb&#39;</span><span class="p">,</span> <span class="s">&#39;q_to_ub&#39;</span><span class="p">,</span> <span class="p">...</span>
        <span class="s">&#39;p_fr&#39;</span><span class="p">,</span> <span class="s">&#39;q_fr&#39;</span><span class="p">,</span> <span class="s">&#39;p_to&#39;</span><span class="p">,</span> <span class="s">&#39;q_to&#39;</span><span class="p">}</span> <span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="output-values">
<h3>Output Values<a class="headerlink" href="#output-values" title="Link to this heading"></a></h3>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.export_vars" title="mp.dm_element.export_vars"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">export_vars()</span></code></a> method returns the names of the columns in the table that should be exported back to the data source after solving. That is, it is the list of output columns whose values may have been updated by running the task. In this case, it only includes the active and reactive injections at the ports.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-export-vars"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>vars<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">export_vars</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">vars</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;p_fr&#39;</span><span class="p">,</span> <span class="s">&#39;q_fr&#39;</span><span class="p">,</span> <span class="s">&#39;p_to&#39;</span><span class="p">,</span> <span class="s">&#39;q_to&#39;</span><span class="p">};</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The entries in the struct returned by <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.export_vars_offline_val" title="mp.dm_element.export_vars_offline_val"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">export_vars_offline_val()</span></code></a> specify values to assign to fields in out-of-service DC lines. Specifically, we set all of the active and reactive flows to 0 for DC lines that are out-of-service.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-export-vars-offline-val"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>s<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">export_vars_offline_val</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">s</span> <span class="p">=</span> <span class="n">export_vars_offline_val</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>     <span class="c">%% call parent</span>
    <span class="n">s</span><span class="p">.</span><span class="n">p_fr</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">s</span><span class="p">.</span><span class="n">q_fr</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">s</span><span class="p">.</span><span class="n">p_to</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">s</span><span class="p">.</span><span class="n">q_to</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="building-the-element-in-stages">
<h3>Building the Element in Stages<a class="headerlink" href="#building-the-element-in-stages" title="Link to this heading"></a></h3>
<p>When a data model object and its elements are created, they are built in the stages described in <a class="reference internal" href="../dev-manual/data-model.html#sec-building-data-model"><span class="std std-ref">Building a Data Model</span></a> in the <a class="reference internal" href="../dev-manual/index.html#matpower-dev-manual"><span class="std std-ref">MATPOWER Developer’s Manual</span></a>.</p>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.initialize" title="mp.dm_element.initialize"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">initialize()</span></code></a> method is called during the <strong>initialize</strong> stage. It takes advantage of the bus ID-to-index mapping available from the <code class="docutils literal notranslate"><span class="pre">'bus'</span></code> data model element object to populate the  <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.fbus" title="mp.dme_legacy_dcline.fbus"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">fbus</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline.tbus" title="mp.dme_legacy_dcline.tbus"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tbus</span></code></a> properties from the corresponding columns in the main data table.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-initialize"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span>obj, dm<span class="p">)</span>
<span class="w">    </span><span class="n">initialize</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">);</span>  <span class="c">%% call parent</span>

    <span class="c">%% get bus mapping info</span>
    <span class="n">b2i</span> <span class="p">=</span> <span class="n">dm</span><span class="p">.</span><span class="n">elements</span><span class="p">.</span><span class="n">bus</span><span class="p">.</span><span class="n">ID2i</span><span class="p">;</span>     <span class="c">%% bus num to idx mapping</span>

    <span class="c">%% set bus index vectors for port connectivity</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">fbus</span> <span class="p">=</span> <span class="n">b2i</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">bus_fr</span><span class="p">);</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">tbus</span> <span class="p">=</span> <span class="n">b2i</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">bus_to</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.update_status" title="mp.dm_element.update_status"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">update_status()</span></code></a> method, called during the <strong>update status</strong> stage, updates the default online/offline status, which has already been initialized from the <code class="docutils literal notranslate"><span class="pre">status</span></code> column of the main data table, to remove from service any DC line that is connected to an offline bus. After calling the parent method to populate the <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.on" title="mp.dm_element.on"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">on</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.off" title="mp.dm_element.off"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">off</span></code></a> properties, this method also updates some data in the bus data model element object to set the bus type for DC terminal buses to PV and turn on their voltage-controlled flag.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-update-status"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">update_status</span><span class="p">(</span>obj, dm<span class="p">)</span>
<span class="w">    </span><span class="c">%</span>

    <span class="c">%% get bus status info</span>
    <span class="n">bus_dme</span> <span class="p">=</span> <span class="n">dm</span><span class="p">.</span><span class="n">elements</span><span class="p">.</span><span class="n">bus</span><span class="p">;</span>
    <span class="n">bs</span> <span class="p">=</span> <span class="n">bus_dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>    <span class="c">%% bus status</span>

    <span class="c">%% update status of branches connected to isolated/offline buses</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">status</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">bs</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">fbus</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">...</span>
                                      <span class="n">bs</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tbus</span><span class="p">);</span>

    <span class="c">%% call parent to fill in on/off</span>
    <span class="n">update_status</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">);</span>

    <span class="c">%% for all online DC lines ...</span>
    <span class="c">%% ... set terminal buses (except ref) to PV type</span>
    <span class="n">idx</span> <span class="p">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">.</span><span class="n">fbus</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">);</span> <span class="n">obj</span><span class="p">.</span><span class="n">tbus</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)];</span> <span class="c">%% all terminal buses</span>
    <span class="n">idx</span><span class="p">(</span><span class="n">bus_dme</span><span class="p">.</span><span class="nb">type</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">mp</span><span class="p">.</span><span class="n">NODE_TYPE</span><span class="p">.</span><span class="n">REF</span><span class="p">)</span> <span class="p">=</span> <span class="p">[];</span>    <span class="c">%% except ref</span>
    <span class="n">bus_dme</span><span class="p">.</span><span class="n">set_bus_type_pv</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>

    <span class="c">%% set bus_dme.vm_control</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">fbus_on</span> <span class="p">=</span> <span class="n">bus_dme</span><span class="p">.</span><span class="n">i2on</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">fbus</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">));</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">tbus_on</span> <span class="p">=</span> <span class="n">bus_dme</span><span class="p">.</span><span class="n">i2on</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tbus</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">));</span>
    <span class="n">bus_dme</span><span class="p">.</span><span class="n">vm_control</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">fbus_on</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">bus_dme</span><span class="p">.</span><span class="n">vm_control</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tbus_on</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Note that both <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.initialize" title="mp.dm_element.initialize"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">initialize()</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.update_status" title="mp.dm_element.update_status"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">update_status()</span></code></a> rely on the fact that the respective methods have already been called for <code class="docutils literal notranslate"><span class="pre">'bus'</span></code> objects, before they are called for <code class="docutils literal notranslate"><span class="pre">'legacy_dcline'</span></code> objects. The order corresponds to their order in <a class="reference internal" href="../ref-manual/classes/mp/element_container.html#mp.element_container.element_classes" title="mp.element_container.element_classes"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">dm.element_classes</span></code></a> which is determined by the default, defined in the data model class, and any <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> extensions or options used to modify that default.</p>
<p>By the time <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.build_params" title="mp.dm_element.build_params"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">build_params()</span></code></a> is called in the <strong>build parameters</strong> stage of the data model build, the global data model values, such as <a class="reference internal" href="../ref-manual/classes/mp/data_model.html#mp.data_model.base_mva" title="mp.data_model.base_mva"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">dm.base_mva</span></code></a>, have already been loaded and the <strong>update status</strong> stage has completed, filling in the <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.on" title="mp.dm_element.on"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">on</span></code></a> property of the object. This allows us to populate the various properties of the object with parameters for online elements only. These are pulled from the object’s main data table in <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.tab" title="mp.dm_element.tab"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">tab</span></code></a> with per unit conversions applied where appropriate.</p>
<p>The final step in <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.build_params" title="mp.dm_element.build_params"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">build_params()</span></code></a> is a call to <code class="xref mat mat-meth docutils literal notranslate"><span class="pre">apply_vm_setpoints()</span></code> which applies the specified voltage setpoints to the appropriate buses in the bus data model element object.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-build-params"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">build_params</span><span class="p">(</span>obj, dm<span class="p">)</span>
<span class="w">    </span><span class="n">obj</span><span class="p">.</span><span class="n">loss0</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">loss0</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">loss1</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">loss1</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">);</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">p_fr_start</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">p_to_start</span> <span class="p">=</span> <span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">loss1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">.*</span> <span class="n">obj</span><span class="p">.</span><span class="n">p_fr_start</span> <span class="o">+</span> <span class="n">obj</span><span class="p">.</span><span class="n">loss0</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">q_fr_start</span> <span class="p">=</span> <span class="o">-</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_fr</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">q_to_start</span> <span class="p">=</span> <span class="o">-</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_to</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">vm_setpoint_fr</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">vm_setpoint_fr</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">);</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">vm_setpoint_to</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">vm_setpoint_to</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">);</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">p_fr_lb</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr_lb</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">p_fr_ub</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr_ub</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">q_fr_lb</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_fr_lb</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">q_fr_ub</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_fr_ub</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">q_to_lb</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_to_lb</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">q_to_ub</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_to_ub</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>

    <span class="n">obj</span><span class="p">.</span><span class="n">apply_vm_setpoints</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">apply_vm_setpoints</span><span class="p">(</span>obj, dm<span class="p">)</span>
<span class="w">    </span><span class="n">bus_dme</span> <span class="p">=</span> <span class="n">dm</span><span class="p">.</span><span class="n">elements</span><span class="p">.</span><span class="n">bus</span><span class="p">;</span>
    <span class="n">i_fr</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">bus_dme</span><span class="p">.</span><span class="n">vm_control</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">fbus_on</span><span class="p">));</span>
    <span class="n">i_to</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">bus_dme</span><span class="p">.</span><span class="n">vm_control</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tbus_on</span><span class="p">));</span>
    <span class="n">bus_dme</span><span class="p">.</span><span class="n">vm_start</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">fbus_on</span><span class="p">(</span><span class="n">i_fr</span><span class="p">))</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">vm_setpoint_fr</span><span class="p">(</span><span class="n">i_fr</span><span class="p">);</span>
    <span class="n">bus_dme</span><span class="p">.</span><span class="n">vm_start</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tbus_on</span><span class="p">(</span><span class="n">i_to</span><span class="p">))</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">vm_setpoint_to</span><span class="p">(</span><span class="n">i_to</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="pretty-printing">
<h3>Pretty Printing<a class="headerlink" href="#pretty-printing" title="Link to this heading"></a></h3>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline" title="mp.dme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_legacy_dcline</span></code></a> class is also where you override any of the pretty-printing methods to implement DC line sections in the pretty-printed output.</p>
<p>The count (<strong>cnt</strong>) section is handled automatically by methods in the base class and there is no extremes (<strong>ext</strong>) section for DC lines, so no overrides are necessary for those sections.</p>
<p>For the summary (<strong>sum</strong>) section, <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.pp_have_section_sum" title="mp.dm_element.pp_have_section_sum"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pp_have_section_sum()</span></code></a> indicates that the section is present for DC lines, and <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.pp_data_sum" title="mp.dm_element.pp_data_sum"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pp_data_sum()</span></code></a> provides the content, printing the total active and reactive losses in a format consistent with the standard element types.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-pp-x-sum"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>TorF<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pp_have_section_sum</span><span class="p">(</span>obj, mpopt, pp_args<span class="p">)</span>
<span class="w">    </span><span class="n">TorF</span> <span class="p">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pp_data_sum</span><span class="p">(</span>obj, dm, rows, out_e, mpopt, fd, pp_args<span class="p">)</span>
<span class="w">    </span><span class="c">%% call parent</span>
    <span class="n">pp_data_sum</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="nb">rows</span><span class="p">,</span> <span class="n">out_e</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">pp_args</span><span class="p">);</span>

    <span class="c">%% print DC line summary</span>
    <span class="nb">fprintf</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s">&#39;  %-29s  %12.2f MW&#39;</span><span class="p">,</span> <span class="s">&#39;Total DC line losses&#39;</span><span class="p">,</span> <span class="p">...</span>
        <span class="nb">sum</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">))</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_to</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">))</span> <span class="p">);</span>
    <span class="k">if</span> <span class="n">mpopt</span><span class="p">.</span><span class="n">model</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">~=</span> <span class="s">&#39;D&#39;</span>    <span class="c">%% AC model</span>
        <span class="nb">fprintf</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s">&#39; %12.2f MVAr&#39;</span><span class="p">,</span> <span class="p">...</span>
            <span class="nb">sum</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_fr</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">))</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_to</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">))</span> <span class="p">);</span>
    <span class="k">end</span>
    <span class="nb">fprintf</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s">&#39;\n&#39;</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The details (<strong>det</strong>) section, which outputs the details for each individual DC line, is implemented by overriding <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.pp_have_section_det" title="mp.dm_element.pp_have_section_det"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pp_have_section_det()</span></code></a>, <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.pp_get_headers_det" title="mp.dm_element.pp_get_headers_det"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pp_get_headers_det()</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.pp_data_det" title="mp.dm_element.pp_data_det"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pp_data_det()</span></code></a>. The first indicates that the section is present, the second returns a cell array of strings to use as header rows, and the third returns a string with the output for the <em>k</em>-th DC line.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-pp-x-det"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>TorF<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pp_have_section_det</span><span class="p">(</span>obj, mpopt, pp_args<span class="p">)</span>
<span class="w">    </span><span class="n">TorF</span> <span class="p">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>h<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pp_get_headers_det</span><span class="p">(</span>obj, dm, out_e, mpopt, pp_args<span class="p">)</span>
<span class="w">    </span><span class="n">h</span> <span class="p">=</span> <span class="p">[</span> <span class="n">pp_get_headers_det</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dm_element</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">out_e</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">,</span> <span class="n">pp_args</span><span class="p">)</span> <span class="p">...</span>
        <span class="p">{</span>   <span class="s">&#39; DC Line    From       To              Power Flow (MW)      Loss    Reactive Inj (MVAr)&#39;</span><span class="p">,</span> <span class="p">...</span>
            <span class="s">&#39;   ID      Bus ID    Bus ID   Status    From       To       (MW)      From       To&#39;</span><span class="p">,</span> <span class="p">...</span>
            <span class="s">&#39;--------  --------  --------  ------  --------  --------  --------  --------  --------&#39;</span> <span class="p">}</span> <span class="p">];</span>
    <span class="c">%%       1234567 123456789 123456789 -----1 1234567.90 123456.89 123456.89 123456.89 123456.89</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>str<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pp_data_row_det</span><span class="p">(</span>obj, dm, k, out_e, mpopt, fd, pp_args<span class="p">)</span>
<span class="w">    </span><span class="n">str</span> <span class="p">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;%7d %9d %9d %6d %10.2f %9.2f %9.2f %9.2f %9.2f&#39;</span><span class="p">,</span> <span class="p">...</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">uid</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">bus_fr</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">bus_to</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">...</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">...</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_to</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">...</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_to</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">...</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_fr</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_to</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/dme_legacy_dcline.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/dme_legacy_dcline.m</span></code></a> for the complete <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline" title="mp.dme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_legacy_dcline</span></code></a> source.</p>
</section>
<section id="opf-subclass">
<h3>OPF Subclass<a class="headerlink" href="#opf-subclass" title="Link to this heading"></a></h3>
<p>For OPF problems, there are a few additions to the data model element for DC lines, and we use a subclass of <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline.html#mp.dme_legacy_dcline" title="mp.dme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_legacy_dcline</span></code></a>. First, there are a few extra columns in the main data table for shadow prices on limits. Notice that these are also included as output values, which are zeroed out for out-of-service DC lines.</p>
<p>While we could have put the limit parameters themselves in the OPF subclass, since they are not explicitly used when running a simple power flow, we chose to keep them in the base class so the data is available for power flow and CPF in case the user would like to check the solutions against the limits or implement controls based on them.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<span id="code-dme-legacy-dcline-opf"></span><div class="code-block-caption"><span class="caption-number">Listing 2 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline_opf.html#mp.dme_legacy_dcline_opf" title="mp.dme_legacy_dcline_opf"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_legacy_dcline_opf</span></code></a></span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="n">dme_legacy_dcline_opf</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">dme_legacy_dcline</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">names</span> <span class="p">=</span> <span class="n">main_table_var_names</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="n">names</span> <span class="p">=</span> <span class="nb">horzcat</span><span class="p">(</span> <span class="n">main_table_var_names</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dme_legacy_dcline</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="p">...</span>
<span class="linenos"> 5</span>                <span class="p">{</span>   <span class="s">&#39;cost&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos"> 6</span>                    <span class="s">&#39;mu_p_fr_lb&#39;</span><span class="p">,</span> <span class="s">&#39;mu_p_fr_ub&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos"> 7</span>                    <span class="s">&#39;mu_q_fr_lb&#39;</span><span class="p">,</span> <span class="s">&#39;mu_q_fr_ub&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos"> 8</span>                    <span class="s">&#39;mu_q_to_lb&#39;</span><span class="p">,</span> <span class="s">&#39;mu_q_to_ub&#39;</span>  <span class="p">}</span> <span class="p">);</span>
<span class="linenos"> 9</span>        <span class="k">end</span>
<span class="linenos">10</span>
<span class="linenos">11</span>        <span class="k">function</span> <span class="n">vars</span> <span class="p">=</span> <span class="n">export_vars</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">12</span>            <span class="n">vars</span> <span class="p">=</span> <span class="nb">horzcat</span><span class="p">(</span> <span class="n">export_vars</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dme_legacy_dcline</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="p">...</span>
<span class="linenos">13</span>                <span class="p">{</span>   <span class="s">&#39;vm_setpoint_fr&#39;</span><span class="p">,</span> <span class="s">&#39;vm_setpoint_to&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">14</span>                    <span class="s">&#39;mu_p_fr_lb&#39;</span><span class="p">,</span> <span class="s">&#39;mu_p_fr_ub&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">15</span>                    <span class="s">&#39;mu_q_fr_lb&#39;</span><span class="p">,</span> <span class="s">&#39;mu_q_fr_ub&#39;</span><span class="p">,</span> <span class="p">...</span>
<span class="linenos">16</span>                    <span class="s">&#39;mu_q_to_lb&#39;</span><span class="p">,</span> <span class="s">&#39;mu_q_to_ub&#39;</span>  <span class="p">}</span> <span class="p">);</span>
<span class="linenos">17</span>        <span class="k">end</span>
<span class="linenos">18</span>
<span class="linenos">19</span>        <span class="k">function</span> <span class="n">s</span> <span class="p">=</span> <span class="n">export_vars_offline_val</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">20</span>            <span class="n">s</span> <span class="p">=</span> <span class="n">export_vars_offline_val</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dme_legacy_dcline</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>  <span class="c">%% call parent</span>
<span class="linenos">21</span>            <span class="n">s</span><span class="p">.</span><span class="n">mu_p_fr_lb</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">22</span>            <span class="n">s</span><span class="p">.</span><span class="n">mu_p_fr_ub</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">23</span>            <span class="n">s</span><span class="p">.</span><span class="n">mu_q_fr_lb</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">24</span>            <span class="n">s</span><span class="p">.</span><span class="n">mu_q_fr_ub</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">25</span>            <span class="n">s</span><span class="p">.</span><span class="n">mu_q_to_lb</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">26</span>            <span class="n">s</span><span class="p">.</span><span class="n">mu_q_to_ub</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">27</span>        <span class="k">end</span>
<span class="linenos">28</span>
<span class="linenos">29</span>        <span class="c">% (additional methods listed and described below)</span>
<span class="linenos">30</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">31</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>The other addition in the OPF subclass is an optional cost on the active power flow in the DC line. This cost is specified in the same way as a generator cost, either as a set of polynomial coefficients, or as a set of breakpoints in a piecewise linear function. It appears as a column in the main table and is of type <a class="reference internal" href="../ref-manual/classes/mp/cost_table.html#mp.cost_table" title="mp.cost_table"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.cost_table</span></code></a>.</p>
<p>There is also a <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline_opf.html#mp.dme_legacy_dcline_opf.have_cost" title="mp.dme_legacy_dcline_opf.have_cost"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">have_cost()</span></code></a> method that returns true for OPF subclass and false in the base class. It is used by the export routines of the data model converter element to determine whether or not to export cost data.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-opf-have-cost"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>TorF<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">have_cost</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">TorF</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline_opf.html#mp.dme_legacy_dcline_opf.build_cost_params" title="mp.dme_legacy_dcline_opf.build_cost_params"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">build_cost_params()</span></code></a> method is called during the creation of an OPF mathematical model to extract the costs from the data and put it in a form more convenient for adding to the math model. The implementation is built on the same <a class="reference internal" href="../ref-manual/classes/mp/cost_table.html#mp.cost_table" title="mp.cost_table"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.cost_table</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/cost_table_utils.html#mp.cost_table_utils" title="mp.cost_table_utils"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.cost_table_utils</span></code></a> classes used for generator costs.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-opf-build-cost-params"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>cost<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">build_cost_params</span><span class="p">(</span>obj, dm<span class="p">)</span>
<span class="w">    </span><span class="k">if</span> <span class="nb">ismember</span><span class="p">(</span><span class="s">&#39;cost&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">Properties</span><span class="p">.</span><span class="n">VariableNames</span><span class="p">)</span>
        <span class="nb">poly</span> <span class="p">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">cost_table_utils</span><span class="p">.</span><span class="n">poly_params</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">,</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">);</span>
        <span class="n">pwl</span> <span class="p">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">cost_table_utils</span><span class="p">.</span><span class="n">pwl_params</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">on</span><span class="p">,</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">);</span>

        <span class="n">cost</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span> <span class="p">...</span>
                <span class="s">&#39;poly&#39;</span><span class="p">,</span> <span class="nb">poly</span><span class="p">,</span> <span class="p">...</span>
                <span class="s">&#39;pwl&#39;</span><span class="p">,</span>  <span class="n">pwl</span> <span class="p">...</span>
            <span class="p">);</span>
    <span class="k">else</span>
        <span class="n">cost</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">([]);</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Finally, there are several methods for handling the pretty-printing of the limits (<strong>lim</strong>) section, which is only relevant for the OPF. The <a class="reference internal" href="../ref-manual/classes/mp/dm_element.html#mp.dm_element.pretty_print" title="mp.dm_element.pretty_print"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pretty_print()</span></code></a> method is overridden to set up some data for limit sections, namely flows and shadow prices, to be passed via <code class="docutils literal notranslate"><span class="pre">pp_args</span></code> to the methods that do the printing.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-opf-pretty-print"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pretty_print</span><span class="p">(</span>obj, dm, section, out_e, mpopt, fd, pp_args<span class="p">)</span>
<span class="w">    </span><span class="k">switch</span> <span class="n">section</span>
        <span class="k">case</span> <span class="s">&#39;lim&#39;</span>
            <span class="c">%% pass flows and limits to parent</span>
            <span class="n">p_fr</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr</span><span class="p">;</span>
            <span class="n">lb</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr_lb</span><span class="p">;</span>
            <span class="n">ub</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr_ub</span><span class="p">;</span>
            <span class="n">pp_args</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">.</span><span class="n">flow</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span> <span class="s">&#39;p_fr&#39;</span><span class="p">,</span> <span class="n">p_fr</span><span class="p">,</span> <span class="p">...</span>
                                                 <span class="s">&#39;lb&#39;</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="p">...</span>
                                                 <span class="s">&#39;ub&#39;</span><span class="p">,</span> <span class="n">ub</span> <span class="p">);</span>
    <span class="k">end</span>

    <span class="n">pretty_print</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dme_legacy_dcline</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">out_e</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">pp_args</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/dme_shared_opf.html#mp.dme_shared_opf.pp_have_section_lim" title="mp.dme_shared_opf.pp_have_section_lim"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pp_have_section_lim()</span></code></a> method indicates that DC lines do have a limits section, <a class="reference internal" href="../ref-manual/classes/mp/dme_shared_opf.html#mp.dme_shared_opf.pp_binding_rows_lim" title="mp.dme_shared_opf.pp_binding_rows_lim"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pp_binding_rows_lim()</span></code></a> returns the indices of the DC lines with binding limits, <a class="reference internal" href="../ref-manual/classes/mp/dme_shared_opf.html#mp.dme_shared_opf.pp_get_headers_lim" title="mp.dme_shared_opf.pp_get_headers_lim"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pp_get_headers_lim()</span></code></a> returns a cell array of char arrays for the header lines, and <a class="reference internal" href="../ref-manual/classes/mp/dme_shared_opf.html#mp.dme_shared_opf.pp_data_row_lim" title="mp.dme_shared_opf.pp_data_row_lim"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">pp_data_row_lim()</span></code></a> returns a char array displaying the limit data for DC line <em>k</em>.</p>
<div class="highlight-octave notranslate" id="code-dme-legacy-dcline-opf-pp"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>TorF<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pp_have_section_lim</span><span class="p">(</span>obj, mpopt, pp_args<span class="p">)</span>
<span class="w">    </span><span class="n">TorF</span> <span class="p">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>rows<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pp_binding_rows_lim</span><span class="p">(</span>obj, dm, out_e, mpopt, pp_args<span class="p">)</span>
<span class="w">    </span><span class="n">flow</span> <span class="p">=</span> <span class="n">pp_args</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">.</span><span class="n">flow</span><span class="p">;</span>
    <span class="nb">rows</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="p">...</span>
                <span class="n">flow</span><span class="p">.</span><span class="n">p_fr</span> <span class="o">&lt;</span> <span class="n">flow</span><span class="p">.</span><span class="n">lb</span> <span class="o">+</span> <span class="n">obj</span><span class="p">.</span><span class="n">ctol</span> <span class="o">|</span> <span class="p">...</span>
                <span class="n">flow</span><span class="p">.</span><span class="n">p_fr</span> <span class="o">&gt;</span> <span class="n">flow</span><span class="p">.</span><span class="n">ub</span> <span class="o">-</span> <span class="n">obj</span><span class="p">.</span><span class="n">ctol</span> <span class="o">|</span> <span class="p">...</span>
                <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_lb</span> <span class="o">&gt;</span> <span class="n">obj</span><span class="p">.</span><span class="n">ptol</span> <span class="o">|</span> <span class="p">...</span>
                <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_ub</span> <span class="o">&gt;</span> <span class="n">obj</span><span class="p">.</span><span class="n">ptol</span> <span class="p">));</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>h<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pp_get_headers_lim</span><span class="p">(</span>obj, dm, out_e, mpopt, pp_args<span class="p">)</span>
<span class="w">    </span><span class="n">h</span> <span class="p">=</span> <span class="p">[</span> <span class="n">pp_get_headers_lim</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dme_shared_opf</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">out_e</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">,</span> <span class="n">pp_args</span><span class="p">)</span> <span class="p">...</span>
        <span class="p">{</span>   <span class="s">&#39; DC Line    From       To                   Active Power Flow (MW)&#39;</span><span class="p">,</span> <span class="p">...</span>
            <span class="s">&#39;   ID      Bus ID    Bus ID     mu LB       LB      p_fr      UB      mu UB&#39;</span><span class="p">,</span> <span class="p">...</span>
            <span class="s">&#39;--------  --------  --------  ---------  -------  -------  -------  ---------&#39;</span> <span class="p">}</span> <span class="p">];</span>
    <span class="c">%%       1234567 123456789 123456789 123456.890 12345.78 12345.78 12345.78 123456.890</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>str<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">pp_data_row_lim</span><span class="p">(</span>obj, dm, k, out_e, mpopt, fd, pp_args<span class="p">)</span>
<span class="w">    </span><span class="n">flow</span> <span class="p">=</span> <span class="n">pp_args</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">.</span><span class="n">flow</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">flow</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">flow</span><span class="p">.</span><span class="n">lb</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">obj</span><span class="p">.</span><span class="n">ctol</span> <span class="o">||</span> <span class="p">...</span>
            <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_lb</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">obj</span><span class="p">.</span><span class="n">ptol</span><span class="p">)</span>
        <span class="n">mu_lb</span> <span class="p">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;%10.3f&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_lb</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
    <span class="k">else</span>
        <span class="n">mu_lb</span> <span class="p">=</span> <span class="s">&#39;      -   &#39;</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flow</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">flow</span><span class="p">.</span><span class="n">ub</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">obj</span><span class="p">.</span><span class="n">ctol</span> <span class="o">||</span> <span class="p">...</span>
            <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_ub</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">obj</span><span class="p">.</span><span class="n">ptol</span><span class="p">)</span>
        <span class="n">mu_ub</span> <span class="p">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;%10.3f&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_ub</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
    <span class="k">else</span>
        <span class="n">mu_ub</span> <span class="p">=</span> <span class="s">&#39;      -   &#39;</span><span class="p">;</span>
    <span class="k">end</span>

    <span class="n">str</span> <span class="p">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;%7d %9d %9d %10s %8.2f %8.2f %8.2f %10s&#39;</span><span class="p">,</span> <span class="p">...</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">uid</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">bus_fr</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">obj</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">bus_to</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">...</span>
        <span class="n">mu_lb</span><span class="p">,</span> <span class="n">flow</span><span class="p">.</span><span class="n">lb</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">flow</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">flow</span><span class="p">.</span><span class="n">ub</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">mu_ub</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/dme_legacy_dcline_opf.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/dme_legacy_dcline_opf.m</span></code></a> for the complete <a class="reference internal" href="../ref-manual/classes/mp/dme_legacy_dcline_opf.html#mp.dme_legacy_dcline_opf" title="mp.dme_legacy_dcline_opf"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dme_legacy_dcline_opf</span></code></a> source.</p>
</section>
</section>
<section id="data-model-converter-element">
<h2>Data Model Converter Element<a class="headerlink" href="#data-model-converter-element" title="Link to this heading"></a></h2>
<p>The role of the data model converter element, as described in <a class="reference internal" href="../dev-manual/data-model-converter.html#sec-dmc-element"><span class="std std-ref">Data Model Converter Elements</span></a> in <a class="reference internal" href="../dev-manual/index.html#matpower-dev-manual"><span class="std std-ref">MATPOWER Developer’s Manual</span></a>, is to implement the functionality needed to import and export data from a specific external format. In this case, we need to import from and export to the <code class="docutils literal notranslate"><span class="pre">dcline</span></code> and <code class="docutils literal notranslate"><span class="pre">dclinecost</span></code> fields in a <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> case struct (v2) format.</p>
<p>There is a single class, <a class="reference internal" href="../ref-manual/classes/mp/dmce_legacy_dcline_mpc2.html#mp.dmce_legacy_dcline_mpc2" title="mp.dmce_legacy_dcline_mpc2"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dmce_legacy_dcline_mpc2</span></code></a> to implement this functionality. As with all data model converter elements, it inherits from <a class="reference internal" href="../ref-manual/classes/mp/dmc_element.html#mp.dmc_element" title="mp.dmc_element"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dmc_element</span></code></a> and defines a <a class="reference internal" href="../ref-manual/classes/mp/dmc_element.html#mp.dmc_element.name" title="mp.dmc_element.name"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">name()</span></code></a> method.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<span id="code-dmce-legacy-dcline-mpc2"></span><div class="code-block-caption"><span class="caption-number">Listing 3 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/dmce_legacy_dcline_mpc2.html#mp.dmce_legacy_dcline_mpc2" title="mp.dmce_legacy_dcline_mpc2"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dmce_legacy_dcline_mpc2</span></code></a></span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="n">dmce_legacy_dcline_mpc2</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">dmc_element</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="n">name</span> <span class="p">=</span> <span class="s">&#39;legacy_dcline&#39;</span><span class="p">;</span>
<span class="linenos"> 5</span>        <span class="k">end</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>        <span class="c">% (other methods listed and described individually below)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">10</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<section id="main-field-in-data-source">
<h3>Main Field in Data Source<a class="headerlink" href="#main-field-in-data-source" title="Link to this heading"></a></h3>
<p>Generally, the main data table in the data model element corresponds to a particular field in the data source (the <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> case struct, i.e. <code class="docutils literal notranslate"><span class="pre">mpc</span></code>).</p>
<p>The name of this field is defined by the return value of <a class="reference internal" href="../ref-manual/classes/mp/dmc_element.html#mp.dmc_element.data_field" title="mp.dmc_element.data_field"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">data_field()</span></code></a>.</p>
<div class="highlight-octave notranslate" id="code-dmce-legacy-dcline-mpc2-data-field"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>df<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">data_field</span><span class="p">(</span>obj<span class="p">)</span>
<span class="w">    </span><span class="n">df</span> <span class="p">=</span> <span class="s">&#39;dcline&#39;</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>When exporting to a new <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> case struct, the <a class="reference internal" href="../ref-manual/classes/mp/dmc_element.html#mp.dmc_element.default_export_data_table" title="mp.dmc_element.default_export_data_table"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">default_export_data_table()</span></code></a> method is called to initialize the value of this field, i.e. of <code class="docutils literal notranslate"><span class="pre">mpc.dcline</span></code>. In this case, it is simply a matrix of all zeros with the expected number of rows and columns. The number of rows is retrieved from the export specification by the <a class="reference internal" href="../ref-manual/classes/mp/dmc_element.html#mp.dmc_element.default_export_data_nrows" title="mp.dmc_element.default_export_data_nrows"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">default_export_data_nrows()</span></code></a> method.</p>
<div class="highlight-octave notranslate" id="code-dmce-legacy-dcline-mpc2-default-export-data-table"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>dt<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">default_export_data_table</span><span class="p">(</span>obj, spec<span class="p">)</span>
<span class="w">    </span><span class="c">%% define named indices into data matrices</span>
    <span class="n">c</span> <span class="p">=</span> <span class="n">idx_dcline</span><span class="p">;</span>

    <span class="n">nr</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">default_export_data_nrows</span><span class="p">(</span><span class="n">spec</span><span class="p">);</span>
    <span class="n">dt</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">QMAXT</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="table-variable-map">
<h3>Table Variable Map<a class="headerlink" href="#table-variable-map" title="Link to this heading"></a></h3>
<p>The majority of the functionality of the data model converter element is handled by the <a class="reference internal" href="../ref-manual/classes/mp/dmc_element.html#mp.dmc_element.table_var_map" title="mp.dmc_element.table_var_map"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">table_var_map()</span></code></a> method. This method returns a variable map struct as summarized in <a class="reference internal" href="../dev-manual/data-model-converter.html#tab-var-map"><span class="std std-numref">Table 6.1</span></a> in the <a class="reference internal" href="../dev-manual/index.html#matpower-dev-manual"><span class="std std-ref">MATPOWER Developer’s Manual</span></a>. This map defines where to get the data for each variable in the data model element’s main data table. For our DC line, this is the data listed in <a class="reference internal" href="#tab-legacy-dcline-data-model"><span class="std std-numref">Table 1</span></a>.</p>
<p>Most of the variables are simply copied directy from/to the corresponding column in <code class="docutils literal notranslate"><span class="pre">mpc.dcline</span></code>. In this case, the corresponding entry in the the map is a cell array whose first element has already been initialized to <code class="docutils literal notranslate"><span class="pre">'col'</span></code> by the parent method, so we simply set the second element to the index of the corresponding column. For example, the active power flow in <code class="docutils literal notranslate"><span class="pre">dme.tab.p_fr</span></code> is copied directly from/to <code class="docutils literal notranslate"><span class="pre">mpc.dcline(:,</span> <span class="pre">c.PF)</span></code> (i.e. column 4). The <code class="docutils literal notranslate"><span class="pre">uid</span></code> field specifies that the <code class="docutils literal notranslate"><span class="pre">uid</span></code> variable be assigned consecutive integer IDs, starting at 1, and the <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">source_uid</span></code> variables are simply assigned a cell array of empty char arrays.</p>
<p>The only other variable not pulled directly from a column of <code class="docutils literal notranslate"><span class="pre">mpc.dcline</span></code> is the <code class="docutils literal notranslate"><span class="pre">cost</span></code> variable. This comes from <code class="docutils literal notranslate"><span class="pre">mpc.dclinecost</span></code> and the variable map entry specifies custom import and export methods described below to handle the import/export directly.</p>
<div class="highlight-octave notranslate" id="code-dmce-legacy-dcline-mpc2-table-var-map"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>vmap<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">table_var_map</span><span class="p">(</span>obj, dme, mpc<span class="p">)</span>
<span class="w">    </span><span class="n">vmap</span> <span class="p">=</span> <span class="n">table_var_map</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">dmc_element</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dme</span><span class="p">,</span> <span class="n">mpc</span><span class="p">);</span>

    <span class="c">%% define named indices into data matrices</span>
    <span class="n">c</span> <span class="p">=</span> <span class="n">idx_dcline</span><span class="p">;</span>

    <span class="n">gcip_fcn</span> <span class="p">=</span> <span class="p">@(</span><span class="n">ob</span><span class="p">,</span> <span class="n">mpc</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">vn</span><span class="p">)</span><span class="n">dcline_cost_import</span><span class="p">(</span><span class="n">ob</span><span class="p">,</span> <span class="n">mpc</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">vn</span><span class="p">);</span>
    <span class="n">gcep_fcn</span> <span class="p">=</span> <span class="p">@(</span><span class="n">ob</span><span class="p">,</span> <span class="n">dme</span><span class="p">,</span> <span class="n">mpc</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">vn</span><span class="p">,</span> <span class="n">ridx</span><span class="p">)</span><span class="n">dcline_cost_export</span><span class="p">(</span><span class="n">ob</span><span class="p">,</span> <span class="n">dme</span><span class="p">,</span> <span class="n">mpc</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">vn</span><span class="p">,</span> <span class="n">ridx</span><span class="p">);</span>

    <span class="c">%% mapping for each name, default is {&#39;col&#39;, []}</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">uid</span>                <span class="p">=</span> <span class="p">{</span><span class="s">&#39;IDs&#39;</span><span class="p">};</span>      <span class="c">%% consecutive IDs, starting at 1</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">name</span>               <span class="p">=</span> <span class="p">{</span><span class="s">&#39;cell&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">};</span>     <span class="c">%% empty char</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">status</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>          <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">BR_STATUS</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">source_uid</span>         <span class="p">=</span> <span class="p">{</span><span class="s">&#39;cell&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">};</span>     <span class="c">%% empty char</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">bus_fr</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>          <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">F_BUS</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">bus_to</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>          <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">T_BUS</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">loss0</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>           <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">LOSS0</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">loss1</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>           <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">LOSS1</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">vm_setpoint_fr</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">VF</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">vm_setpoint_to</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">VT</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">p_fr_lb</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>         <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">PMIN</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">p_fr_ub</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>         <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">PMAX</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">q_fr_lb</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>         <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">QMINF</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">q_fr_ub</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>         <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">QMAXF</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">q_to_lb</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>         <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">QMINT</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">q_to_ub</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>         <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">QMAXT</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">p_fr</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>            <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">PF</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">q_fr</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>            <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">QF</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">p_to</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>            <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">PT</span><span class="p">;</span>
    <span class="n">vmap</span><span class="p">.</span><span class="n">q_to</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>            <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">QT</span><span class="p">;</span>
    <span class="k">if</span> <span class="nb">isfield</span><span class="p">(</span><span class="n">vmap</span><span class="p">,</span> <span class="s">&#39;cost&#39;</span><span class="p">)</span>
        <span class="n">vmap</span><span class="p">.</span><span class="n">cost</span>        <span class="p">=</span> <span class="p">{</span><span class="s">&#39;fcn&#39;</span><span class="p">,</span> <span class="n">gcip_fcn</span><span class="p">,</span> <span class="n">gcep_fcn</span><span class="p">};</span>
        <span class="n">vmap</span><span class="p">.</span><span class="n">mu_p_fr_lb</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">MU_PMIN</span><span class="p">;</span>
        <span class="n">vmap</span><span class="p">.</span><span class="n">mu_p_fr_ub</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">MU_PMAX</span><span class="p">;</span>
        <span class="n">vmap</span><span class="p">.</span><span class="n">mu_q_fr_lb</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">MU_QMINF</span><span class="p">;</span>
        <span class="n">vmap</span><span class="p">.</span><span class="n">mu_q_fr_ub</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">MU_QMAXF</span><span class="p">;</span>
        <span class="n">vmap</span><span class="p">.</span><span class="n">mu_q_to_lb</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">MU_QMINT</span><span class="p">;</span>
        <span class="n">vmap</span><span class="p">.</span><span class="n">mu_q_to_ub</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>  <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">MU_QMAXT</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="custom-import-export-functions">
<h3>Custom Import/Export Functions<a class="headerlink" href="#custom-import-export-functions" title="Link to this heading"></a></h3>
<p>Finally, the custom import and export methods for the DC line cost work explicitly with <code class="docutils literal notranslate"><span class="pre">mpc.dclinecost</span></code> using some static methods from <a class="reference internal" href="../ref-manual/classes/mp/dmce_gen_mpc2.html#mp.dmce_gen_mpc2" title="mp.dmce_gen_mpc2"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dmce_gen_mpc2</span></code></a> to convert from/to the legacy <code class="docutils literal notranslate"><span class="pre">gencost</span></code> format.</p>
<div class="highlight-octave notranslate" id="code-dmce-legacy-dcline-mpc2-dcline-cost-import-export"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>val<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">dcline_cost_import</span><span class="p">(</span>obj, mpc, spec, vn<span class="p">)</span>
<span class="w">    </span><span class="k">if</span> <span class="nb">isfield</span><span class="p">(</span><span class="n">mpc</span><span class="p">,</span> <span class="s">&#39;dclinecost&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="p">.</span><span class="n">nr</span>
        <span class="n">val</span> <span class="p">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">dmce_gen_mpc2</span><span class="p">.</span><span class="n">gencost2cost_table</span><span class="p">(</span><span class="n">mpc</span><span class="p">.</span><span class="n">dclinecost</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">val</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span>mpc<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">dcline_cost_export</span><span class="p">(</span>obj, dme, mpc, spec, vn, ridx<span class="p">)</span>
<span class="w">    </span><span class="k">if</span> <span class="n">dme</span><span class="p">.</span><span class="n">have_cost</span><span class="p">()</span>
        <span class="n">cost</span> <span class="p">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">dmce_gen_mpc2</span><span class="p">.</span><span class="n">cost_table2gencost</span><span class="p">(</span> <span class="p">...</span>
                    <span class="p">[],</span> <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">ridx</span><span class="p">);</span>
        <span class="n">mpc</span><span class="p">.</span><span class="n">dclinecost</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">spec</span><span class="p">.</span><span class="n">nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">=</span> <span class="n">cost</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/dmce_legacy_dcline_mpc2.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/dmce_legacy_dcline_mpc2.m</span></code></a> for the complete <a class="reference internal" href="../ref-manual/classes/mp/dmce_legacy_dcline_mpc2.html#mp.dmce_legacy_dcline_mpc2" title="mp.dmce_legacy_dcline_mpc2"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.dmce_legacy_dcline_mpc2</span></code></a> source.</p>
</section>
</section>
<section id="network-model-element">
<h2>Network Model Element<a class="headerlink" href="#network-model-element" title="Link to this heading"></a></h2>
<p>Next we define the DC line network model. Let’s assume we want implementations for a DC model as well as both polar and cartesian voltage formulations of the AC model. Because network models are formulation-specific, we define a class hierarchy for the network model element.</p>
<section id="all-formulations">
<h3>All Formulations<a class="headerlink" href="#all-formulations" title="Link to this heading"></a></h3>
<p>All DC line network model elements will inherit from <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline.html#mp.nme_legacy_dcline" title="mp.nme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline</span></code></a>, shown in <a class="reference internal" href="#code-nme-legacy-dcline"><span class="std std-numref">Listing 4</span></a>, which in turn inherits from <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element" title="mp.nm_element"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nm_element</span></code></a>. Please see the <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element" title="mp.nm_element"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nm_element</span></code></a> reference documentation for an overview of the functionality provided and for more details on the methods overridden by <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline.html#mp.nme_legacy_dcline" title="mp.nme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline</span></code></a> and its subclasses.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<span id="code-nme-legacy-dcline"></span><div class="code-block-caption"><span class="caption-number">Listing 4 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline.html#mp.nme_legacy_dcline" title="mp.nme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline</span></code></a></span><a class="headerlink" href="#id6" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="p">(</span><span class="n">Abstract</span><span class="p">)</span> <span class="n">nme_legacy_dcline</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">nm_element</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="n">name</span> <span class="p">=</span> <span class="s">&#39;legacy_dcline&#39;</span><span class="p">;</span>
<span class="linenos"> 5</span>        <span class="k">end</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>        <span class="k">function</span> <span class="n">np</span> <span class="p">=</span> <span class="n">np</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos"> 8</span>            <span class="n">np</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>     <span class="c">%% this is a 2 port element</span>
<span class="linenos"> 9</span>        <span class="k">end</span>
<span class="linenos">10</span>
<span class="linenos">11</span>        <span class="k">function</span> <span class="n">nz</span> <span class="p">=</span> <span class="n">nz</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">12</span>            <span class="n">nz</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>     <span class="c">%% 2 (possibly complex) non-voltage state per element</span>
<span class="linenos">13</span>        <span class="k">end</span>
<span class="linenos">14</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">15</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>Once again, <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.name" title="mp.nm_element.name"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">name()</span></code></a> returns the name used internally for this element type, while the <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.np" title="mp.nm_element.np"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">np()</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.nz" title="mp.nm_element.nz"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">nz()</span></code></a> methods return the number of ports and non-voltage states, respectively. These are shared by all formulations.</p>
</section>
<section id="ac-formulations">
<h3>AC Formulations<a class="headerlink" href="#ac-formulations" title="Link to this heading"></a></h3>
<p>Anything that applies to both AC formulations, but not the DC formulation, is included in the abstract class <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_ac.html#mp.nme_legacy_dcline_ac" title="mp.nme_legacy_dcline_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_ac</span></code></a>, shown in <a class="reference internal" href="#code-nme-legacy-dcline-ac"><span class="std std-numref">Listing 5</span></a>, which is a subclass of <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline.html#mp.nme_legacy_dcline" title="mp.nme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline</span></code></a>. Any concrete network model element class that inherits from <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_ac.html#mp.nme_legacy_dcline_ac" title="mp.nme_legacy_dcline_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_ac</span></code></a> is also expected to be a subclass of a formulation class that inherits from <a class="reference internal" href="../ref-manual/classes/mp/form_ac.html#mp.form_ac" title="mp.form_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.form_ac</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<span id="code-nme-legacy-dcline-ac"></span><div class="code-block-caption"><span class="caption-number">Listing 5 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_ac.html#mp.nme_legacy_dcline_ac" title="mp.nme_legacy_dcline_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_ac</span></code></a></span><a class="headerlink" href="#id7" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="p">(</span><span class="n">Abstract</span><span class="p">)</span> <span class="n">nme_legacy_dcline_ac</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">nme_legacy_dcline</span> <span class="o">&amp;</span> <span class="n">mp</span><span class="p">.</span><span class="n">form_ac</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">add_zvars</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="n">ndc</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">nk</span><span class="p">;</span>
<span class="linenos"> 5</span>            <span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
<span class="linenos"> 6</span>            <span class="k">switch</span> <span class="n">idx</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
<span class="linenos"> 7</span>                <span class="k">case</span> <span class="mi">1</span>      <span class="c">% flow at &quot;from&quot;</span>
<span class="linenos"> 8</span>                    <span class="n">nm</span><span class="p">.</span><span class="n">add_var</span><span class="p">(</span><span class="s">&#39;zr&#39;</span><span class="p">,</span> <span class="s">&#39;Pdcf&#39;</span><span class="p">,</span> <span class="n">ndc</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">p_fr_start</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">p_fr_lb</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">p_fr_ub</span><span class="p">);</span>
<span class="linenos"> 9</span>                    <span class="n">nm</span><span class="p">.</span><span class="n">add_var</span><span class="p">(</span><span class="s">&#39;zi&#39;</span><span class="p">,</span> <span class="s">&#39;Qdcf&#39;</span><span class="p">,</span> <span class="n">ndc</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">q_fr_start</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">q_fr_lb</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">q_fr_ub</span><span class="p">);</span>
<span class="linenos">10</span>                <span class="k">case</span> <span class="mi">2</span>      <span class="c">% flow at &quot;to&quot;</span>
<span class="linenos">11</span>                    <span class="n">nm</span><span class="p">.</span><span class="n">add_var</span><span class="p">(</span><span class="s">&#39;zr&#39;</span><span class="p">,</span> <span class="s">&#39;Pdct&#39;</span><span class="p">,</span> <span class="n">ndc</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">p_to_start</span><span class="p">,</span> <span class="o">-</span><span class="nb">Inf</span><span class="p">,</span> <span class="nb">Inf</span><span class="p">);</span>
<span class="linenos">12</span>                    <span class="n">nm</span><span class="p">.</span><span class="n">add_var</span><span class="p">(</span><span class="s">&#39;zi&#39;</span><span class="p">,</span> <span class="s">&#39;Qdct&#39;</span><span class="p">,</span> <span class="n">ndc</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">q_to_start</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">q_to_lb</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">q_to_ub</span><span class="p">);</span>
<span class="linenos">13</span>            <span class="k">end</span>
<span class="linenos">14</span>        <span class="k">end</span>
<span class="linenos">15</span>
<span class="linenos">16</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">build_params</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
<span class="linenos">17</span>            <span class="n">build_params</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">nme_legacy_dcline</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">);</span> <span class="c">%% call parent</span>
<span class="linenos">18</span>            <span class="n">obj</span><span class="p">.</span><span class="n">N</span> <span class="p">=</span> <span class="nb">speye</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">nk</span> <span class="o">*</span> <span class="n">obj</span><span class="p">.</span><span class="n">nz</span><span class="p">);</span>
<span class="linenos">19</span>        <span class="k">end</span>
<span class="linenos">20</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">21</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>The first method defined by <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_ac.html#mp.nme_legacy_dcline_ac" title="mp.nme_legacy_dcline_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_ac</span></code></a>, namely <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.add_zvars" title="mp.nm_element.add_zvars"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_zvars()</span></code></a>, adds variables for the real and imaginary parts of the non-voltage state variables, <span class="math notranslate nohighlight">\(\cvec{z}_1\)</span> and <span class="math notranslate nohighlight">\(\cvec{z}_2\)</span>, to the network model, constructing the initial values from the appropriate columns in the data table, and including predefined bounds. Note that the variable named <code class="docutils literal notranslate"><span class="pre">Pdcf</span></code> is vector containing the real part of <span class="math notranslate nohighlight">\(\cscal{z}_1\)</span> for all DC lines in the network. Because the voltage variable representation is different for cartesian and polar formulations, the implementation of <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.add_vvars" title="mp.nm_element.add_vvars"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_vvars()</span></code></a> is deferred to the formulation-specific subclasses below.</p>
<p>The second method, <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.build_params" title="mp.nm_element.build_params"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">build_params()</span></code></a>, first calls its parent to build the incidence matrices <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.C" title="mp.nm_element.C"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">C</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.D" title="mp.nm_element.D"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">D</span></code></a>, then constructs the standard AC model parameters from the data model. The AC model and its parameters are described in <a class="reference internal" href="../dev-manual/net-model.html#sec-nm-formulations-ac"><span class="std std-ref">AC Formulations</span></a> in the <a class="reference internal" href="../dev-manual/index.html#matpower-dev-manual"><span class="std std-ref">MATPOWER Developer’s Manual</span></a>.</p>
<p>Recall that, if we omit the arbitrary nonlinear injection components, <span class="math notranslate nohighlight">\(\Snln(\X)\)</span> or <span class="math notranslate nohighlight">\(\Inln(\X)\)</span>, the standard AC network model for any element type can be defined in terms of the six parameters in the equations below, namely  <span class="math notranslate nohighlight">\(\YY\)</span>, <span class="math notranslate nohighlight">\(\LL\)</span>, <span class="math notranslate nohighlight">\(\MM\)</span>, <span class="math notranslate nohighlight">\(\NN\)</span>, <span class="math notranslate nohighlight">\(\iv\)</span>, and <span class="math notranslate nohighlight">\(\sv\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-eq-ilin-howto">
<span class="eqno">(29)<a class="headerlink" href="#equation-eq-ilin-howto" title="Link to this equation"></a></span>\[\Ilin(\X) = \YY \V + \LL \Z + \iv\]</div>
<div class="math notranslate nohighlight" id="equation-eq-slin-howto">
<span class="eqno">(30)<a class="headerlink" href="#equation-eq-slin-howto" title="Link to this equation"></a></span>\[\Slin(\X) = \MM \V + \NN \Z + \sv\]</div>
<p>For a single DC line, based on <a class="reference internal" href="#fig-legacy-dcline-model"><span class="std std-numref">Figure 1</span></a> and equation <a class="reference internal" href="#equation-eq-legacy-dcline-port-power">(25)</a>, all of these parameters are zero (with proper dimensions) except <span class="math notranslate nohighlight">\(\NN\)</span>, which is a <span class="math notranslate nohighlight">\(2 \times 2\)</span> identity matrix.</p>
<div class="math notranslate nohighlight" id="equation-eq-s-lin-howto">
<span class="eqno">(31)<a class="headerlink" href="#equation-eq-s-lin-howto" title="Link to this equation"></a></span>\[\begin{split}\NN = \left[\begin{array}{cc}
     1 &amp; 0 \\
     0 &amp; 1
  \end{array}\right]\end{split}\]</div>
<p>However, <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.build_params" title="mp.nm_element.build_params"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">build_params()</span></code></a> must build stacked versions of these matrix and vector parameters that include all <span class="math notranslate nohighlight">\(n_k\)</span> DC lines in the system. In general, for matrix parameters, such as <span class="math notranslate nohighlight">\(\NN\)</span>, the stacking is done such that each scalar element is replaced by a corresponding <span class="math notranslate nohighlight">\(n_k \times n_k\)</span> diagonal matrix. For the vector parameters, each scalar element becomes an <span class="math notranslate nohighlight">\(n_k \times 1\)</span> vector. In our case, we have only <span class="math notranslate nohighlight">\(\NN\)</span>, and the stacked version is simply a <span class="math notranslate nohighlight">\(2 n_k \times 2 n_k\)</span> identiy matrix.</p>
</section>
<section id="ac-cartesian-vs-polar-formulations">
<h3>AC Cartesian vs Polar Formulations<a class="headerlink" href="#ac-cartesian-vs-polar-formulations" title="Link to this heading"></a></h3>
<p>Once the parameters have been built, all of the differences between the cartesian and polar voltage formulations are handled automatically by inheriting from the appropriate formulation class. For the cartesian voltage formulation, we use <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_acc.html#mp.nme_legacy_dcline_acc" title="mp.nme_legacy_dcline_acc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_acc</span></code></a> which inherits from <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_ac.html#mp.nme_legacy_dcline_ac" title="mp.nme_legacy_dcline_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_ac</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/form_acc.html#mp.form_acc" title="mp.form_acc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.form_acc</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<span id="code-nme-legacy-dcline-acc"></span><div class="code-block-caption"><span class="caption-number">Listing 6 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_acc.html#mp.nme_legacy_dcline_acc" title="mp.nme_legacy_dcline_acc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_acc</span></code></a></span><a class="headerlink" href="#id8" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">classdef</span> <span class="n">nme_legacy_dcline_acc</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">nme_legacy_dcline_ac</span> <span class="o">&amp;</span> <span class="n">mp</span><span class="p">.</span><span class="n">form_acc</span>
<span class="linenos">2</span><span class="k">end</span>
</pre></div>
</div>
</div>
<p>For the polar voltage formulation, we use <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_acp.html#mp.nme_legacy_dcline_acp" title="mp.nme_legacy_dcline_acp"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_acp</span></code></a> which inherits from <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_ac.html#mp.nme_legacy_dcline_ac" title="mp.nme_legacy_dcline_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_ac</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/form_acp.html#mp.form_acp" title="mp.form_acp"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.form_acp</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<span id="code-nme-legacy-dcline-acp"></span><div class="code-block-caption"><span class="caption-number">Listing 7 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_acp.html#mp.nme_legacy_dcline_acp" title="mp.nme_legacy_dcline_acp"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_acp</span></code></a></span><a class="headerlink" href="#id9" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">classdef</span> <span class="n">nme_legacy_dcline_acp</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">nme_legacy_dcline_ac</span> <span class="o">&amp;</span> <span class="n">mp</span><span class="p">.</span><span class="n">form_acp</span>
<span class="linenos">2</span><span class="k">end</span>
</pre></div>
</div>
</div>
</section>
<section id="dc-formulation">
<h3>DC Formulation<a class="headerlink" href="#dc-formulation" title="Link to this heading"></a></h3>
<p>The implementation for the DC version is similar. The <code class="xref mat mat-class docutils literal notranslate"><span class="pre">nme_legacy_dcline_dc</span></code> class, shown in <a class="reference internal" href="#code-nme-legacy-dcline-dc"><span class="std std-numref">Listing 8</span></a>, inherits from both <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline.html#mp.nme_legacy_dcline" title="mp.nme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/form_dc.html#mp.form_dc" title="mp.form_dc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.form_dc</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<span id="code-nme-legacy-dcline-dc"></span><div class="code-block-caption"><span class="caption-number">Listing 8 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_dc.html#mp.nme_legacy_dcline_dc" title="mp.nme_legacy_dcline_dc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_dc</span></code></a></span><a class="headerlink" href="#id10" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="n">nme_legacy_dcline_dc</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">nme_legacy_dcline</span> <span class="o">&amp;</span> <span class="n">mp</span><span class="p">.</span><span class="n">form_dc</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">add_zvars</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="n">ndc</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">nk</span><span class="p">;</span>
<span class="linenos"> 5</span>            <span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
<span class="linenos"> 6</span>            <span class="k">switch</span> <span class="n">idx</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
<span class="linenos"> 7</span>                <span class="k">case</span> <span class="mi">1</span>      <span class="c">% flow at &quot;from&quot;</span>
<span class="linenos"> 8</span>                    <span class="n">nm</span><span class="p">.</span><span class="n">add_var</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;Pdcf&#39;</span><span class="p">,</span> <span class="n">ndc</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">p_fr_start</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">p_fr_lb</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">p_fr_ub</span><span class="p">);</span>
<span class="linenos"> 9</span>                <span class="k">case</span> <span class="mi">2</span>      <span class="c">% flow at &quot;to&quot;</span>
<span class="linenos">10</span>                    <span class="n">nm</span><span class="p">.</span><span class="n">add_var</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;Pdct&#39;</span><span class="p">,</span> <span class="n">ndc</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">p_to_start</span><span class="p">,</span> <span class="o">-</span><span class="nb">Inf</span><span class="p">,</span> <span class="nb">Inf</span><span class="p">);</span>
<span class="linenos">11</span>            <span class="k">end</span>
<span class="linenos">12</span>        <span class="k">end</span>
<span class="linenos">13</span>
<span class="linenos">14</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">build_params</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
<span class="linenos">15</span>            <span class="n">build_params</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">nme_legacy_dcline</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">);</span> <span class="c">%% call parent</span>
<span class="linenos">16</span>            <span class="n">obj</span><span class="p">.</span><span class="n">K</span> <span class="p">=</span> <span class="nb">speye</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">nk</span> <span class="o">*</span> <span class="n">obj</span><span class="p">.</span><span class="n">nz</span><span class="p">);</span>
<span class="linenos">17</span>        <span class="k">end</span>
<span class="linenos">18</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">19</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>It also overrides <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.add_zvars" title="mp.nm_element.add_zvars"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_zvars()</span></code></a> to add a set of named variables for each of the two non-voltage states, namely the active power flows at the “from” and “to” ends of the DC lines. In this case, the states <span class="math notranslate nohighlight">\(z_1\)</span> and <span class="math notranslate nohighlight">\(z_2\)</span> are real, so there are only two variables instead of four.</p>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.build_params" title="mp.nm_element.build_params"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">build_params()</span></code></a> method once again calls its parent to build the incidence matrices <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.C" title="mp.nm_element.C"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">C</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/nm_element.html#mp.nm_element.D" title="mp.nm_element.D"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">D</span></code></a>, then constructs the standard DC model parameters from the data model. The DC model and its parameters are described in <a class="reference internal" href="../dev-manual/net-model.html#sec-nm-formulations-dc"><span class="std std-ref">DC Formulation</span></a> in the <a class="reference internal" href="../dev-manual/index.html#matpower-dev-manual"><span class="std std-ref">MATPOWER Developer’s Manual</span></a>.</p>
<p>Recall that the standard DC network model for any element type can be defined in terms of the three parameters in the equation below, namely  <span class="math notranslate nohighlight">\(\BB\)</span>, <span class="math notranslate nohighlight">\(\KK\)</span>, and <span class="math notranslate nohighlight">\(\pv\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-eq-gkpx-howto">
<span class="eqno">(32)<a class="headerlink" href="#equation-eq-gkpx-howto" title="Link to this equation"></a></span>\[\gP(\x) = \BB \Va + \KK \z + \pv\]</div>
<p>For DC lines, the only one we need to define is the <span class="math notranslate nohighlight">\(\KK\)</span> matrix and, analogous to <span class="math notranslate nohighlight">\(\NN\)</span> in the AC formulation, it also is a <span class="math notranslate nohighlight">\(2 n_k \times 2 n_k\)</span> identiy matrix.</p>
<p>The complete source for the DC line network model element classes above can be found in:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/nme_legacy_dcline.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/nme_legacy_dcline.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/nme_legacy_dcline_ac.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/nme_legacy_dcline_ac.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/nme_legacy_dcline_acc.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/nme_legacy_dcline_acc.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/nme_legacy_dcline_acp.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/nme_legacy_dcline_acp.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/nme_legacy_dcline_dc.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/nme_legacy_dcline_dc.m</span></code></a></p></li>
</ul>
</section>
</section>
<section id="mathematical-model-element">
<h2>Mathematical Model Element<a class="headerlink" href="#mathematical-model-element" title="Link to this heading"></a></h2>
<p>The mathematical model base classes automatically handle adding variables defined by the ports and states in the network model and incorporating the nodal injections implied by the network model parameters defined by each element.</p>
<p>However, the mathematical model element can be used to add any additional variables, beyond the voltage and non-voltage state variable, and any additional constraints or costs.</p>
<p>It is also responsible for passing solution data back to the data model. A mathematical model is specific to both a task (PF, CPF, OPF) and a formulation. So once again, we define a hierarchy of classes.</p>
<section id="all-tasks-and-formulations">
<h3>All Tasks and Formulations<a class="headerlink" href="#all-tasks-and-formulations" title="Link to this heading"></a></h3>
<p>All math model elements for DC lines inherit from <a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline.html#mp.mme_legacy_dcline" title="mp.mme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_legacy_dcline</span></code></a>, which defines only the <a class="reference internal" href="../ref-manual/classes/mp/mm_element.html#mp.mm_element.name" title="mp.mm_element.name"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">name()</span></code></a> method.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<span id="code-mme-legacy-dcline"></span><div class="code-block-caption"><span class="caption-number">Listing 9 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline.html#mp.mme_legacy_dcline" title="mp.mme_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_legacy_dcline</span></code></a></span><a class="headerlink" href="#id11" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">classdef</span> <span class="p">(</span><span class="n">Abstract</span><span class="p">)</span> <span class="n">mme_legacy_dcline</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">mm_element</span>
<span class="linenos">2</span>    <span class="k">methods</span>
<span class="linenos">3</span>        <span class="k">function</span> <span class="n">name</span> <span class="p">=</span> <span class="n">name</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="linenos">4</span>            <span class="n">name</span> <span class="p">=</span> <span class="s">&#39;legacy_dcline&#39;</span><span class="p">;</span>
<span class="linenos">5</span>        <span class="k">end</span>
<span class="linenos">6</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">7</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
</section>
<section id="power-flow">
<h3>Power Flow<a class="headerlink" href="#power-flow" title="Link to this heading"></a></h3>
<p>Since the DC line flows are not dispatchable for the power flow problem, the active power injections are fixed, so there is no need for any additional constraints to be added to the problem. The only role of the math model element in this case is to update the data model after the model has been solved. For this we override the <a class="reference internal" href="../ref-manual/classes/mp/mm_element.html#mp.mm_element.data_model_update_on" title="mp.mm_element.data_model_update_on"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">data_model_update_on()</span></code></a> method, which updates values for the in-service DC lines. Since the AC and DC power flow versions are slightly different, we have separate subclasses for each. In each case, the solved values of the network port injections are used to update the corresponding variables in the main data table.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<span id="code-mme-legacy-dcline-pf-ac"></span><div class="code-block-caption"><span class="caption-number">Listing 10 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline_pf_ac.html#mp.mme_legacy_dcline_pf_ac" title="mp.mme_legacy_dcline_pf_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_legacy_dcline_pf_ac</span></code></a></span><a class="headerlink" href="#id12" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="n">mme_legacy_dcline_pf_ac</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">mme_legacy_dcline</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">data_model_update_on</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="c">%% legacy DC line active power</span>
<span class="linenos"> 5</span>            <span class="n">pp</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s">&#39;port&#39;</span><span class="p">);</span>
<span class="linenos"> 6</span>            <span class="n">s_fr</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">gs_</span><span class="p">(</span><span class="n">pp</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">pp</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="linenos"> 7</span>            <span class="n">s_to</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">gs_</span><span class="p">(</span><span class="n">pp</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="n">pp</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>            <span class="c">%% update in the data model</span>
<span class="linenos">10</span>            <span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
<span class="linenos">11</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="nb">real</span><span class="p">(</span><span class="n">s_fr</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">12</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_fr</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="nb">imag</span><span class="p">(</span><span class="n">s_fr</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">13</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_to</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="nb">real</span><span class="p">(</span><span class="n">s_to</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">14</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_to</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="nb">imag</span><span class="p">(</span><span class="n">s_to</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">15</span>        <span class="k">end</span>
<span class="linenos">16</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">17</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id13">
<span id="code-mme-legacy-dcline-pf-dc"></span><div class="code-block-caption"><span class="caption-number">Listing 11 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline_pf_dc.html#mp.mme_legacy_dcline_pf_dc" title="mp.mme_legacy_dcline_pf_dc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_legacy_dcline_pf_dc</span></code></a></span><a class="headerlink" href="#id13" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="n">mme_legacy_dcline_pf_dc</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">mme_legacy_dcline</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">data_model_update_on</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="c">%% legacy DC line active power</span>
<span class="linenos"> 5</span>            <span class="n">pp</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s">&#39;port&#39;</span><span class="p">);</span>
<span class="linenos"> 6</span>            <span class="n">p_fr</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">gp</span><span class="p">(</span><span class="n">pp</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">pp</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="linenos"> 7</span>            <span class="n">p_to</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">gp</span><span class="p">(</span><span class="n">pp</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="n">pp</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>            <span class="c">%% update in the data model</span>
<span class="linenos">10</span>            <span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
<span class="linenos">11</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">p_fr</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">12</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_fr</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">13</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_to</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="n">p_to</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">14</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_to</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">15</span>        <span class="k">end</span>
<span class="linenos">16</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">17</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
</section>
<section id="optimal-power-flow">
<h3>Optimal Power Flow<a class="headerlink" href="#optimal-power-flow" title="Link to this heading"></a></h3>
<p>For the OPF, there are a number of additions, including the constraint on the “from” and “to” end flows from <a class="reference internal" href="#equation-eq-legacy-dcline-power-constraint">(26)</a> and any cost on the flow, which could be polynomial or piecewise linear. All of these are identical for AC and DC formulations, so we implement them in a class <a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline_opf.html#mp.mme_legacy_dcline_opf" title="mp.mme_legacy_dcline_opf"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_legacy_dcline_opf</span></code></a> that will serve as a parent for both formulations.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<span id="code-mme-legacy-dcline-opf"></span><div class="code-block-caption"><span class="caption-number">Listing 12 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline_opf.html#mp.mme_legacy_dcline_opf" title="mp.mme_legacy_dcline_opf"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_legacy_dcline_opf</span></code></a></span><a class="headerlink" href="#id14" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="p">(</span><span class="n">Abstract</span><span class="p">)</span> <span class="n">mme_legacy_dcline_opf</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">mme_legacy_dcline</span>
<span class="linenos"> 2</span>    <span class="k">properties</span>
<span class="linenos"> 3</span>        <span class="n">cost</span>
<span class="linenos"> 4</span>    <span class="k">end</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>    <span class="k">methods</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>        <span class="c">% (listed and described individually below)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">11</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>This class adds a <a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline_opf.html#mp.mme_legacy_dcline_opf.cost" title="mp.mme_legacy_dcline_opf.cost"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">cost</span></code></a> property which holds the necessary cost data in a form that is convenient for constructing the math model costs. This field is populated by the <a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline_opf.html#mp.mme_legacy_dcline_opf.build_cost_params" title="mp.mme_legacy_dcline_opf.build_cost_params"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">build_cost_params()</span></code></a> method by calling a method of the same name in the corresponding data model element.</p>
<div class="highlight-octave notranslate" id="code-mme-legacy-dcline-opf-build-cost-params"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">build_cost_params</span><span class="p">(</span>obj, dm<span class="p">)</span>
<span class="w">    </span><span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">cost</span> <span class="p">=</span> <span class="n">dme</span><span class="p">.</span><span class="n">build_cost_params</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Any piecewise linear costs included in the cost data are implemented using a constrained cost variable (CCV) approach, just as with generator costs. This means we need to add cost variables and a set of linear constraints for each of these elements. First, we add an <a class="reference internal" href="../ref-manual/classes/mp/mm_element.html#mp.mm_element.add_vars" title="mp.mm_element.add_vars"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_vars()</span></code></a> method which first builds the cost data from the data model, then adds a variable named <code class="docutils literal notranslate"><span class="pre">ydc</span></code> to the math model, with dimenion equal to the number of piecewise linear costs.</p>
<div class="highlight-octave notranslate" id="code-mme-legacy-dcline-opf-add-vars"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">add_vars</span><span class="p">(</span>obj, mm, nm, dm, mpopt<span class="p">)</span>
<span class="w">    </span><span class="c">%% collect/construct all legacy DC line cost parameters</span>
    <span class="n">obj</span><span class="p">.</span><span class="n">build_cost_params</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>

    <span class="c">%% piecewise linear costs</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">pwl</span><span class="p">.</span><span class="n">n</span>
        <span class="n">mm</span><span class="p">.</span><span class="n">add_var</span><span class="p">(</span><span class="s">&#39;ydc&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">pwl</span><span class="p">.</span><span class="n">n</span><span class="p">);</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>We also override <a class="reference internal" href="../ref-manual/classes/mp/mm_element.html#mp.mm_element.add_constraints" title="mp.mm_element.add_constraints"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_constraints()</span></code></a> to add both the constraint for <a class="reference internal" href="#equation-eq-legacy-dcline-power-constraint">(26)</a>, a linear equality constrain on the <code class="docutils literal notranslate"><span class="pre">Pdcf</span></code> and <code class="docutils literal notranslate"><span class="pre">Pdct</span></code> optimization variables, as well as the constraints for any piecewise linear costs, which involve <code class="docutils literal notranslate"><span class="pre">Pdcf</span></code> and <code class="docutils literal notranslate"><span class="pre">ydc</span></code>.</p>
<div class="highlight-octave notranslate" id="code-mme-legacy-dcline-opf-add-constraints"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">add_constraints</span><span class="p">(</span>obj, mm, nm, dm, mpopt<span class="p">)</span>
<span class="w">    </span><span class="c">%% add constraint on active flows and ends of DC line</span>
    <span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
    <span class="n">A</span> <span class="p">=</span> <span class="p">[</span><span class="nb">spdiags</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">loss1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span><span class="nb">speye</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">n</span><span class="p">)];</span>
    <span class="n">b</span> <span class="p">=</span> <span class="o">-</span><span class="n">dme</span><span class="p">.</span><span class="n">loss0</span><span class="p">;</span>
    <span class="n">mm</span><span class="p">.</span><span class="n">add_lin_constraint</span><span class="p">(</span><span class="s">&#39;dcline_legacy&#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;Pdcf&#39;</span><span class="p">,</span> <span class="s">&#39;Pdct&#39;</span><span class="p">});</span>

    <span class="c">%% piecewise linear costs</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">pwl</span><span class="p">.</span><span class="n">n</span>
        <span class="n">mm</span><span class="p">.</span><span class="n">add_lin_constraint</span><span class="p">(</span><span class="s">&#39;ycondc&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">pwl</span><span class="p">.</span><span class="n">A</span><span class="p">,</span> <span class="p">[],</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">pwl</span><span class="p">.</span><span class="n">b</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;Pdcf&#39;</span><span class="p">,</span> <span class="s">&#39;ydc&#39;</span><span class="p">});</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../ref-manual/classes/mp/mm_element.html#mp.mm_element.add_costs" title="mp.mm_element.add_costs"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_costs()</span></code></a> method adds the costs to the math model. As with generators, there are three kinds, polynomial costs of order less than 3, added as quadratic costs, polynomial costs of order 3 or greater, added as general nonlinear costs, and piecewise linear costs, added as simple linear costs on the <code class="docutils literal notranslate"><span class="pre">ydc</span></code> optimization variables we added for this purpose.</p>
<div class="highlight-octave notranslate" id="code-mme-legacy-dcline-opf-add-costs"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">add_costs</span><span class="p">(</span>obj, mm, nm, dm, mpopt<span class="p">)</span>
<span class="w">    </span><span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">)</span>
        <span class="c">%% (quadratic) polynomial costs on Pdcf</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="nb">poly</span><span class="p">.</span><span class="n">have_quad_cost</span>
            <span class="n">mm</span><span class="p">.</span><span class="n">add_quad_cost</span><span class="p">(</span><span class="s">&#39;polPdcf&#39;</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="nb">poly</span><span class="p">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="nb">poly</span><span class="p">.</span><span class="n">c</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="nb">poly</span><span class="p">.</span><span class="n">k</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;Pdcf&#39;</span><span class="p">});</span>
        <span class="k">end</span>

        <span class="c">%% (order 3 and higher) polynomial costs on Pg</span>
        <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="nb">poly</span><span class="p">.</span><span class="n">i3</span><span class="p">)</span>
            <span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
            <span class="n">cost_Pdcf</span> <span class="p">=</span> <span class="p">@(</span><span class="n">xx</span><span class="p">)</span><span class="n">mp</span><span class="p">.</span><span class="n">cost_table</span><span class="p">.</span><span class="n">poly_cost_fcn</span><span class="p">(</span> <span class="p">...</span>
                <span class="n">xx</span><span class="p">,</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">poly_coef</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">,</span> <span class="p">:),</span> <span class="p">...</span>
                <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="nb">poly</span><span class="p">.</span><span class="n">i3</span><span class="p">);</span>
            <span class="n">mm</span><span class="p">.</span><span class="n">add_nln_cost</span><span class="p">(</span><span class="s">&#39;polPdcf&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cost_Pdcf</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;Pdcf&#39;</span><span class="p">});</span>
        <span class="k">end</span>

        <span class="c">%% piecewise linear costs</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">pwl</span><span class="p">.</span><span class="n">n</span>
            <span class="n">mm</span><span class="p">.</span><span class="n">add_quad_cost</span><span class="p">(</span><span class="s">&#39;pwldc&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="nb">ones</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">pwl</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;ydc&#39;</span><span class="p">});</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Finally, a math model element for the OPF can provide an initial starting point for any variables it adds. This is implemented using the <code class="xref mat mat-meth docutils literal notranslate"><span class="pre">interior_x0</span></code> method.</p>
<div class="highlight-octave notranslate" id="code-mme-legacy-dcline-opf-interior-x0"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>x0<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">interior_x0</span><span class="p">(</span>obj, mm, nm, dm, x0<span class="p">)</span>
<span class="w">    </span><span class="c">%% set gen cost variables to something feasible</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">obj</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">pwl</span><span class="p">.</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">vv</span> <span class="p">=</span> <span class="n">mm</span><span class="p">.</span><span class="n">get_idx</span><span class="p">();</span>
        <span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
        <span class="n">maxc</span> <span class="p">=</span> <span class="n">max_pwl_cost</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">cost</span><span class="p">);</span>
        <span class="n">x0</span><span class="p">(</span><span class="n">vv</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">ydc</span><span class="p">:</span><span class="n">vv</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">ydc</span><span class="p">)</span> <span class="p">=</span> <span class="n">maxc</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">maxc</span><span class="p">);</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<section id="data-model-update">
<h4>Data Model Update<a class="headerlink" href="#data-model-update" title="Link to this heading"></a></h4>
<p>As with the power flow, the updating of the data model is different for the AC and DC formulations, so we have two concrete classes for OPF, both of which override the <a class="reference internal" href="../ref-manual/classes/mp/mm_element.html#mp.mm_element.data_model_update_on" title="mp.mm_element.data_model_update_on"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">data_model_update_on</span></code></a> method.</p>
<p>In each case, as with the power flow, the flows are pulled from the values of the network port injections. The various constraint shadow prices, on the other hand, are pulled from the mathmatical model solution multipliers on the appropriate variable limits.</p>
<section id="ac-optimal-power-flow">
<h5>AC Optimal Power Flow<a class="headerlink" href="#ac-optimal-power-flow" title="Link to this heading"></a></h5>
<p>In the AC case, the voltage setpoints at the ends of DC lines are pulled from the network model node voltages multiplied by the appropriate incidence matrices to map them to the corresponding DC lines.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<span id="code-mme-legacy-dcline-opf-ac"></span><div class="code-block-caption"><span class="caption-number">Listing 13 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline_opf_ac.html#mp.mme_legacy_dcline_opf_ac" title="mp.mme_legacy_dcline_opf_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_legacy_dcline_opf_ac</span></code></a></span><a class="headerlink" href="#id15" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="n">mme_legacy_dcline_opf_ac</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">mme_legacy_dcline_opf</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">data_model_update_on</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
<span class="linenos"> 5</span>            <span class="n">nme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">network_model_element</span><span class="p">(</span><span class="n">nm</span><span class="p">);</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>            <span class="c">%% legacy DC line active power</span>
<span class="linenos"> 8</span>            <span class="n">pp</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s">&#39;port&#39;</span><span class="p">);</span>
<span class="linenos"> 9</span>            <span class="n">s_fr</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">gs_</span><span class="p">(</span><span class="n">pp</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">pp</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="linenos">10</span>            <span class="n">s_to</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">gs_</span><span class="p">(</span><span class="n">pp</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="n">pp</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">11</span>            <span class="n">vm_setpoint</span> <span class="p">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nme</span><span class="p">.</span><span class="n">C</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">nm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">v</span><span class="p">);</span>
<span class="linenos">12</span>
<span class="linenos">13</span>            <span class="c">%% shadow prices on legacy DC line limits</span>
<span class="linenos">14</span>            <span class="n">vv</span> <span class="p">=</span> <span class="n">mm</span><span class="p">.</span><span class="n">get_idx</span><span class="p">();</span>
<span class="linenos">15</span>            <span class="n">lambda</span> <span class="p">=</span> <span class="n">mm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">lambda</span><span class="p">;</span>
<span class="linenos">16</span>            <span class="n">mu_p_fr_lb</span> <span class="p">=</span> <span class="n">lambda</span><span class="p">.</span><span class="nb">lower</span><span class="p">(</span><span class="n">vv</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">Pdcf</span><span class="p">:</span><span class="n">vv</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">Pdcf</span><span class="p">);</span>
<span class="linenos">17</span>            <span class="n">mu_p_fr_ub</span> <span class="p">=</span> <span class="n">lambda</span><span class="p">.</span><span class="nb">upper</span><span class="p">(</span><span class="n">vv</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">Pdcf</span><span class="p">:</span><span class="n">vv</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">Pdcf</span><span class="p">);</span>
<span class="linenos">18</span>            <span class="n">mu_q_fr_lb</span> <span class="p">=</span> <span class="n">lambda</span><span class="p">.</span><span class="nb">lower</span><span class="p">(</span><span class="n">vv</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">Qdcf</span><span class="p">:</span><span class="n">vv</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">Qdcf</span><span class="p">);</span>
<span class="linenos">19</span>            <span class="n">mu_q_fr_ub</span> <span class="p">=</span> <span class="n">lambda</span><span class="p">.</span><span class="nb">upper</span><span class="p">(</span><span class="n">vv</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">Qdcf</span><span class="p">:</span><span class="n">vv</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">Qdcf</span><span class="p">);</span>
<span class="linenos">20</span>            <span class="n">mu_q_to_lb</span> <span class="p">=</span> <span class="n">lambda</span><span class="p">.</span><span class="nb">lower</span><span class="p">(</span><span class="n">vv</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">Qdct</span><span class="p">:</span><span class="n">vv</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">Qdct</span><span class="p">);</span>
<span class="linenos">21</span>            <span class="n">mu_q_to_ub</span> <span class="p">=</span> <span class="n">lambda</span><span class="p">.</span><span class="nb">upper</span><span class="p">(</span><span class="n">vv</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">Qdct</span><span class="p">:</span><span class="n">vv</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">Qdct</span><span class="p">);</span>
<span class="linenos">22</span>
<span class="linenos">23</span>            <span class="c">%% update in the data model</span>
<span class="linenos">24</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="nb">real</span><span class="p">(</span><span class="n">s_fr</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">25</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_fr</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="nb">imag</span><span class="p">(</span><span class="n">s_fr</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">26</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_to</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="nb">real</span><span class="p">(</span><span class="n">s_to</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">27</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_to</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="nb">imag</span><span class="p">(</span><span class="n">s_to</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">28</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">vm_setpoint_fr</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">vm_setpoint</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dme</span><span class="p">.</span><span class="n">n</span><span class="p">);</span>
<span class="linenos">29</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">vm_setpoint_to</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">vm_setpoint</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="p">);</span>
<span class="linenos">30</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_lb</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">mu_p_fr_lb</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">31</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_ub</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">mu_p_fr_ub</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">32</span>            <span class="c">%% because of sign swap on reactive quantities, bounds are swapped</span>
<span class="linenos">33</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_q_fr_lb</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">mu_q_fr_ub</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">34</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_q_fr_ub</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">mu_q_fr_lb</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">35</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_q_to_lb</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">mu_q_to_ub</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">36</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_q_to_ub</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">mu_q_to_lb</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">37</span>        <span class="k">end</span>
<span class="linenos">38</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">39</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
</section>
<section id="dc-optimal-power-flow">
<h5>DC Optimal Power Flow<a class="headerlink" href="#dc-optimal-power-flow" title="Link to this heading"></a></h5>
<div class="literal-block-wrapper docutils container" id="id16">
<span id="code-mme-legacy-dcline-opf-dc"></span><div class="code-block-caption"><span class="caption-number">Listing 14 </span><span class="caption-text"><a class="reference internal" href="../ref-manual/classes/mp/mme_legacy_dcline_opf_dc.html#mp.mme_legacy_dcline_opf_dc" title="mp.mme_legacy_dcline_opf_dc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_legacy_dcline_opf_dc</span></code></a></span><a class="headerlink" href="#id16" title="Link to this code"></a></div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">classdef</span> <span class="n">mme_legacy_dcline_opf_dc</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">mme_legacy_dcline_opf</span>
<span class="linenos"> 2</span>    <span class="k">methods</span>
<span class="linenos"> 3</span>        <span class="k">function</span> <span class="n">obj</span> <span class="p">=</span> <span class="n">data_model_update_on</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">)</span>
<span class="linenos"> 4</span>            <span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>            <span class="c">%% legacy DC line active power</span>
<span class="linenos"> 7</span>            <span class="n">pp</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s">&#39;port&#39;</span><span class="p">);</span>
<span class="linenos"> 8</span>            <span class="n">p_fr</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">gp</span><span class="p">(</span><span class="n">pp</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">pp</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="linenos"> 9</span>            <span class="n">p_to</span> <span class="p">=</span> <span class="n">nm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">gp</span><span class="p">(</span><span class="n">pp</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="n">pp</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">legacy_dcline</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">10</span>
<span class="linenos">11</span>            <span class="c">%% shadow prices on legacy DC line limits</span>
<span class="linenos">12</span>            <span class="n">vv</span> <span class="p">=</span> <span class="n">mm</span><span class="p">.</span><span class="n">get_idx</span><span class="p">();</span>
<span class="linenos">13</span>            <span class="n">lambda</span> <span class="p">=</span> <span class="n">mm</span><span class="p">.</span><span class="n">soln</span><span class="p">.</span><span class="n">lambda</span><span class="p">;</span>
<span class="linenos">14</span>            <span class="n">mu_p_fr_lb</span> <span class="p">=</span> <span class="n">lambda</span><span class="p">.</span><span class="nb">lower</span><span class="p">(</span><span class="n">vv</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">Pdcf</span><span class="p">:</span><span class="n">vv</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">Pdcf</span><span class="p">);</span>
<span class="linenos">15</span>            <span class="n">mu_p_fr_ub</span> <span class="p">=</span> <span class="n">lambda</span><span class="p">.</span><span class="nb">upper</span><span class="p">(</span><span class="n">vv</span><span class="p">.</span><span class="n">i1</span><span class="p">.</span><span class="n">Pdcf</span><span class="p">:</span><span class="n">vv</span><span class="p">.</span><span class="n">iN</span><span class="p">.</span><span class="n">Pdcf</span><span class="p">);</span>
<span class="linenos">16</span>
<span class="linenos">17</span>            <span class="c">%% update in the data model</span>
<span class="linenos">18</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_fr</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">p_fr</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">19</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_fr</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">20</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">p_to</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="n">p_to</span> <span class="o">*</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">21</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">q_to</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">22</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_lb</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">mu_p_fr_lb</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">23</span>            <span class="n">dme</span><span class="p">.</span><span class="n">tab</span><span class="p">.</span><span class="n">mu_p_fr_ub</span><span class="p">(</span><span class="n">dme</span><span class="p">.</span><span class="n">on</span><span class="p">)</span> <span class="p">=</span> <span class="n">mu_p_fr_ub</span> <span class="o">/</span> <span class="n">dm</span><span class="p">.</span><span class="n">base_mva</span><span class="p">;</span>
<span class="linenos">24</span>        <span class="k">end</span>
<span class="linenos">25</span>    <span class="k">end</span>     <span class="c">%% methods</span>
<span class="linenos">26</span><span class="k">end</span>         <span class="c">%% classdef</span>
</pre></div>
</div>
</div>
<p>The complete source for the DC line mathematical model element classes above can be found in:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/mme_legacy_dcline.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/mme_legacy_dcline.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/mme_legacy_dcline_pf_ac.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/mme_legacy_dcline_pf_ac.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/mme_legacy_dcline_pf_dc.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/mme_legacy_dcline_pf_dc.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/mme_legacy_dcline_opf.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/mme_legacy_dcline_opf.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/mme_legacy_dcline_opf_ac.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/mme_legacy_dcline_opf_ac.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/mme_legacy_dcline_opf_dc.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/mme_legacy_dcline_opf_dc.m</span></code></a></p></li>
</ul>
</section>
</section>
</section>
</section>
<section id="using-the-new-element">
<h2>Using the New Element<a class="headerlink" href="#using-the-new-element" title="Link to this heading"></a></h2>
<p>Now that each of the element classes for the DC line have been implemented for each of the model layers and the data model converter, these classes need to be included when running a power flow, continuation power flow, or optimal power flow. If this implementation for DC lines were to be added to the set of standard elements, along side of buses, branches, and generators, for example, then the classes would be added to the lists assigned to the <a class="reference internal" href="../ref-manual/classes/mp/element_container.html#mp.element_container.element_classes" title="mp.element_container.element_classes"><code class="xref mat mat-attr docutils literal notranslate"><span class="pre">element_classes</span></code></a> property in the constructor of the appropriate model container class. E.g. <a class="reference internal" href="../ref-manual/classes/mp/nme_legacy_dcline_dc.html#mp.nme_legacy_dcline_dc" title="mp.nme_legacy_dcline_dc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.nme_legacy_dcline_dc</span></code></a> in <a class="reference internal" href="../ref-manual/classes/mp/net_model_dc.html#mp.net_model_dc" title="mp.net_model_dc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.net_model_dc</span></code></a>, and <code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_legacy_opf_dcline_ac</span></code> in <a class="reference internal" href="../ref-manual/classes/mp/math_model_opf_acc.html#mp.math_model_opf_acc" title="mp.math_model_opf_acc"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.math_model_opf_acc</span></code></a> and <a class="reference internal" href="../ref-manual/classes/mp/math_model_opf_acp.html#mp.math_model_opf_acp" title="mp.math_model_opf_acp"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.math_model_opf_acp</span></code></a>.</p>
<p>However, for user additions that are not being contributed for inclusion in the standard <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> distribution, the original <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> source need not, and should not, be modified. Instead, we use the <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> Extension API.</p>
<p>The <a class="reference internal" href="extension.html#howto-extension"><span class="std std-ref">How to Create an Extension</span></a> guide explains how to package the DC line classes into an easy-to-use <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> extension <a class="reference internal" href="../ref-manual/classes/mp/xt_legacy_dcline.html#mp.xt_legacy_dcline" title="mp.xt_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.xt_legacy_dcline</span></code></a>, that can be used directly by <a class="reference internal" href="../ref-manual/functions/run_pf.html#run_pf" title="run_pf"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">run_pf()</span></code></a>,  <a class="reference internal" href="../ref-manual/functions/run_cpf.html#run_cpf" title="run_cpf"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">run_cpf()</span></code></a>, and  <a class="reference internal" href="../ref-manual/functions/run_opf.html#run_opf" title="run_opf"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">run_opf()</span></code></a>, as shown in the example below.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">run_opf</span><span class="p">(</span><span class="s">&#39;t_case9_dcline&#39;</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">,</span> <span class="s">&#39;mpx&#39;</span><span class="p">,</span> <span class="n">mp</span><span class="p">.</span><span class="n">xt_legacy_dcline</span><span class="p">);</span>
</pre></div>
</div>
<p>Go to <a class="reference internal" href="extension.html#howto-extension"><span class="std std-ref">How to Create an Extension</span></a>.</p>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../ref-manual/classes/index.html#ref-xt-legacy-dcline-classes"><span class="std std-ref">Legacy DC Line Extension</span></a> (<a class="reference internal" href="../ref-manual/classes/mp/xt_legacy_dcline.html#mp.xt_legacy_dcline" title="mp.xt_legacy_dcline"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.xt_legacy_dcline</span></code></a>)</p></li>
</ul>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="gizmo-element/index.html">A Test Gizmo Element Type</a></li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../most/functions/mpoption_info_most.html" class="btn btn-neutral float-left" title="mpoption_info_most" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gizmo-element/index.html" class="btn btn-neutral float-right" title="A Test Gizmo Element Type" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1996-2024, Power Systems Engineering Research Center (PSERC).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>