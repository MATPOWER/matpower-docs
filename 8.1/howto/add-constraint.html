<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to Add an OPF Constraint &mdash; MATPOWER Documentation 8.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../_static/css/matpower.css?v=f6466fd7" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=1f41a3ab"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>window.MathJax = {"loader": {"load": ["[tex]/upgreek"]}, "tex": {"packages": {"[+]": ["upgreek"]}, "macros": {"dg": "\\sp\\dagger", "trans": ["{#1}^{\\mathsf{T}}", 1], "conj": ["{#1}^{\\ast}", 1], "hc": ["{#1}^{\\dg}", 1], "hconj": ["{#1}^{+}", 1], "diag": ["\\left[^\\smallsetminus{#1}_\\smallsetminus\\right]", 1], "diagg": ["\\left[\\smash{#1}\\right]", 1], "cdiag": ["\\conj{\\diag{#1}}", 1], "der": ["\\frac{\\partial{#1}}{\\partial{#2}}", 2], "dersx": ["\\frac{\\partial^2{#1}}{\\partial{#2}^2}", 2], "dersxy": ["\\frac{\\partial^2{#1}}{\\partial{#2}\\partial{#3}}", 3], "cscal": ["\\mathrm{#1}", 1], "rvec": ["{\\boldsymbol{#1}}", 1], "cvec": ["\\mathbf{#1}", 1], "rmat": ["{\\boldsymbol{#1}}", 1], "cmat": ["\\mathbf{#1}", 1], "rvecG": ["{\\boldsymbol{#1}}", 1], "cvecG": ["\\boldsymbol{#1}", 1], "rmatG": ["\\boldsymbol{\\mathit{#1}}", 1], "cmatG": ["\\mathbf{#1}", 1], "param": ["\\underline{#1}", 1], "ov": ["{\\overline{#1}}", 1], "zeros": ["\\rvec{0}", 0], "ones": ["\\rvec{1}_{#1}", 1], "onest": ["\\trans{\\rvec{1}}_{#1}", 1], "Id": ["\\diag{\\ones{#1}}", 1], "R": "\\mathbb{R}", "C": "\\mathbb{C}", "av": "\\cvec{a}", "bv": "\\cvec{b}", "cv": "\\cvec{c}", "f": "\\cscal{f}", "F": "\\cvec{f}", "g": "\\rvec{g}", "G": "\\cvec{g}", "h": "\\rvec{h}", "HH": "\\cvec{h}", "x": "\\rvec{x}", "y": "\\rvec{y}", "z": "\\rvec{z}", "l": "\\param{\\rvec{l}}", "u": "\\param{\\rvec{u}}", "li": "\\param{l}_i", "ui": "\\param{u}_i", "b": "\\param{\\rvec{b}}", "c": "\\param{\\rvec{c}}", "Bb": "\\param{\\rmat{B}}", "Hh": "\\param{\\rmat{H}}", "AA": "\\param{\\rmat{A}}", "lq": "\\l_\\textrm{q}", "uq": "\\u_\\textrm{q}", "lqi": "{\\param{l}_\\textrm{q}}_i", "uqi": "{\\param{u}_\\textrm{q}}_i", "QQ": "\\param{\\rmat{Q}}", "q": "\\param{\\rvec{q}}", "k": "\\param{\\rvec{k}}", "Qblk": "\\QQ_\\textrm{blk}", "Xblk": "\\rmat{X}_\\textrm{blk}", "X": "\\cvec{x}", "Z": "\\cvec{z}", "A": "\\cmat{A}", "B": "\\cmat{B}", "alphav": "\\rvecG{\\alpha}", "lam": "\\rvecG{\\lambda}", "lamh": "\\hat{\\lam}", "muv": "\\rvecG{\\mu}", "muhv": "\\hat{\\muv}", "vv": "\\rvec{v}", "vvi": ["\\cscal{v}_{#1}", 1], "V": "\\cvec{v}", "Vh": "\\hat{\\V}", "Vc": "\\conj{\\V}", "Vhc": "\\conj{\\Vh}", "dV": "\\diag{\\V}", "dVh": "\\diag{\\Vh}", "dVc": "\\diag{\\Vc}", "dVhc": "\\diag{\\Vhc}", "inV": "\\cvec{\\Lambda}", "inVh": "\\hat{\\inV}", "inVc": "\\conj{\\inV}", "inVhc": "\\conj{\\inVh}", "dinV": "\\diagg{\\inV}", "dinVh": "\\diagg{\\inVh}", "dinVc": "\\diagg{\\inVc}", "dinVhc": "\\diagg{\\inVhc}", "va": ["\\theta", 0], "vai": ["\\va_{#1}", 1], "Va": ["\\rvec{\\va}", 0], "Vah": ["\\hat{\\Va}", 0], "vm": ["\\nu", 0], "vmi": ["\\nu_{#1}", 1], "Vm": ["\\rvecG{\\nu}", 0], "dVm": "\\diag{\\Vm}", "dVmi": "\\dVm^{-1}", "Vmh": "\\hat{\\Vm}", "dVmh": "\\diag{\\Vmh}", "dVmhi": "\\dVmh^{-1}", "vr": "u", "vri": ["u_{#1}", 1], "vi": "w", "vii": ["w_{#1}", 1], "Vr": "\\rvec{u}", "Vi": "\\rvec{w}", "dVr": "\\diag{\\Vr}", "dVi": "\\diag{\\Vi}", "Vrh": "\\hat{\\Vr}", "Vih": "\\hat{\\Vi}", "dVrh": "\\diag{\\Vrh}", "dVih": "\\diag{\\Vih}", "E": "\\cvec{e}", "Eh": "\\hat{\\E}", "Ec": "\\conj{\\E}", "Ehc": "\\conj{\\Eh}", "dE": "\\diag{\\E}", "dEh": "\\diag{\\Eh}", "dEc": "\\diag{\\Ec}", "dEhc": "\\diag{\\Ehc}", "zr": "{z_r}", "zi": "{z_i}", "Zr": "{\\rvec{z}_r}", "Zi": "{\\rvec{z}_i}", "dlam": "\\diagg{\\lam}", "dlamh": "\\diagg{\\lamh}", "dlamva": "\\diagg{\\lam_\\va}", "dlamvm": "\\diagg{\\lam_\\vm}", "dlamvr": "\\diagg{\\lam_\\vr}", "dlamvi": "\\diagg{\\lam_\\vi}", "dlamzr": "\\diagg{\\lam_\\zr}", "dlamzi": "\\diagg{\\lam_\\zi}", "dlamhva": "\\diagg{\\lamh_\\va}", "dlamhvm": "\\diagg{\\lamh_\\vm}", "dlamhvr": "\\diagg{\\lamh_\\vr}", "dlamhvi": "\\diagg{\\lamh_\\vi}", "dlamhzr": "\\diagg{\\lamh_\\zr}", "dlamhzi": "\\diagg{\\lamh_\\zi}", "dmu": "\\diag{\\muv}", "dmuh": "\\diag{\\muhv}", "kk": "\\rvec{k}", "J": "\\param{\\rmat{J}}", "Jt": "\\trans{\\J}", "Jk": ["\\J_{\\kk_#1}", 1], "Ah": "\\hat{\\A}", "Fh": "\\hat{\\F}", "Gh": "\\hat{\\G}", "gh": "\\hat{\\g}", "fmax": "\\param{\\rvec{f}}_\\mathrm{max}", "gP": "\\g^P", "gPk": ["\\g^{P,#1}", 1], "fhmax": "\\hat{\\param{\\rvec{f}}}_\\mathrm{max}", "ghP": "\\gh^P", "ghPk": ["\\gh^{P,#1}", 1], "GS": "\\G^S", "GI": "\\G^I", "GSk": ["\\G^{S,#1}", 1], "GIk": ["\\G^{I,#1}", 1], "GSsys": "\\GSk{\\mathrm{sys}}", "GIsys": "\\GIk{\\mathrm{sys}}", "gPsys": "\\gPk{\\mathrm{sys}}", "GhS": "\\Gh^S", "GhI": "\\Gh^I", "GhSk": ["\\Gh^{S,#1}", 1], "GhIk": ["\\Gh^{I,#1}", 1], "GhSsys": "\\GhSk{\\mathrm{sys}}", "GhIsys": "\\GhIk{\\mathrm{sys}}", "ghPsys": "\\ghPk{\\mathrm{sys}}", "Ilin": "\\cvec{i}^{lin}", "Ilink": "\\cvec{i}^{lin, k}", "Ilinc": "\\conj{\\Ilin}", "dIlin": "\\diag{\\Ilin}", "dIlinc": "\\diag{\\Ilinc}", "Ilinh": "\\hat{{\\cvec{i}}}^{lin}", "Ilinhk": "\\hat{\\cvec{i}}^{lin, k}", "Ilinhc": "\\conj{\\Ilinh}", "dIlinh": "\\diag{\\Ilinh}", "dIlinhc": "\\diag{\\Ilinhc}", "Slin": "\\cvec{s}^{lin}", "Slink": "\\cvec{s}^{lin, k}", "Slinc": "\\conj{\\Slin}", "dSlin": "\\diag{\\Slin}", "dSlinc": "\\diag{\\Slinc}", "Slinh": "\\hat{\\cvec{s}}^{lin}", "Slinhk": "\\hat{\\cvec{s}}^{lin, k}", "Slinhc": "\\conj{\\Slinh}", "dSlinh": "\\diag{\\Slinh}", "dSlinhc": "\\diag{\\Slinhc}", "Inln": "\\cvec{i}^{nln}", "Inlnk": "\\cvec{i}^{nln, k}", "Snln": "\\cvec{s}^{nln}", "Snlnk": "\\cvec{s}^{nln, k}", "Inlnh": "\\hat{\\cvec{i}}^{nln}", "Inlnhk": "\\hat{\\cvec{i}}^{nln, k}", "Snlnh": "\\hat{\\cvec{s}}^{nln}", "Snlnhk": "\\hat{\\cvec{s}}^{nln, k}", "Aa": "\\param{\\rmat{A}}", "BB": "\\param{\\rmat{B}}", "CC": "\\param{\\rmat{C}}", "DD": "\\param{\\rmat{D}}", "YY": "\\param{\\cmat{Y}}", "iv": "\\param{\\cvec{i}}", "pv": "\\param{\\rvec{p}}", "sv": "\\param{\\cvec{s}}", "KK": "\\param{\\rmat{K}}", "LL": "\\param{\\cmat{L}}", "MM": "\\param{\\cmat{M}}", "NN": "\\param{\\cmat{N}}", "BBh": "\\hat{\\BB}", "YYh": "\\hat{\\YY}", "ivh": "\\hat{\\iv}", "pvh": "\\hat{\\pv}", "svh": "\\hat{\\sv}", "CCh": "\\hat{\\CC}", "KKh": "\\hat{\\KK}", "LLh": "\\hat{\\LL}", "MMh": "\\hat{\\MM}", "NNh": "\\hat{\\NN}", "AT": "\\trans{\\Aa}", "CT": "\\trans{\\CC}", "DT": "\\trans{\\DD}", "Ap": "\\Aa'", "Cp": "\\CC\\:\\!'", "Dp": "\\DD'", "ApT": "\\trans{\\Ap}", "CpT": "\\trans{\\Cp}", "DpT": "\\trans{\\Dp}", "ChT": "\\trans{\\CCh}", "Lc": "\\conj{\\LL}", "LcT": "\\trans{\\Lc}", "Lhc": "\\conj{\\LLh}", "LhcT": "\\trans{\\Lhc}", "MT": "\\trans{\\MM}", "Mc": "\\conj{\\MM}", "McT": "\\trans{\\Mc}", "dMTlam": "\\diag{\\MT \\lam}", "MhT": "\\trans{\\MMh}", "Mhc": "\\conj{\\MMh}", "MhcT": "\\trans{\\Mhc}", "dMhTlam": "\\diag{\\MhT \\lamh}", "Nc": "\\conj{\\NN}", "NcT": "\\trans{\\Nc}", "Nhc": "\\conj{\\NNh}", "NhcT": "\\trans{\\Nhc}", "YT": "\\trans{\\YY}", "Yc": "\\conj{\\YY}", "YcT": "\\trans{\\Yc}", "dYTlam": "\\diag{\\YT \\lam}", "YhT": "\\trans{\\YYh}", "Yhc": "\\conj{\\YYh}", "YhcT": "\\trans{\\Yhc}", "dYhTlam": "\\diag{\\YhT \\lamh}", "I": "\\cvec{i}^S", "s": "\\cvec{s}^I", "Ih": "\\hat{\\cvec{i}}^S", "Sh": "\\hat{\\cvec{s}}^I", "AtX": "\\AT \\X", "CtV": "\\CT \\V", "dCtV": "\\diag{\\CtV}", "DtZ": "\\DT \\Z", "ApTx": "\\ApT \\x", "CpTv": "\\CpT \\vv", "DpTz": "\\DpT \\z"}}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Create an Extension" href="extension.html" />
    <link rel="prev" title="A Test Gizmo Element Type" href="gizmo-element/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #568085" >

          
          
          <a href="../index.html" class="icon icon-home">
            MATPOWER Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org">matpower.org</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/about/get-started/">Get Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Manuals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../users-manual/index.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-manual/index.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> Developer’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref-manual/index.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> Reference Manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mptest/index.html">MP-Test User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mips/index.html">MIPS User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mpom/index.html"><span class="raw-html">MP-Opt-Model</span> User’s Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../most/index.html">MOST User’s Manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/doc/manuals/">All Legacy PDF Manuals</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How To Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="element.html">How to Create a New Element Type</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to Add an OPF Constraint</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#function-and-derivatives">Function and Derivatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-new-constraint">Using the New Constraint</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#original-box-capability-curves">Original “box” capability curves</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oval-capability-curves-via-matpower-options">“Oval” capability curves via <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oval-capability-curves-via-matpower-extension">“Oval” capability curves via <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> extension</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extension.html">How to Create an Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="three-phase.html">How to Run a Three-Phase Power Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="builddocs.html">How to Build the Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tech Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tech-notes.html"><span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> Technical Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/sponsor">Donate</a></li>
<li class="toctree-l1"><a class="reference external" href="https://matpower.org/download">Downloads</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/MATPOWER/matpower">GitHub Project</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #568085" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MATPOWER Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to Add an OPF Constraint</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/howto/add-constraint.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="gizmo-element/index.html" class="btn btn-neutral float-left" title="A Test Gizmo Element Type" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="extension.html" class="btn btn-neutral float-right" title="How to Create an Extension" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-add-an-opf-constraint">
<span id="howto-add-constraint"></span><h1>How to Add an OPF Constraint<a class="headerlink" href="#how-to-add-an-opf-constraint" title="Link to this heading"></a></h1>
<p>This guide describes how to add a nonlinear constraint to an optimal power flow using the <strong>flexible</strong> <span class="raw-html"><strong>M<span style="font-size:smaller">ATPOWER</span></strong></span> <strong>framework</strong>. For this example, we will implement an additional “oval-shaped” PQ capability curve for all generators as shown in <a class="reference internal" href="#fig-oval-cap-curve"><span class="std std-numref">Figure 3</span></a>.</p>
<figure class="align-center" id="id1">
<span id="fig-oval-cap-curve"></span><a class="reference internal image-reference" href="../_images/cap-curve-oval.png"><img alt="Oval PQ Capability Curve" src="../_images/cap-curve-oval.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 3 </span><span class="caption-text">Oval PQ Capability Curve</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>That is, we add the following constraint on the active power <span class="math notranslate nohighlight">\(p\)</span> and reactive power <span class="math notranslate nohighlight">\(q\)</span> injected by each generator.</p>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraint">
<span class="eqno">(70)<a class="headerlink" href="#equation-eq-oval-constraint" title="Link to this equation"></a></span>\[h(p,q) = \frac{(p-\param{p}_0)^2}{\param{a}^2} + \frac{(q-\param{q}_0)^2}{\param{b}^2} - 1 \le 0\]</div>
<p>The parameters <span class="math notranslate nohighlight">\(\param{p}_0\)</span>, <span class="math notranslate nohighlight">\(\param{q}_0\)</span>, <span class="math notranslate nohighlight">\(\param{a}\)</span>, and <span class="math notranslate nohighlight">\(\param{b}\)</span> are defined in terms of the active and reactive lower and upper bounds.</p>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraint-p0">
<span class="eqno">(71)<a class="headerlink" href="#equation-eq-oval-constraint-p0" title="Link to this equation"></a></span>\[\param{p}_0 = \param{p}_\mathrm{min}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraint-q0">
<span class="eqno">(72)<a class="headerlink" href="#equation-eq-oval-constraint-q0" title="Link to this equation"></a></span>\[\begin{split}\param{q}_0 = \frac{1}{2}(\param{q}_\mathrm{max} + \param{q}_\mathrm{min}) \\\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraint-a">
<span class="eqno">(73)<a class="headerlink" href="#equation-eq-oval-constraint-a" title="Link to this equation"></a></span>\[\begin{split}\param{a} = \param{p}_\mathrm{max} - \param{p}_\mathrm{min} \\\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraint-b">
<span class="eqno">(74)<a class="headerlink" href="#equation-eq-oval-constraint-b" title="Link to this equation"></a></span>\[\param{b} = \frac{1}{2}(\param{q}_\mathrm{max} - \param{q}_\mathrm{min})\]</div>
<p>Adding this constraint affects only the mathematical model, with no changes to the data or network model layers. And since it relates only to generators, the implementation belongs in a math model element class for generators. Given that it is only relevant for AC OPF problems, we will override the <a class="reference internal" href="../ref-manual/classes/mp/mme_gen_opf_ac.html#mp.mme_gen_opf_ac" title="mp.mme_gen_opf_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_gen_opf_ac</span></code></a> with a new subclass <a class="reference internal" href="../ref-manual/classes/mp/mme_gen_opf_ac_oval.html#mp.mme_gen_opf_ac_oval" title="mp.mme_gen_opf_ac_oval"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_gen_opf_ac_oval</span></code></a>.</p>
<p>As the constraint is nonlinear, we will need to provide functions or methods to evaluate the constraint function and its first and second derivatives.</p>
<section id="function-and-derivatives">
<h2>Function and Derivatives<a class="headerlink" href="#function-and-derivatives" title="Link to this heading"></a></h2>
<p>If we use <span class="math notranslate nohighlight">\(\rvec{p}\)</span> and <span class="math notranslate nohighlight">\(\rvec{q}\)</span> to represent the vectors of active and reactive powers for all generators, and similarly for the parameters <span class="math notranslate nohighlight">\(\param{\rvec{p}}_0\)</span>, <span class="math notranslate nohighlight">\(\param{\rvec{q}}_0\)</span>, <span class="math notranslate nohighlight">\(\param{\rvec{a}}\)</span>, and <span class="math notranslate nohighlight">\(\param{\rvec{b}}\)</span>, we can write the full vector constraint function as follows, using the notation from <a class="reference internal" href="../dev-manual/notation.html#sec-notation"><span class="std std-ref">Notation</span></a>.</p>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraints">
<span class="eqno">(75)<a class="headerlink" href="#equation-eq-oval-constraints" title="Link to this equation"></a></span>\[\h(\rvec{p},\rvec{q}) = \diag{\frac{1}{\param{\rvec{a}}^2}}(\rvec{p}-\param{\rvec{p}}_0)^2 + \diag{\frac{1}{\param{\rvec{b}}^2}}(\rvec{q}-\param{\rvec{q}}_0)^2 - \rvec{1}\]</div>
<p>The first derivatives are</p>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraints-dhdp">
<span class="eqno">(76)<a class="headerlink" href="#equation-eq-oval-constraints-dhdp" title="Link to this equation"></a></span>\[\h_\rvec{p} = \der{\h}{\rvec{p}} = 2 \diag{\frac{1}{\param{\rvec{a}}^2}} \diag{(\rvec{p}-\param{\rvec{p}}_0)}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraints-dhdq">
<span class="eqno">(77)<a class="headerlink" href="#equation-eq-oval-constraints-dhdq" title="Link to this equation"></a></span>\[\h_\rvec{q} = \der{\h}{\rvec{q}} = 2 \diag{\frac{1}{\param{\rvec{b}}^2}} \diag{(\rvec{q}-\param{\rvec{q}}_0)}\]</div>
<p>And the second derivatives are</p>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraints-d2hdpp">
<span class="eqno">(78)<a class="headerlink" href="#equation-eq-oval-constraints-d2hdpp" title="Link to this equation"></a></span>\[\h_\rvec{pp}(\muv) = \der{}{\rvec{p}}\trans{\h_{\rvec{p}}} \muv = 2 \diag{\muv} \diag{\frac{1}{\param{\rvec{a}}^2}}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraints-d2hdpq">
<span class="eqno">(79)<a class="headerlink" href="#equation-eq-oval-constraints-d2hdpq" title="Link to this equation"></a></span>\[\h_\rvec{pq}(\muv) = \der{}{\rvec{q}}\trans{\h_{\rvec{p}}} \muv = \rmat{0}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraints-d2hdqp">
<span class="eqno">(80)<a class="headerlink" href="#equation-eq-oval-constraints-d2hdqp" title="Link to this equation"></a></span>\[\h_\rvec{qp}(\muv) = \der{}{\rvec{p}}\trans{\h_{\rvec{q}}} \muv = \rmat{0}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-oval-constraints-d2hdqq">
<span class="eqno">(81)<a class="headerlink" href="#equation-eq-oval-constraints-d2hdqq" title="Link to this equation"></a></span>\[\h_\rvec{qq}(\muv) = \der{}{\rvec{q}}\trans{\h_{\rvec{q}}} \muv = 2 \diag{\muv} \diag{\frac{1}{\param{\rvec{b}}^2}}\]</div>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading"></a></h2>
<p>As mentioned above, the implementation will take the form of a new subclass, <a class="reference internal" href="../ref-manual/classes/mp/mme_gen_opf_ac_oval.html#mp.mme_gen_opf_ac_oval" title="mp.mme_gen_opf_ac_oval"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_gen_opf_ac_oval</span></code></a>, of the existing <a class="reference internal" href="../ref-manual/classes/mp/mme_gen_opf_ac.html#mp.mme_gen_opf_ac" title="mp.mme_gen_opf_ac"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.mme_gen_opf_ac</span></code></a> class.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span> <span class="n">mme_gen_opf_ac_oval</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">mme_gen_opf_ac</span>
    <span class="k">methods</span>
        <span class="c">% (defined below)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>We will be using the <a class="reference internal" href="../mpom/classes/opt_model.html#opt_model.add_nln_constraint" title="opt_model.add_nln_constraint"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_nln_constraint()</span></code></a> method of the mathematical model object to add the constraints to the model, but first we must define the two methods that evaluate the constraints and derivatives. Since we will specify only the generators’ active and reactive injection variables as inputs, they will be passed to these functions as the cell array <code class="docutils literal notranslate"><span class="pre">xx</span></code>, with the vector of active powers in the first element and reactive powers in the second. Furthermore, these methods are implemented to allow the constraints to be evaluated for some subset of all generators, indexed by a vector <code class="docutils literal notranslate"><span class="pre">idx</span></code>.</p>
<p>The first method evaluates the constraint function and, optionally, its Jacobian, that is <a class="reference internal" href="#equation-eq-oval-constraints">(75)</a>–<a class="reference internal" href="#equation-eq-oval-constraints-dhdq">(77)</a>.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[h, dh] = oval_pq_capability_fcn</span><span class="p">(</span>obj, xx, idx, p0, q0, a2, b2<span class="p">)</span>
<span class="w">    </span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="p">=</span> <span class="nb">deal</span><span class="p">(</span><span class="n">xx</span><span class="p">{:});</span>
    <span class="n">ng</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">p</span> <span class="p">=</span> <span class="n">p</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
        <span class="n">q</span> <span class="p">=</span> <span class="n">q</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
    <span class="k">end</span>

    <span class="c">%% evaluate constraint function</span>
    <span class="n">h</span> <span class="p">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span> <span class="o">./</span> <span class="n">a2</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">q0</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span> <span class="o">./</span> <span class="n">b2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c">%% evaluate constraint Jacobian</span>
    <span class="k">if</span> <span class="nb">nargout</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">dhdp</span> <span class="p">=</span> <span class="nb">spdiags</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">)</span> <span class="o">./</span> <span class="n">a2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">);</span>
        <span class="n">dhdq</span> <span class="p">=</span> <span class="nb">spdiags</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">q0</span><span class="p">)</span> <span class="o">./</span> <span class="n">b2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">);</span>
        <span class="n">dh</span> <span class="p">=</span> <span class="p">[</span><span class="n">dhdp</span> <span class="n">dhdq</span><span class="p">];</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The second evaluates the Hessian terms <a class="reference internal" href="#equation-eq-oval-constraints-d2hdpp">(78)</a>–<a class="reference internal" href="#equation-eq-oval-constraints-d2hdqq">(81)</a>.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>d2H<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">oval_pq_capability_hess</span><span class="p">(</span>obj, xx, lam, idx, p0, q0, a2, b2<span class="p">)</span>
<span class="w">    </span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="p">=</span> <span class="nb">deal</span><span class="p">(</span><span class="n">xx</span><span class="p">{:});</span>
    <span class="k">if</span> <span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">p</span> <span class="p">=</span> <span class="n">p</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
        <span class="n">q</span> <span class="p">=</span> <span class="n">q</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="n">ng</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">zz</span> <span class="p">=</span> <span class="nb">sparse</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">);</span>

    <span class="c">%% evaluate constraint Hessian</span>
    <span class="n">d2H_pp</span> <span class="p">=</span> <span class="nb">sparse</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">lam</span> <span class="o">./</span> <span class="n">a2</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">);</span>
    <span class="n">d2H_qq</span> <span class="p">=</span> <span class="nb">sparse</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">ng</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">lam</span> <span class="o">./</span> <span class="n">b2</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">ng</span><span class="p">);</span>
    <span class="n">d2H</span> <span class="p">=</span> <span class="p">[</span> <span class="n">d2H_pp</span>  <span class="n">zz</span><span class="p">;</span>
            <span class="n">zz</span>      <span class="n">d2H_qq</span> <span class="p">];</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Now we override the <a class="reference internal" href="../ref-manual/classes/mp/mm_element.html#mp.mm_element.add_constraints" title="mp.mm_element.add_constraints"><code class="xref mat mat-meth docutils literal notranslate"><span class="pre">add_constraints()</span></code></a> method to set up the parameters needed for the methods above, and to add the constraints to the model. The constraints are added as a set of nonlinear constraints named <code class="docutils literal notranslate"><span class="pre">'PQoval'</span></code>, defined as functions of the optimization variables named <code class="docutils literal notranslate"><span class="pre">'Pg'</span></code> and <code class="docutils literal notranslate"><span class="pre">'Qg'</span></code>.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>obj<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">add_constraints</span><span class="p">(</span>obj, mm, nm, dm, mpopt<span class="p">)</span>
<span class="w">    </span><span class="n">dme</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">data_model_element</span><span class="p">(</span><span class="n">dm</span><span class="p">);</span>

    <span class="c">%% generator PQ capability curve constraints</span>
    <span class="n">idx</span> <span class="p">=</span> <span class="p">[];</span>       <span class="c">%% which generators get this constraint</span>
                    <span class="c">%% empty ==&gt; all</span>
    <span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">idx</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">dme</span><span class="p">.</span><span class="n">n</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span>
    <span class="k">end</span>

    <span class="c">%% get generator limit data</span>
    <span class="n">p_lb</span> <span class="p">=</span> <span class="n">dme</span><span class="p">.</span><span class="n">pg_lb</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
    <span class="n">p_ub</span> <span class="p">=</span> <span class="n">dme</span><span class="p">.</span><span class="n">pg_ub</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
    <span class="n">q_lb</span> <span class="p">=</span> <span class="n">dme</span><span class="p">.</span><span class="n">qg_lb</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
    <span class="n">q_ub</span> <span class="p">=</span> <span class="n">dme</span><span class="p">.</span><span class="n">qg_ub</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>

    <span class="c">%% compute oval specs, all vectors, 4 params per gen</span>
    <span class="n">a2</span> <span class="p">=</span> <span class="p">(</span><span class="n">p_ub</span> <span class="o">-</span> <span class="n">p_lb</span><span class="p">)</span> <span class="o">.^</span> <span class="mi">2</span><span class="p">;</span>        <span class="c">% square of horizontal (p) radius</span>
    <span class="n">b2</span> <span class="p">=</span> <span class="p">((</span><span class="n">q_ub</span> <span class="o">-</span> <span class="n">q_lb</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">.^</span> <span class="mi">2</span><span class="p">;</span>  <span class="c">% square of vertical (q) radius</span>
    <span class="n">p0</span> <span class="p">=</span> <span class="n">p_lb</span><span class="p">;</span>                      <span class="c">% horizontal (p) center</span>
    <span class="n">q0</span> <span class="p">=</span> <span class="p">(</span><span class="n">q_ub</span> <span class="o">+</span> <span class="n">q_lb</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>         <span class="c">% vertical (q) center</span>

    <span class="c">%% add constraint</span>
    <span class="n">fcn</span> <span class="p">=</span> <span class="p">@(</span><span class="n">xx</span><span class="p">)</span><span class="n">oval_pq_capability_fcn</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">b2</span><span class="p">);</span>
    <span class="nb">hess</span> <span class="p">=</span> <span class="p">@(</span><span class="n">xx</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span><span class="n">oval_pq_capability_hess</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">b2</span><span class="p">);</span>
    <span class="n">mm</span><span class="p">.</span><span class="n">add_nln_constraint</span><span class="p">(</span><span class="s">&#39;PQoval&#39;</span><span class="p">,</span> <span class="n">dme</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fcn</span><span class="p">,</span> <span class="nb">hess</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;Pg&#39;</span><span class="p">,</span> <span class="s">&#39;Qg&#39;</span><span class="p">});</span>

    <span class="c">%% call parent</span>
    <span class="n">add_constraints</span><span class="p">@</span><span class="n">mp</span><span class="p">.</span><span class="n">mme_gen_opf_ac</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="using-the-new-constraint">
<h2>Using the New Constraint<a class="headerlink" href="#using-the-new-constraint" title="Link to this heading"></a></h2>
<p>To activate this new constraint, all that is needed is to let <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> know we would like to use our new class in place of the default when running an AC OPF. There are two ways to do this as described in the <a class="reference internal" href="../dev-manual/customizing.html#sec-customizing"><span class="std std-ref">Customizing </span></a> section in the <a class="reference internal" href="../dev-manual/index.html#matpower-dev-manual"><span class="std std-ref">MATPOWER Developer’s Manual</span></a>.</p>
<ol class="arabic simple">
<li><p>Specify the override directly in your <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> options struct.</p></li>
</ol>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">mpopt</span> <span class="p">=</span> <span class="n">mpoption</span><span class="p">();</span>
<span class="n">mpopt</span><span class="p">.</span><span class="nb">exp</span><span class="p">.</span><span class="n">mm_element_classes</span> <span class="p">=</span> <span class="p">{{@</span><span class="n">mp</span><span class="p">.</span><span class="n">mme_gen_opf_ac_oval</span><span class="p">,</span> <span class="s">&#39;mp.mme_gen_opf_ac&#39;</span><span class="p">}};</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create a <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> extension (<a class="reference internal" href="../ref-manual/classes/mp/xt_oval_cap_curve.html#mp.xt_oval_cap_curve" title="mp.xt_oval_cap_curve"><code class="xref mat mat-class docutils literal notranslate"><span class="pre">mp.xt_oval_cap_curve</span></code></a>) to specify the overrides. See also <a class="reference internal" href="extension.html#howto-extension"><span class="std std-ref">How to Create an Extension</span></a>.</p></li>
</ol>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span> <span class="n">xt_oval_cap_curve</span> <span class="o">&lt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">extension</span>
    <span class="k">methods</span>
        <span class="k">function</span> <span class="n">mm_elements</span> <span class="p">=</span> <span class="n">mm_element_classes</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mm_class</span><span class="p">,</span> <span class="n">task_tag</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">)</span>
            <span class="k">switch</span> <span class="n">task_tag</span>
                <span class="k">case</span> <span class="p">{</span><span class="s">&#39;OPF&#39;</span><span class="p">}</span>
                    <span class="n">mm_elements</span> <span class="p">=</span> <span class="p">{</span> <span class="p">{@</span><span class="n">mp</span><span class="p">.</span><span class="n">mme_gen_opf_ac_oval</span><span class="p">,</span> <span class="s">&#39;mp.mme_gen_opf_ac&#39;</span><span class="p">}</span> <span class="p">};</span>
                <span class="k">otherwise</span>
                    <span class="n">mm_elements</span> <span class="p">=</span> <span class="p">{};</span>       <span class="c">%% no modifications</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<p>The 39-bus case included with <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> is an example of a case with numerous binding generator constraints, so we expect that when we include these more restrictive capability curves, the dispatches will change.</p>
<section id="original-box-capability-curves">
<h3>Original “box” capability curves<a class="headerlink" href="#original-box-capability-curves" title="Link to this heading"></a></h3>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">mpopt</span> <span class="p">=</span> <span class="n">mpoption</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;out.all&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">task</span> <span class="p">=</span> <span class="n">run_opf</span><span class="p">(</span><span class="s">&#39;case39&#39;</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">task</span><span class="p">.</span><span class="n">dm</span><span class="p">.</span><span class="n">elements</span><span class="p">.</span><span class="n">gen</span><span class="p">.</span><span class="n">tab</span><span class="p">(:,</span> <span class="p">{</span><span class="s">&#39;pg&#39;</span><span class="p">,</span> <span class="s">&#39;qg&#39;</span><span class="p">})</span>

<span class="n">ans</span> <span class="p">=</span>

  <span class="mi">10</span>×<span class="mi">2</span> <span class="nb">table</span>

      <span class="n">pg</span>        <span class="n">qg</span>
    <span class="n">______</span>    <span class="n">_______</span>

    <span class="mf">671.59</span>        <span class="mi">140</span>
       <span class="mi">646</span>        <span class="mi">300</span>
    <span class="mf">671.16</span>     <span class="mf">299.99</span>
       <span class="mi">652</span>     <span class="mf">115.12</span>
       <span class="mi">508</span>     <span class="mf">139.61</span>
    <span class="mf">661.45</span>     <span class="mf">222.93</span>
       <span class="mi">580</span>     <span class="mf">60.645</span>
       <span class="mi">564</span>     <span class="mf">8.8208</span>
    <span class="mf">654.03</span>    <span class="o">-</span><span class="mf">32.735</span>
    <span class="mf">689.59</span>     <span class="mf">81.886</span>
</pre></div>
</div>
</section>
<section id="oval-capability-curves-via-matpower-options">
<h3>“Oval” capability curves via <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> options<a class="headerlink" href="#oval-capability-curves-via-matpower-options" title="Link to this heading"></a></h3>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">mpopt</span> <span class="p">=</span> <span class="n">mpoption</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;out.all&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">mpopt</span><span class="p">.</span><span class="nb">exp</span><span class="p">.</span><span class="n">mm_element_classes</span> <span class="p">=</span> <span class="p">{{@</span><span class="n">mp</span><span class="p">.</span><span class="n">mme_gen_opf_ac_oval</span><span class="p">,</span> <span class="s">&#39;mp.mme_gen_opf_ac&#39;</span><span class="p">}};</span>
<span class="o">&gt;&gt;</span> <span class="n">task</span> <span class="p">=</span> <span class="n">run_opf</span><span class="p">(</span><span class="s">&#39;case39&#39;</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">task</span><span class="p">.</span><span class="n">dm</span><span class="p">.</span><span class="n">elements</span><span class="p">.</span><span class="n">gen</span><span class="p">.</span><span class="n">tab</span><span class="p">(:,</span> <span class="p">{</span><span class="s">&#39;pg&#39;</span><span class="p">,</span> <span class="s">&#39;qg&#39;</span><span class="p">})</span>

<span class="n">ans</span> <span class="p">=</span>

  <span class="mi">10</span>×<span class="mi">2</span> <span class="nb">table</span>

      <span class="n">pg</span>        <span class="n">qg</span>
    <span class="n">______</span>    <span class="n">______</span>

    <span class="mf">682.74</span>    <span class="mf">171.94</span>
    <span class="mf">639.42</span>    <span class="mf">128.46</span>
    <span class="mf">672.03</span>    <span class="mf">253.14</span>
    <span class="mf">641.75</span>    <span class="mf">147.08</span>
    <span class="mf">507.89</span>    <span class="mf">85.223</span>
    <span class="mf">649.87</span>    <span class="mf">164.86</span>
    <span class="mf">579.41</span>     <span class="mf">125.4</span>
    <span class="mf">563.73</span>    <span class="mf">121.14</span>
    <span class="mf">662.51</span>    <span class="mf">3.8392</span>
    <span class="mf">701.94</span>    <span class="mf">248.89</span>
</pre></div>
</div>
</section>
<section id="oval-capability-curves-via-matpower-extension">
<h3>“Oval” capability curves via <span class="raw-html">M<span style="font-size:smaller">ATPOWER</span></span> extension<a class="headerlink" href="#oval-capability-curves-via-matpower-extension" title="Link to this heading"></a></h3>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">mpopt</span> <span class="p">=</span> <span class="n">mpoption</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;out.all&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">task</span> <span class="p">=</span> <span class="n">run_opf</span><span class="p">(</span><span class="s">&#39;case39&#39;</span><span class="p">,</span> <span class="n">mpopt</span><span class="p">,</span> <span class="s">&#39;mpx&#39;</span><span class="p">,</span> <span class="n">mp</span><span class="p">.</span><span class="n">xt_oval_cap_curve</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">task</span><span class="p">.</span><span class="n">dm</span><span class="p">.</span><span class="n">elements</span><span class="p">.</span><span class="n">gen</span><span class="p">.</span><span class="n">tab</span><span class="p">(:,</span> <span class="p">{</span><span class="s">&#39;pg&#39;</span><span class="p">,</span> <span class="s">&#39;qg&#39;</span><span class="p">})</span>

<span class="n">ans</span> <span class="p">=</span>

  <span class="mi">10</span>×<span class="mi">2</span> <span class="nb">table</span>

      <span class="n">pg</span>        <span class="n">qg</span>
    <span class="n">______</span>    <span class="n">______</span>

    <span class="mf">682.74</span>    <span class="mf">171.94</span>
    <span class="mf">639.42</span>    <span class="mf">128.46</span>
    <span class="mf">672.03</span>    <span class="mf">253.14</span>
    <span class="mf">641.75</span>    <span class="mf">147.08</span>
    <span class="mf">507.89</span>    <span class="mf">85.223</span>
    <span class="mf">649.87</span>    <span class="mf">164.86</span>
    <span class="mf">579.41</span>     <span class="mf">125.4</span>
    <span class="mf">563.73</span>    <span class="mf">121.14</span>
    <span class="mf">662.51</span>    <span class="mf">3.8392</span>
    <span class="mf">701.94</span>    <span class="mf">248.89</span>
</pre></div>
</div>
<p>And notice that our new constraints are binding on 8 of the 10 generators.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">task</span><span class="p">.</span><span class="n">mm</span><span class="p">.</span><span class="n">display_soln</span><span class="p">(</span><span class="s">&#39;nli&#39;</span><span class="p">,</span> <span class="s">&#39;PQoval&#39;</span><span class="p">);</span>
<span class="o">====</span><span class="p">=</span>  <span class="n">NONLIN</span> <span class="n">INEQ</span> <span class="n">CONSTRAINTS</span>  <span class="o">====</span><span class="p">=</span>
  <span class="n">idx</span>    <span class="n">description</span>                    <span class="n">val</span>      <span class="n">ub</span>      <span class="n">mu_ub</span>
<span class="o">-------</span> <span class="o">----------------------------</span> <span class="o">--------</span> <span class="o">--------</span> <span class="o">--------</span>
   <span class="mi">1</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                    <span class="o">-</span><span class="mf">8.3e-06</span>        <span class="mi">0</span>  <span class="mf">9.90806</span>
   <span class="mi">2</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                      <span class="o">-</span><span class="mf">3e-07</span>        <span class="mi">0</span>  <span class="mf">270.778</span>
   <span class="mi">3</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                    <span class="o">-</span><span class="mf">2.9e-06</span>        <span class="mi">0</span>  <span class="mf">28.8787</span>
   <span class="mi">4</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>                    <span class="o">-</span><span class="mf">6.7e-07</span>        <span class="mi">0</span>  <span class="mf">117.164</span>
   <span class="mi">5</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>                      <span class="o">-</span><span class="mf">1e-07</span>        <span class="mi">0</span>  <span class="mf">779.782</span>
   <span class="mi">6</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>                      <span class="o">-</span><span class="mf">8e-07</span>        <span class="mi">0</span>   <span class="mf">103.48</span>
   <span class="mi">7</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>                    <span class="o">-</span><span class="mf">1.8e-07</span>        <span class="mi">0</span>  <span class="mf">459.163</span>
   <span class="mi">8</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>                    <span class="o">-</span><span class="mf">1.4e-07</span>        <span class="mi">0</span>  <span class="mf">566.547</span>
   <span class="mi">9</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>                    <span class="o">-</span><span class="mf">0.31337</span>        <span class="mi">0</span>       <span class="o">-</span>
  <span class="mi">10</span>    <span class="n">PQoval</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>                   <span class="o">-</span><span class="mf">0.03857</span>        <span class="mi">0</span>       <span class="o">-</span>
<span class="o">-------</span> <span class="o">----------------------------</span> <span class="o">--------</span> <span class="o">--------</span> <span class="o">--------</span>
        <span class="n">Max</span>                            <span class="o">-</span><span class="mf">1e-07</span>        <span class="mi">0</span>  <span class="mf">779.782</span>
</pre></div>
</div>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading"></a></h2>
<p>The complete source for this example of adding an OPF constraint can be found in:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/mme_gen_opf_ac_oval.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/mme_gen_opf_ac_oval.m</span></code></a></p></li>
<li><p><a class="reference external" href="https://github.com/MATPOWER/matpower/blob/master/lib/t/%2Bmp/xt_oval_cap_curve.m"><code class="file docutils literal notranslate"><span class="pre">lib/t/+mp/xt_oval_cap_curve.m</span></code></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gizmo-element/index.html" class="btn btn-neutral float-left" title="A Test Gizmo Element Type" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="extension.html" class="btn btn-neutral float-right" title="How to Create an Extension" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1996-2025, Power Systems Engineering Research Center (PSERC).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>